---
import { getLangFromUrl, useTranslations } from "@utils/i18n";
import PlaylistItem from "@components/PlaylistItem.astro";
import Layout from "@layouts/Layout.astro";
import Headline from "@components/Headline.astro";
import Paragraph from "@components/Paragraph.astro";
import { extractKeywords, generateMetaDescription } from "@utils/seo";
import CategoryFilter from "@components/CategoryFilter.astro";

import EmptyState from "@components/EmptyState.astro";
import LoadingState from "@components/LoadingState.astro";
import BackToTop from "@components/Shared/BackToTop.astro";

/**
 * Static path generation for internationalization
 * Required for Astro dynamic routes to work properly
 */
export async function getStaticPaths(): Promise<{ params: { lang: string } }[]> {
  const supportedLanguages = [
    "de",
    "en",
    "es",
    "fr",
    "it",
    "pt",
    "da",
    "nl",
    "sv",
    "fi",
    "cn",
    "ru",
    "jp",
    "uk",
  ] as const;

  return supportedLanguages.map((lang) => ({
    params: { lang },
  }));
}

/**
 * Enable static site generation for this page
 */
export const prerender = true;

/**
 * Language and translation setup
 * Sets the current language based on URL and loads appropriate translations
 */
const lang = String(getLangFromUrl(Astro.url));
const t = useTranslations(String(lang));

/**
 * Interface defining the structure of a music category
 */
interface Category {
  isPlayable: boolean;
  headline: string;
  categoryUrl?: string;
  imageUrl: string;
  introSubline: string;
  slug: string;
  text: string;
  categoryType:
    | "decade"
    | "female"
    | "genre"
    | "other"
    | "classic-rock"
    | "metal-classic"
    | "metal-modern"
    | "metal-avantgarde"
    | "mainstream-pop"
    | "indie-alternative"
    | "global-pop"
    | "jazz-soul-funk"
    | "hip-hop-rap"
    | "house-techno"
    | "club-sounds"
    | "breaks-experimental"
    | "latin-vibes"
    | "caribbean-afro"
    | "folk-regional"
    | "classical-orchestral"
    | "countries-regional"
    | "emotional"
    | "seasonal"
    | "situational";
}

/**
 * Generates WebApplication schema for the game home page
 */
function generateGameApplicationSchema(
  title: string,
  description: string,
  currentUrl: string,
  lang: string
) {
  return {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    name: `MelodyMind - ${title}`,
    description: description,
    url: currentUrl,
    applicationCategory: "GameApplication",
    applicationSubCategory: "MusicTrivia",
    operatingSystem: "Web Browser",
    genre: "Music Trivia",
    inLanguage: lang,
    creator: {
      "@type": "Organization",
      name: "MelodyMind Team",
    },
    datePublished: "2024-01-01",
    dateModified: new Date().toISOString(),
    isAccessibleForFree: true,
  };
}

/**
 * Generates ItemList schema for game categories
 */
function generateCategoryListSchema(baseUrl: string, lang: string, playableCategories: Category[]) {
  return {
    "@context": "https://schema.org",
    "@type": "ItemList",
    name: "Music Game Categories",
    description: "Available music trivia categories in MelodyMind",
    numberOfItems: playableCategories.length,
    itemListElement: playableCategories.slice(0, 10).map((category, index) => ({
      "@type": "ListItem",
      position: index + 1,
      item: {
        "@type": "Game",
        name: category.headline,
        description: category.introSubline,
        url: `${baseUrl}/${lang}${category.categoryUrl}`,
        genre: "Music Trivia",
        applicationCategory: "Game",
      },
    })),
  };
}

/**
 * Generates client-side translations with fallbacks
 */
function generateClientTranslations(t: (_key: string) => string) {
  return {
    search: {
      placeholder: t("game.search.label"),
      showingAll: t("game.search.showing.all"),
      resultsFound: t("game.search.results"),
      noResults: t("game.search.no.results"),
      clear: t("game.search.clear"),
    },
    accessibility: {
      skipToContent: t("accessibility.skip.to.content"),
      searchLabel: t("game.search.label"),
    },
  };
}

/**
 * Asynchronously loads category data with fallback mechanisms
 * First attempts to load using the alias path, then tries relative path if that fails
 * @returns {Promise<Category[]>} Array of category objects
 */
async function loadCategoriesForLanguage(language: string): Promise<Category[]> {
  try {
    // First try using the alias path
    return await import(`@json/${language}_categories.json`)
      .then((module) => module.default)
      .catch(async () => {
        // Fallback to relative path if alias fails
        console.warn(`Attempting to load ${language}_categories.json using relative path`);
        return await import(`../../json/${language}_categories.json`)
          .then((module) => module.default)
          .catch((_err) => {
            return [];
          });
      });
  } catch (error) {
    console.error(`Error loading categories for ${language}:`, error);
    return [];
  }
}

// Load categories and ensure we have a valid array
const categoriesList = await loadCategoriesForLanguage(lang);
const categories = Array.isArray(categoriesList) ? categoriesList : [];

/**
 * Type guard that checks if an item is a valid playable category
 * @param item - The item to check
 * @returns Boolean indicating if item is a valid playable category
 */

function isPlayableCategory(item: any): item is Category & { categoryUrl: string } {
  return (
    item &&
    typeof item === "object" &&
    item.isPlayable === true &&
    typeof item.headline === "string" &&
    typeof item.imageUrl === "string" &&
    typeof item.introSubline === "string" &&
    typeof item.slug === "string" &&
    typeof item.text === "string" &&
    typeof item.categoryUrl === "string" &&
    typeof item.categoryType === "string" &&
    Boolean(item.categoryUrl)
  );
}

// Filter categories by playability status
const playableCategories = categories.filter(isPlayableCategory);
const nonPlayableCategories = categories.filter((item) => item && !item.isPlayable);

// Sort categories by type and then by name within each type
function sortCategoriesByType(categories: Category[]): Category[] {
  const typeOrder = {
    decade: 1,
    female: 2,
    "classic-rock": 3,
    "metal-classic": 4,
    "metal-modern": 5,
    "metal-avantgarde": 6,
    "mainstream-pop": 7,
    "indie-alternative": 8,
    "global-pop": 9,
    "jazz-soul-funk": 10,
    "hip-hop-rap": 11,
    "house-techno": 12,
    "club-sounds": 13,
    "breaks-experimental": 14,
    "latin-vibes": 15,
    "caribbean-afro": 16,
    "folk-regional": 17,
    "classical-orchestral": 18,
    "countries-regional": 19,
    emotional: 20,
    seasonal: 21,
    situational: 22,
    genre: 23,
    other: 24,
  };

  return categories.sort((a, b) => {
    // First sort by type
    if (typeOrder[a.categoryType] !== typeOrder[b.categoryType]) {
      return typeOrder[a.categoryType] - typeOrder[b.categoryType];
    }

    // Within same type, sort decades chronologically, others alphabetically
    if (a.categoryType === "decade") {
      return a.slug.localeCompare(b.slug);
    }

    return a.headline.localeCompare(b.headline);
  });
}

// Sort categories by type and playability
const sortedPlayableCategories = sortCategoriesByType(playableCategories);
const sortedNonPlayableCategories = sortCategoriesByType(nonPlayableCategories);

// Combined categories with playable ones first, sorted by type
const sortedCategories = [...sortedPlayableCategories, ...sortedNonPlayableCategories];

// Enhanced SEO content generation for better search visibility
const title = t("game.select");
const description = t("game.welcome");

// Create rich SEO content combining category information
const enrichedContent = `${title} ${description} ${t("game.genre.selection.description")} ${sortedCategories.map((c) => `${c.headline} ${c.introSubline} ${c.text || ""}`).join(" ")}`;

// Generate optimized meta description and keywords using enhanced content
const optimizedDescription = generateMetaDescription(enrichedContent, 158); // Leave room for ellipsis
const seoKeywords = extractKeywords(enrichedContent, 12, lang) || t("meta.keywords");

// Create category-specific keywords for better targeting
const categoryNames = sortedCategories.map((c) => c.headline.toLowerCase()).join(", ");
const combinedKeywords = `${seoKeywords}, ${categoryNames}, ${t("meta.keywords")}`.substring(
  0,
  255
);

// Enhanced structured data for GameHub/CategoryList
const baseUrl = Astro.site?.toString() || "https://melody-mind.de";
const currentUrl = `${baseUrl}/${lang}/gamehome`;

// JSON-LD structured data for better search engine understanding
const gameApplicationSchema = generateGameApplicationSchema(
  title,
  optimizedDescription,
  currentUrl,
  lang
);

// ItemList schema for game categories
const categoryListSchema = generateCategoryListSchema(baseUrl, lang, playableCategories);

// Additional structured data parameters for enhanced SEO
const pageType = "website";
const publishDate = new Date("2024-01-01");
const modifiedDate = new Date();

// Prepare fallback text for empty states
const emptyCategoriesHeadline = t("game.categories.empty.headline");
const emptyCategoriesText = t("game.categories.empty.text");

// Client-side translations for enhanced interactivity
const clientTranslations = generateClientTranslations(t);
---

<Layout
  {title}
  description={optimizedDescription}
  keywords={combinedKeywords}
  image={`/og-images/social-share-gamehome-${String(lang)}.jpg`}
  type={pageType}
  {publishDate}
  {modifiedDate}
>
  <!-- Enhanced structured data for SEO -->
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(gameApplicationSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(categoryListSchema)} />

    <!-- Additional SEO meta tags -->
    <meta name="robots" content="index, follow, max-image-preview:large" />
    <meta name="googlebot" content="index, follow" />
    <link rel="canonical" href={currentUrl} />

    <!-- Enhanced OpenGraph tags for social sharing -->
    <meta property="og:type" content="website" />
    <meta property="og:locale" content={`${lang}_${lang.toUpperCase()}`} />
    <meta property="article:section" content="Gaming" />
    <meta property="article:tag" content="Music Trivia" />
    <meta property="article:tag" content="Online Game" />
    <meta property="article:tag" content="Music Knowledge" />
  </Fragment>

  <!-- Make translations available for JavaScript functionality -->
  <script is:inline define:vars={{ clientTranslations }}>
    window.gameHomeTranslations = clientTranslations;
  </script>

  <main id="main-content" class="gamehome-container" role="main" aria-labelledby="welcome-heading">
    <!-- Hero section with improved semantics and accessibility -->
    <header class="gamehome-hero" aria-labelledby="welcome-heading">
      <!-- Decorative background elements with aria-hidden -->
      <div class="gamehome-hero__decoration" aria-hidden="true">
        <div class="gamehome-hero__decoration-item gamehome-hero__decoration-item--top-right"></div>
        <div class="gamehome-hero__decoration-item gamehome-hero__decoration-item--bottom-left">
        </div>
        <div class="gamehome-hero__decoration-item gamehome-hero__decoration-item--center-right">
        </div>
      </div>

      <div class="gamehome-hero__content">
        <Headline title={`${t("game.welcome")}`} level="h1" id="welcome-heading" size="2xl" />
        <div class="gamehome-hero__divider"></div>
        <Paragraph align="center" textSize="lg">
          {t("game.select")}
        </Paragraph>
        <!-- Additional descriptive content for SEO -->
        <Paragraph className="sr-only">
          {t("game.genre.selection.description")}
        </Paragraph>
      </div>
    </header>

    <section class="genre-selection" aria-labelledby="playlist-heading">
      <!-- Category Filter Dropdown -->
      <CategoryFilter
        categories={[
          { type: "decade", title: t("game.filter.decades") || "Decades", icon: "📅" },
          { type: "female", title: t("game.filter.female") || "Female Artists", icon: "👩‍🎤" },
          {
            type: "classic-rock",
            title: t("game.filter.classic-rock") || "Classic Rock & Hard Rock",
            icon: "🎸",
          },
          {
            type: "metal-classic",
            title: t("game.filter.metal-classic") || "Metal – Klassiker",
            icon: "⚡",
          },
          {
            type: "metal-modern",
            title: t("game.filter.metal-modern") || "Modern Metal",
            icon: "🔥",
          },
          {
            type: "metal-avantgarde",
            title: t("game.filter.metal-avantgarde") || "Avantgarde & Extreme Metal",
            icon: "🎭",
          },
          {
            type: "mainstream-pop",
            title: t("game.filter.mainstream-pop") || "Mainstream Pop",
            icon: "🎤",
          },
          {
            type: "indie-alternative",
            title: t("game.filter.indie-alternative") || "Indie & Alternative",
            icon: "🎶",
          },
          {
            type: "global-pop",
            title: t("game.filter.global-pop") || "Global Pop Scenes",
            icon: "🌏",
          },
          {
            type: "jazz-soul-funk",
            title: t("game.filter.jazz-soul-funk") || "Jazz, Soul & Funk",
            icon: "🎷",
          },
          {
            type: "hip-hop-rap",
            title: t("game.filter.hip-hop-rap") || "Hip Hop & Rap",
            icon: "🎤",
          },
          {
            type: "house-techno",
            title: t("game.filter.house-techno") || "House & Techno",
            icon: "🎛️",
          },
          { type: "club-sounds", title: t("game.filter.club-sounds") || "Club Sounds", icon: "🎚️" },
          {
            type: "breaks-experimental",
            title: t("game.filter.breaks-experimental") || "Breaks & Experimental",
            icon: "🌀",
          },
          { type: "latin-vibes", title: t("game.filter.latin-vibes") || "Latin Vibes", icon: "🎺" },
          {
            type: "caribbean-afro",
            title: t("game.filter.caribbean-afro") || "Caribbean & Afro",
            icon: "🌴",
          },
          {
            type: "folk-regional",
            title: t("game.filter.folk-regional") || "Folk & Regional",
            icon: "🪕",
          },
          {
            type: "classical-orchestral",
            title: t("game.filter.classical-orchestral") || "Classical & Orchestral",
            icon: "🎼",
          },
          {
            type: "countries-regional",
            title: t("game.filter.countries-regional") || "Countries & Regional",
            icon: "🌍",
          },
          {
            type: "emotional",
            title: t("game.filter.emotional") || "Emotional Genres",
            icon: "💫",
          },
          { type: "seasonal", title: t("game.filter.seasonal") || "Seasonal Genres", icon: "❄️" },
          {
            type: "situational",
            title: t("game.filter.situational") || "Situational & Activity-Based",
            icon: "🎉",
          },
          { type: "other", title: t("game.filter.other") || "Other Categories", icon: "📚" },
        ]}
        selectedValue="all"
      />

      <!-- Enhanced genre grid with semantic markup -->
      <div class="genre-content">
        <Headline
          title={t("game.categories.title")}
          level="h2"
          className="genre-content__title sr-only"
          id="playlist-heading"
        />

        {
          categories && categories.length > 0 ? (
            <>
              {/* Dynamic Category Groups */}
              {(() => {
                const categoryGroups = [
                  { type: "decade", title: t("game.categories.decades") || "Decades", icon: "📅" },
                  {
                    type: "female",
                    title: t("game.categories.female") || "Female Artists",
                    icon: "👩‍🎤",
                  },
                  {
                    type: "classic-rock",
                    title: t("game.filter.classic-rock") || "Classic Rock & Hard Rock",
                    icon: "🎸",
                  },
                  {
                    type: "metal-classic",
                    title: t("game.filter.metal-classic") || "Metal – Classics",
                    icon: "⚡",
                  },
                  {
                    type: "metal-modern",
                    title: t("game.filter.metal-modern") || "Modern Metal",
                    icon: "🔥",
                  },
                  {
                    type: "metal-avantgarde",
                    title: t("game.filter.metal-avantgarde") || "Avantgarde & Extreme Metal",
                    icon: "🎭",
                  },
                  {
                    type: "mainstream-pop",
                    title: t("game.filter.mainstream-pop") || "Mainstream Pop",
                    icon: "🎤",
                  },
                  {
                    type: "indie-alternative",
                    title: t("game.filter.indie-alternative") || "Indie & Alternative",
                    icon: "🎶",
                  },
                  {
                    type: "global-pop",
                    title: t("game.filter.global-pop") || "Global Pop Scenes",
                    icon: "🌏",
                  },
                  {
                    type: "jazz-soul-funk",
                    title: t("game.filter.jazz-soul-funk") || "Jazz, Soul & Funk",
                    icon: "🎷",
                  },
                  {
                    type: "hip-hop-rap",
                    title: t("game.filter.hip-hop-rap") || "Hip Hop & Rap",
                    icon: "🎤",
                  },
                  {
                    type: "house-techno",
                    title: t("game.filter.house-techno") || "House & Techno",
                    icon: "🎛️",
                  },
                  {
                    type: "club-sounds",
                    title: t("game.filter.club-sounds") || "Club Sounds",
                    icon: "🎚️",
                  },
                  {
                    type: "breaks-experimental",
                    title: t("game.filter.breaks-experimental") || "Breaks & Experimental",
                    icon: "🌀",
                  },
                  {
                    type: "latin-vibes",
                    title: t("game.filter.latin-vibes") || "Latin Vibes",
                    icon: "🎺",
                  },
                  {
                    type: "caribbean-afro",
                    title: t("game.filter.caribbean-afro") || "Caribbean & Afro",
                    icon: "🌴",
                  },
                  {
                    type: "folk-regional",
                    title: t("game.filter.folk-regional") || "Folk & Regional",
                    icon: "🪕",
                  },
                  {
                    type: "classical-orchestral",
                    title: t("game.filter.classical-orchestral") || "Classical & Orchestral",
                    icon: "🎼",
                  },
                  {
                    type: "countries-regional",
                    title: t("game.filter.countries-regional") || "Countries & Regional",
                    icon: "🌍",
                  },
                  {
                    type: "emotional",
                    title: t("game.filter.emotional") || "Emotional Genres",
                    icon: "💫",
                  },
                  {
                    type: "seasonal",
                    title: t("game.filter.seasonal") || "Seasonal Genres",
                    icon: "❄️",
                  },
                  {
                    type: "situational",
                    title: t("game.filter.situational") || "Situational & Activity-Based",
                    icon: "🎉",
                  },
                  {
                    type: "other",
                    title: t("game.categories.other") || "Other Categories",
                    icon: "📚",
                  },
                ];

                return categoryGroups.map((group) => {
                  const groupCategories = sortedCategories.filter(
                    (cat) => cat.categoryType === group.type
                  );
                  if (groupCategories.length === 0) {
                    return null;
                  }

                  return (
                    <div class="category-group" data-category-type={group.type}>
                      <h3 class="category-group__title">
                        {group.icon} {group.title}
                      </h3>
                      <div
                        class="genre-grid"
                        role="list"
                        aria-label={t("game.genre.list")}
                        aria-live="polite"
                        itemscope
                        itemtype="https://schema.org/ItemList"
                      >
                        {groupCategories.map((category) => (
                          <PlaylistItem
                            headline={category.headline}
                            subheadline={category.introSubline}
                            image={category.imageUrl}
                            imageAlt={`${category.headline} music category`}
                            href={category.categoryUrl ? `/${lang}${category.categoryUrl}` : "#"}
                            isDisabled={!category.isPlayable}
                          />
                        ))}
                      </div>
                    </div>
                  );
                });
              })()}
            </>
          ) : (
            <div
              class="genre-grid"
              role="list"
              aria-label={t("game.genre.list")}
              aria-live="polite"
              itemscope
              itemtype="https://schema.org/ItemList"
            >
              <EmptyState
                headline={emptyCategoriesHeadline}
                text={emptyCategoriesText}
                iconName="music-note"
                className="genre-grid__empty"
              />
            </div>
          )
        }
      </div>

      <!-- Loading state for better UX -->
      <LoadingState text={t("game.categories.loading")} className="loading-state" visible={false} />
    </section>
  </main>

  <!-- Back to Top Component for improved UX and accessibility -->
  <BackToTop {lang} />
</Layout>

<style lang="scss">
  /* ======================================
   * GAMEHOME PAGE STYLES - OPTIMIZED FOR STYLE GUARDIAN
   * BEM Methodology + Global Variables + Mobile-First
   * ====================================== */

  .gamehome-container {
    width: var(--width-full);
    max-width: var(--container-xl);
    margin: 0 auto;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    contain: layout style paint;
    padding: var(--space-md) var(--space-sm); // Mobile: minimal horizontal spacing
  }

  /* ======================================
   * HERO SECTION - SIMPLIFIED DESIGN
   * ====================================== */
  .gamehome-hero {
    position: relative;
    overflow: hidden;
    background: linear-gradient(
      135deg,
      var(--color-primary-900) 0%,
      var(--color-primary-700) 50%,
      var(--color-secondary-800) 100%
    );
    box-shadow: var(--shadow-xl);
    border: var(--border-width-thin) solid var(--border-primary);
    contain: layout style paint;
    margin-bottom: var(--space-lg);
    padding: var(--space-md) var(--space-sm); // Mobile: compact spacing
    border-radius: var(--radius-lg);

    &__decoration {
      position: absolute;
      inset: 0;
      opacity: 0.1;
      pointer-events: none;
      contain: layout style paint;

      &-item {
        position: absolute;
        border-radius: var(--radius-full);
        background: var(--color-white);
        contain: layout style paint;

        &--top-right {
          top: calc(-1 * var(--space-xl));
          right: calc(-1 * var(--space-xl));
          width: var(--space-3xl);
          height: var(--space-3xl);
        }

        &--bottom-left {
          bottom: calc(-1 * var(--space-2xl));
          left: calc(-1 * var(--space-2xl));
          width: calc(var(--space-3xl) * 2);
          height: calc(var(--space-3xl) * 2);
        }

        &--center-right {
          top: 50%;
          right: calc(-1 * var(--space-md));
          width: var(--space-2xl);
          height: var(--space-2xl);
          transform: translateY(-50%);
        }
      }
    }

    &__content {
      position: relative;
      z-index: 1;
      text-align: center;
      color: var(--color-white);
      contain: layout style;
      width: var(--width-full);
    }

    &__divider {
      background: var(--color-secondary-400);
      border-radius: var(--radius-full);
      contain: layout style paint;
      width: var(--icon-size-lg);
      height: var(--border-width-thick);
      margin: var(--space-sm) auto;
    }
  }

  /* ======================================
   * SEARCH CONTAINER - SIMPLIFIED DESIGN
   * ====================================== */
  .search-container {
    contain: layout style paint;
    margin-bottom: var(--space-lg);

    &__wrapper {
      position: relative;
      margin: 0 auto;
      contain: layout style;
      max-width: var(--width-full);
    }

    &__icon {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-tertiary);
      pointer-events: none;
      z-index: var(--z-dropdown);
      contain: layout style paint;
      left: var(--space-sm);

      &-element {
        width: var(--icon-size-sm);
        height: var(--icon-size-sm);
      }
    }

    &__input {
      width: var(--width-full);
      border: var(--border-width-thin) solid var(--border-primary);
      border-radius: var(--radius-lg);
      background-color: var(--form-bg);
      color: var(--form-text);
      line-height: var(--leading-normal);
      transition: all var(--transition-base);
      box-shadow: var(--shadow-sm);
      contain: layout style paint;
      padding: var(--space-sm) var(--space-sm) var(--space-sm) var(--space-2xl);
      font-size: var(--text-base);

      &:focus {
        outline: var(--focus-ring);
        outline-offset: var(--focus-ring-offset);
        border-color: var(--interactive-primary);
        box-shadow: var(--shadow-md);
      }

      &::placeholder {
        color: var(--text-tertiary);
      }
    }

    &__clear {
      position: absolute;
      right: var(--space-md);
      top: 50%;
      transform: translateY(-50%);
      padding: var(--space-xs);
      border: none;
      background: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: color var(--transition-fast);
      contain: layout style paint;

      &:hover {
        color: var(--text-primary);
      }

      &:focus {
        outline: var(--focus-ring);
        outline-offset: var(--focus-ring-offset);
      }
    }

    &__results-info {
      text-align: center;
      margin-top: var(--space-md);
      color: var(--text-secondary);
      font-size: var(--text-base);
      contain: layout style;
    }
  }

  /* ======================================
   * GENRE GRID - SIMPLIFIED DESIGN
   * ====================================== */
  .genre-content {
    flex-grow: 1;
    contain: layout style;
  }

  .genre-grid {
    display: grid;
    margin-bottom: var(--space-xl);
    contain: layout style paint;
    grid-template-columns: 1fr;
    gap: var(--space-md);

    @media (min-width: 20em) {
      gap: var(--space-lg);
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    }

    @media (min-width: 48em) {
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: var(--space-xl);
    }

    @media (min-width: 64em) {
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    }
  }

  /* ======================================
   * ACCESSIBILITY ENHANCEMENTS
   * ====================================== */
  @media (prefers-reduced-motion: reduce) {
    .loading-state__spinner {
      animation: none;
      border: var(--border-width-thick) solid var(--interactive-primary);
    }
  }

  /* ======================================
   * MOBILE PORTRAIT OPTIMIZATIONS
   * ====================================== */
  // Extra small screens - Portrait Mobile (below 320px)
  @media (max-width: 19.9375em) {
    .gamehome-container {
      padding: var(--space-sm) var(--space-xs);
    }

    .gamehome-hero {
      padding: var(--space-sm);
      margin-bottom: var(--space-md);

      &__title {
        font-size: var(--text-lg);
        margin-bottom: var(--space-xs);
      }

      &__description {
        font-size: var(--text-sm);
        line-height: var(--leading-snug);
      }

      &__divider {
        width: var(--icon-size-md);
        margin: var(--space-sm) auto;
      }
    }

    .search-container {
      margin-bottom: var(--space-md);

      &__input {
        padding: var(--space-xs) var(--space-xs) var(--space-xs) var(--space-xl);
        font-size: var(--text-sm);
      }

      &__icon {
        left: var(--space-xs);

        &-element {
          width: var(--icon-size-xs);
          height: var(--icon-size-xs);
        }
      }
    }

    .genre-grid {
      gap: var(--space-sm);
    }
  }

  .sr-only {
    position: absolute;
    width: var(--sr-only-width);
    height: var(--sr-only-height);
    padding: 0;
    margin: var(--sr-only-margin);
    overflow: hidden;
    clip: var(--sr-only-clip-path);
    white-space: nowrap;
    border: 0;
  }
</style>

<!-- Enhanced client-side functionality with modern ES6+ features -->
<script>
  // Type declarations for translations
  interface GameTranslations {
    search: {
      placeholder: string;
      showingAll: string;
      resultsFound: string;
      noResults: string;
      clear: string;
    };
    accessibility: {
      skipToContent: string;
      searchLabel: string;
    };
  }

  // Extend Window interface
  declare global {
    interface Window {
      gameHomeTranslations?: GameTranslations;
    }
  }

  // Simple search functionality for game home page
  class GameHomeSearch {
    private searchInput: HTMLInputElement | null;
    private clearButton: HTMLButtonElement | null;
    private gridContainer: HTMLElement | null;
    private resultsInfo: HTMLElement | null;
    private allItems: NodeListOf<Element>;
    private translations: GameTranslations;

    constructor() {
      this.searchInput = document.getElementById("filter-input") as HTMLInputElement;
      this.clearButton = document.querySelector(".search-container__clear") as HTMLButtonElement;

      this.gridContainer = document.getElementById("playlist-grid");
      this.resultsInfo = document.querySelector(".search-container__results-info");
      this.allItems = document.querySelectorAll("#playlist-grid > *");
      this.translations = window.gameHomeTranslations ?? this.getDefaultTranslations();

      if (this.searchInput && this.gridContainer) {
        this.init();
      }
    }

    private getDefaultTranslations = (): GameTranslations => ({
      search: {
        placeholder: "Search genres...",
        showingAll: "Showing all genres",
        resultsFound: "genres found",
        noResults: "No genres found matching your search",
        clear: "Clear search",
      },
      accessibility: {
        skipToContent: "Skip to main content",
        searchLabel: "Search music genres",
      },
    });

    private init = (): void => {
      this.searchInput!.addEventListener("input", this.handleSearch);
      this.searchInput!.addEventListener("keydown", this.handleKeydown);

      if (this.clearButton) {
        this.clearButton.addEventListener("click", this.clearSearch);
      }

      this.updateResultsInfo(this.allItems.length, "");
    };

    private handleSearch = (event: Event): void => {
      const target = event.target as HTMLInputElement;
      const query = target.value.toLowerCase().trim();

      this.filterItems(query);
      this.updateClearButton(query);
    };

    private handleKeydown = (event: KeyboardEvent): void => {
      if (event.key === "Escape") {
        this.clearSearch();
      }
    };

    private filterItems = (query: string): void => {
      let visibleCount = 0;

      this.allItems.forEach((item) => {
        const textContent = item.textContent?.toLowerCase() ?? "";
        const isVisible = query === "" || textContent.includes(query);

        if (item instanceof HTMLElement) {
          item.style.display = isVisible ? "" : "none";
          item.setAttribute("aria-hidden", (!isVisible).toString());
        }

        if (isVisible) {
          visibleCount++;
        }
      });

      this.updateResultsInfo(visibleCount, query);
    };

    private updateResultsInfo = (count: number, query: string): void => {
      if (!this.resultsInfo) {
        return;
      }

      const message =
        query === ""
          ? ""
          : count === 0
            ? this.translations.search.noResults
            : `${count} ${this.translations.search.resultsFound}`;

      this.resultsInfo.textContent = message;
      this.updateClearButton(query);
    };

    private updateClearButton = (query: string): void => {
      if (!this.clearButton) {
        return;
      }

      const hasQuery = query.length > 0;
      this.clearButton.toggleAttribute("hidden", !hasQuery);
    };

    private clearSearch = (): void => {
      if (!this.searchInput) {
        return;
      }

      this.searchInput.value = "";
      this.filterItems("");
      this.updateClearButton("");
      this.searchInput.focus();
    };
  }

  // Initialize search functionality
  const initSearch = (): void => {
    new GameHomeSearch();
  };

  // Initialize when DOM is ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initSearch);
  } else {
    initSearch();
  }
</script>
