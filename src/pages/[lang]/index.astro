---
/**
 * MelodyMind Homepage Component
 *
 * This component renders the main landing page of the MelodyMind app.
 * It implements WCAG AAA (7:1 contrast ratio) accessibility standards
 * and uses performance optimizations for fast loading and rendering.
 */
import Layout from "@layouts/Layout.astro";
import { Image } from "astro:assets";
import { getLangFromUrl, useTranslations } from "@utils/i18n";
import { extractKeywords, generateMetaDescription } from "@utils/seo";
import Headline from "@components/Headline.astro";
import Paragraph from "@components/Paragraph.astro";
import ButtonLink from "@components/ButtonLink.astro";

// Extract language from URL and set up translations
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(String(lang));

/**
 * Dynamic redirect based on browser language preference
 * Ensures users land on their preferred language version
 */
if (Astro.request.method === "GET" && !Astro.params.lang) {
  // Inline locale redirect: avoid importing helper when it is not used elsewhere in the file
  const locale = Astro.preferredLocale || "en";
  return Astro.redirect(`/${locale}/`);
}

// Basic page content setup
const title = t("login.welcome");
const description = t("login.description");

/**
 * Enhanced SEO content generation
 * Combines various text elements for better keyword density and relevance
 */
const pageContent = `${title} ${description} ${t("index.welcome.footnote")}`;

// Generate optimized meta description and keyword set
const optimizedDescription = generateMetaDescription(pageContent);
const keywords = extractKeywords(pageContent) || t("meta.keywords");

// Structured data parameters for enhanced SEO
const pageType = "website";
const publishDate = new Date("2024-01-01");
const modifiedDate = new Date();
---

<Layout
  {title}
  description={optimizedDescription}
  {keywords}
  image={`/og-images/social-share-home-${String(lang)}.jpg`}
  type={pageType}
  {publishDate}
  {modifiedDate}
>
  <div class="mx-auto flex w-full max-w-5xl flex-col items-center">
    <Image
      class="mx-auto h-auto w-56 sm:w-48 md:w-64 lg:w-72 xl:w-80"
      src="/melody-mind.png"
      width={800}
      height={800}
      alt="Melody Mind Logo - Music Quiz App Logo"
      loading="eager"
      fetchpriority="high"
    />

    {/* Semantic heading with proper hierarchy and responsive sizing */}
    <Headline level="h1" textAlign="center">
      {title}
    </Headline>

    {/* Description with responsive text and max width for readability */}
    <Paragraph textAlign="center" textSize="xl">
      {description}
    </Paragraph>

    {/* Accessible button container optimized for mobile-first full-width touch targets */}
    <div class="mx-auto my-4">
      <ButtonLink href={`/${String(lang)}/gamehome`} aria-label={t("index.start.game.label")}>
        <span>{t("index.continue")}</span>
      </ButtonLink>
    </div>

    {/* Footer text with improved contrast ratio and generous spacing for mobile */}
    <div class="mx-auto w-full">
      <Paragraph textSize="lg" textAlign="center">
        {t("index.welcome.footnote")}
      </Paragraph>
    </div>
  </div>
</Layout>

<script>
  import { initIndexPageAuto } from "../../utils/components/indexPageUtils";

  // Initialize index page functionality
  initIndexPageAuto();
</script>
