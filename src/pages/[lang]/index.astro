---
/**
 * MelodyMind Homepage Component
 *
 * This component renders the main landing page of the MelodyMind app.
 * It implements WCAG AAA (7:1 contrast ratio) accessibility standards
 * and uses performance optimizations for fast loading and rendering.
 *
 * @author MelodyMind Team
 * @lastModified 2025-04-23
 */
import Layout from "@layouts/Layout.astro";
import { Image } from "astro:assets";
import { getLangFromUrl, useTranslations, getRelativeLocaleUrl } from "@utils/i18n";
import { extractKeywords, generateMetaDescription } from "@utils/seo";
import Headline from "@components/Headline.astro";
import Paragraph from "@components/Paragraph.astro";
import ButtonLink from "@components/ButtonLink.astro";

// Extract language from URL and set up translations
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(String(lang));

/**
 * Dynamic redirect based on browser language preference
 * Ensures users land on their preferred language version
 */
if (Astro.request.method === "GET" && !Astro.params.lang) {
  return Astro.redirect(getRelativeLocaleUrl(Astro.preferredLocale || "en", "/"));
}

// Basic page content setup
const title = t("login.welcome");
const description = t("login.description");

/**
 * Enhanced SEO content generation
 * Combines various text elements for better keyword density and relevance
 */
const pageContent = `${title} ${description} ${t("index.welcome.footnote")}`;

// Generate optimized meta description and keyword set
const optimizedDescription = generateMetaDescription(pageContent);
const keywords = extractKeywords(pageContent) || t("meta.keywords");

// Structured data parameters for enhanced SEO
const pageType = "website";
const publishDate = new Date("2024-01-01");
const modifiedDate = new Date();

/**
 * Define main logo image optimization parameters
 * This improves performance by loading appropriately sized images
 */
const imageWidth = 600;
const imageHeight = 600;
---

<Layout
  {title}
  description={optimizedDescription}
  {keywords}
  image={`/og-images/social-share-home-${String(lang)}.jpg`}
  type={pageType}
  {publishDate}
  {modifiedDate}
>
  <main id="main-content" class="main-content" tabindex="-1">
    <div class="content-container">
      <div class="content-wrapper">
        {/* Logo with comprehensive image optimization and accessibility */}
        <div class="logo-container" aria-hidden="true">
          <Image
            src="/melody-mind.png"
            width={imageWidth}
            height={imageHeight}
            alt="Melody Mind Logo - Music Quiz App Logo"
            loading="eager"
            class="logo-image"
            fetchpriority="high"
          />
        </div>

        {/* Semantic heading with proper hierarchy */}
        <Headline level="h1" {title} className="main-title" />

        {/* Description with enhanced contrast for AAA compliance */}
        <Paragraph className="main-description" align="center" textSize="2xl">
          {description}
        </Paragraph>

        {/* Accessible button container with increased touch targets */}
        <div class="button-container">
          <ButtonLink href={`/${String(lang)}/gamehome`} aria-label={t("index.start.game.label")}>
            <span>{t("index.continue")}</span>
          </ButtonLink>
        </div>

        {/* Footer text with improved contrast ratio */}
        <div class="footer-section">
          <Paragraph className="footer-text" textSize="xl" ariaLive="polite">
            {t("index.welcome.footnote")}
          </Paragraph>
        </div>
      </div>
    </div>
  </main>
</Layout>

<style>
  /* ======================================
   * MAIN LAYOUT
   * ====================================== */
  .main-content {
    display: flex;
    min-height: 100vh;
    align-items: center;
    justify-content: center;
    color: var(--text-primary);
  }

  .content-container {
    margin: 0 auto;
    display: flex;
    width: var(--width-full);
    max-width: var(--container-lg);
    flex-direction: column;
    align-items: center;
    padding: var(--space-xl) var(--space-lg);
    text-align: center;
  }

  .content-wrapper {
    display: flex;
    width: var(--width-full);
    flex-direction: column;
    align-items: center;
  }

  /* ======================================
   * LOGO SECTION
   * ====================================== */
  .logo-container {
    position: relative;
    margin: 0 auto var(--space-3xl);
    aspect-ratio: 1;
    width: var(--width-full);
    max-width: var(--container-query-md);
  }

  .logo-image {
    height: auto;
    width: var(--width-full);
    transition: transform var(--transition-normal);
  }

  @media (prefers-reduced-motion: no-preference) {
    .logo-image:hover {
      transform: scale(var(--animation-scale-hover-subtle));
    }
  }

  /* ======================================
   * BUTTON SECTION
   * ====================================== */
  .button-container {
    margin: var(--space-lg) auto 0;
    display: flex;
    width: var(--width-full);
    max-width: var(--container-query-md);
    flex-direction: column;
    align-items: center;
    gap: var(--space-lg);
  }

  /* ======================================
   * FOOTER SECTION
   * ====================================== */
  .footer-section {
    margin-top: var(--space-3xl);
  }

  /* ======================================
   * LANGUAGE SELECTOR
   * ====================================== */
  .language-selector-wrapper {
    margin-top: var(--space-3xl);
  }

  /* ======================================
   * SCREEN READER UTILITIES
   * ====================================== */
  .sr-only {
    position: absolute;
    width: var(--sr-only-width);
    height: var(--sr-only-height);
    padding: 0;
    margin: var(--sr-only-margin);
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
    clip-path: var(--sr-only-clip-path);
  }

  /* ======================================
   * RESPONSIVE DESIGN
   * ====================================== */
  @media (min-width: var(--breakpoint-md)) {
    .content-container {
      padding: var(--space-2xl) var(--space-lg);
    }
  }

  /* ======================================
   * REDUCED MOTION SUPPORT
   * ====================================== */
  @media (prefers-reduced-motion: reduce) {
    .logo-image,
    .primary-button {
      transition: none;
    }

    .logo-image:hover,
    .primary-button:hover,
    .primary-button:active {
      transform: none;
    }
  }

  /* ======================================
   * PRINT STYLES
   * ====================================== */
  @media print {
    .language-selector-wrapper {
      display: none;
    }

    .main-content {
      background: var(--print-bg);
      color: var(--print-text);
    }
  }
</style>

<script>
  /**
   * Performance-optimized client-side enhancements
   * Uses passive event listeners and requestIdleCallback for non-critical operations
   */
  document.addEventListener(
    "DOMContentLoaded",
    () => {
      // Use requestIdleCallback for non-critical operations
      const idleCallback =
        window.requestIdleCallback || ((cb: () => void): number => window.setTimeout(cb, 50));

      idleCallback(() => {
        // Register intersection observer for animation elements
        // This improves performance by only animating visible elements
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("animate-in");
                observer.unobserve(entry.target); // Stop observing once visible
              }
            });
          },
          { rootMargin: "0px", threshold: 0.1 }
        );

        // Observe animatable elements
        document.querySelectorAll(".animate-on-view").forEach((el) => {
          observer.observe(el);
        });
      });
    },
    { passive: true }
  ); // Performance optimization with passive listener
</script>
