---
import Layout from "@layouts/Layout.astro";
import { Picture } from "astro:assets";
import {
  getLangFromUrl,
  useTranslations,
  getRelativeLocaleUrl,
} from "@utils/i18n";
import { extractKeywords, generateMetaDescription } from "@utils/seo";
import LanguagePicker from "@components/LanguagePicker.astro";
import Headline from "@components/Headline.astro";
import Paragraph from "@components/Paragraph.astro";
import ButtonLink from "@components/ButtonLink.astro";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Dynamic redirect based on browser language
if (Astro.request.method === "GET" && !Astro.params.lang) {
  return Astro.redirect(
    getRelativeLocaleUrl(Astro.preferredLocale || "en", "/"),
  );
}

// Basic page content
const title = t("login.welcome");
const description = t("login.description");

// Enhanced SEO content using utility functions
const pageContent = `${title} ${description} ${t("index.welcome.footnote")}`;

// Generate optimized meta description and keywords
const optimizedDescription = generateMetaDescription(pageContent);
const keywords = extractKeywords(pageContent) || t("meta.keywords");

// Additional structured data parameters for SEO
const pageType = "website";
const publishDate = new Date("2024-01-01");
const modifiedDate = new Date();
---

<Layout
  title={title}
  description={optimizedDescription}
  keywords={keywords}
  image={`/og-images/social-share-home-${lang}.jpg`}
  type={pageType}
  publishDate={publishDate}
  modifiedDate={modifiedDate}
>
  <main class="min-h-screen flex items-center justify-cente text-zinc-50">
    <div
      class="max-w-4xl w-full mx-auto px-6 py-12 flex flex-col items-center text-center"
    >

      <div class="w-full flex-center">
        <!-- Logo with proper image optimization and accessibility -->
        <Picture
          class="w-full max-w-[240px] h-auto mx-auto mb-8 transition-transform duration-300 motion-safe:hover:scale-105"
          src="/social-share.jpg"
          width={480}
          height={480}
          formats={["avif", "webp"]}
          alt="Melody Mind Logo - Music Quiz App Logo"
          loading="eager"
        />

        <Headline
          level="h1"
          title={title}
          className="text-3xl md:text-4xl font-bold mb-6"
        />

        <Paragraph
          className="flex text-center items-center text-lg mb-8 text-zinc-100 leading-relaxed"
        >
          {description}
        </Paragraph>

        <div
          class="flex flex-col items-center gap-5 mt-6 w-full max-w-xs mx-auto"
        >
          <ButtonLink
            href={`/${lang}/gamehome`}
            aria-label={t("index.start.game.label")}
            className="w-full py-4 px-6 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 rounded-xl transform hover:scale-102 transition-all duration-300 shadow-lg focus:outline-none focus:ring-4 focus:ring-purple-400 focus:ring-opacity-50"
          >
            <span class="text-lg text-zinc-100 font-medium"
              >{t("index.continue")}</span
            >
          </ButtonLink>
        </div>

        <p class="mt-10 text-xl text-zinc-300">{t("index.welcome.footnote")}</p>
      </div>

      <!-- WCAG AAA Notice -->
      <p class="mt-6 text-xl text-zinc-200">
        <span role="img" aria-label="Accessibility">â™¿</span>
        {t("accessibility.wcag")}
      </p>
    </div>
  </main>
</Layout>

<style>
  /* Enhanced focus styles for accessibility */
  :global(:focus-visible) {
    outline: 3px solid #8b5cf6 !important;
    outline-offset: 3px !important;
    border-radius: 0.25rem;
  }

  /* Respect user preferences for reduced motion */
  @media (prefers-reduced-motion: reduce) {
    :global(*) {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
</style>
