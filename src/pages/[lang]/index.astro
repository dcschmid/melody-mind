---
/**
 * MelodyMind Homepage Component
 *
 * This component renders the main landing page of the MelodyMind app.
 * It implements WCAG AAA (7:1 contrast ratio) accessibility standards
 * and uses performance optimizations for fast loading and rendering.
 */
import Layout from "@layouts/Layout.astro";
import { Image } from "astro:assets";
import { getLangFromUrl, useTranslations, getRelativeLocaleUrl } from "@utils/i18n";
import { extractKeywords, generateMetaDescription } from "@utils/seo";
import Headline from "@components/Headline.astro";
import Paragraph from "@components/Paragraph.astro";
import ButtonLink from "@components/ButtonLink.astro";

// Extract language from URL and set up translations
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(String(lang));

/**
 * Dynamic redirect based on browser language preference
 * Ensures users land on their preferred language version
 */
if (Astro.request.method === "GET" && !Astro.params.lang) {
  return Astro.redirect(getRelativeLocaleUrl(Astro.preferredLocale || "en", "/"));
}

// Basic page content setup
const title = t("login.welcome");
const description = t("login.description");

/**
 * Enhanced SEO content generation
 * Combines various text elements for better keyword density and relevance
 */
const pageContent = `${title} ${description} ${t("index.welcome.footnote")}`;

// Generate optimized meta description and keyword set
const optimizedDescription = generateMetaDescription(pageContent);
const keywords = extractKeywords(pageContent) || t("meta.keywords");

// Structured data parameters for enhanced SEO
const pageType = "website";
const publishDate = new Date("2024-01-01");
const modifiedDate = new Date();
---

<Layout
  {title}
  description={optimizedDescription}
  {keywords}
  image={`/og-images/social-share-home-${String(lang)}.jpg`}
  type={pageType}
  {publishDate}
  {modifiedDate}
>
  <main id="main-content" class="main-content" tabindex="-1">
    <div class="m-auto" aria-hidden="true">
      <Image
        class="m-auto"
        src="/melody-mind.png"
        width={300}
        height={300}
        alt="Melody Mind Logo - Music Quiz App Logo"
        loading="eager"
        fetchpriority="high"
      />

      {/* Semantic heading with proper hierarchy */}
      <Headline level="h1" textAlign="center" className="my-8">
        {title}
      </Headline>

      {/* Description with enhanced contrast for AAA compliance */}
      <Paragraph textAlign="center" textSize="xl">
        {description}
      </Paragraph>

      {/* Accessible button container with increased touch targets */}
      <div class="m-auto my-8 max-w-3xs">
        <ButtonLink
          className="flex w-full"
          href={`/${String(lang)}/gamehome`}
          aria-label={t("index.start.game.label")}
        >
          <span>{t("index.continue")}</span>
        </ButtonLink>
      </div>

      {/* Footer text with improved contrast ratio */}
      <div class="footer-section">
        <Paragraph textSize="lg" textAlign="center">
          {t("index.welcome.footnote")}
        </Paragraph>
      </div>
    </div>
  </main>
</Layout>

<script>
  import { initIndexPageAuto } from "../../utils/components/indexPageUtils";

  // Initialize index page functionality
  initIndexPageAuto();
</script>
