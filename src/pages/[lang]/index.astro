---
/**
 * MelodyMind Homepage Component
 *
 * This component renders the main landing page of the MelodyMind app.
 * It implements WCAG AAA (7:1 contrast ratio) accessibility standards
 * and uses performance optimizations for fast loading and rendering.
 *
 * @author MelodyMind Team
 * @lastModified 2025-04-23
 */
import Layout from "@layouts/Layout.astro";
import { Image } from "astro:assets";
import {
  getLangFromUrl,
  useTranslations,
  getRelativeLocaleUrl,
} from "@utils/i18n";
import { extractKeywords, generateMetaDescription } from "@utils/seo";
import LanguagePicker from "@components/LanguagePicker.astro";
import Headline from "@components/Headline.astro";
import Paragraph from "@components/Paragraph.astro";
import ButtonLink from "@components/ButtonLink.astro";

// Extract language from URL and set up translations
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

/**
 * Dynamic redirect based on browser language preference
 * Ensures users land on their preferred language version
 */
if (Astro.request.method === "GET" && !Astro.params.lang) {
  return Astro.redirect(
    getRelativeLocaleUrl(Astro.preferredLocale || "en", "/"),
  );
}

// Basic page content setup
const title = t("login.welcome");
const description = t("login.description");

/**
 * Enhanced SEO content generation
 * Combines various text elements for better keyword density and relevance
 */
const pageContent = `${title} ${description} ${t("index.welcome.footnote")}`;

// Generate optimized meta description and keyword set
const optimizedDescription = generateMetaDescription(pageContent);
const keywords = extractKeywords(pageContent) || t("meta.keywords");

// Structured data parameters for enhanced SEO
const pageType = "website";
const publishDate = new Date("2024-01-01");
const modifiedDate = new Date();

/**
 * Define main logo image optimization parameters
 * This improves performance by loading appropriately sized images
 */
const imageWidth = 600;
const imageHeight = 600;
---

<Layout
  title={title}
  description={optimizedDescription}
  keywords={keywords}
  image={`/og-images/social-share-home-${lang}.jpg`}
  type={pageType}
  publishDate={publishDate}
  modifiedDate={modifiedDate}
>
  {/* Skip to content link for keyboard navigation accessibility */}
  <a
    href="#main-content"
    class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-purple-700 focus:text-white focus:font-medium focus:rounded focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-purple-700"
  >
    {t("accessibility.skip.to.content")}
  </a>

  <main
    id="main-content"
    class="min-h-screen flex items-center justify-center text-zinc-50"
    tabindex="-1"
  >
    <div
      class="max-w-4xl w-full mx-auto px-6 py-12 flex flex-col items-center text-center"
    >
      <div class="w-full flex flex-col items-center">
        {/* Logo with comprehensive image optimization and accessibility */}
        <div
          class="w-full max-w-[310px] mx-auto mb-8 aspect-square relative"
          aria-hidden="true"
        >
          <img
            src="/melody-mind.png"
            width={imageWidth}
            height={imageHeight}
            alt="Melody Mind Logo - Music Quiz App Logo"
            loading="eager"
            class="w-full h-auto transition-transform duration-300 motion-safe:hover:scale-105"
            fetchpriority="high"
          />
        </div>

        {/* Semantic heading with proper hierarchy */}
        <Headline
          level="h1"
          title={title}
          className="text-3xl md:text-4xl font-bold mb-6 text-white"
        />

        {/* Description with enhanced contrast for AAA compliance */}
        <Paragraph
          className="flex text-center items-center text-lg mb-8 text-white leading-relaxed max-w-2xl"
        >
          {description}
        </Paragraph>

        {/* Accessible button container with increased touch targets */}
        <div
          class="flex flex-col items-center gap-5 mt-6 w-full max-w-xs mx-auto"
        >
          <ButtonLink
            href={`/${lang}/gamehome`}
            aria-label={t("index.start.game.label")}
            className="w-full min-h-[56px] py-4 px-6 bg-gradient-to-r from-purple-700 to-indigo-700 hover:from-purple-600 hover:to-indigo-600 rounded-xl transform hover:scale-[1.02] transition-all duration-300 shadow-lg focus:outline-none focus:ring-4 focus:ring-purple-300 focus:ring-opacity-80 text-lg text-white font-medium flex items-center justify-center"
          >
            <span>{t("index.continue")}</span>
          </ButtonLink>
        </div>

        {/* Footer text with improved contrast ratio */}
        <p class="mt-10 text-xl text-white" aria-live="polite">
          {t("index.welcome.footnote")}
        </p>

        {/* Language selection with explicit label for accessibility */}
        <div class="mt-8" aria-labelledby="language-selector-label">
          <p id="language-selector-label" class="sr-only">
            {t("accessibility.language.selection")}
          </p>
        </div>
      </div>
    </div>
  </main>
</Layout>

<style>
  /* Enhanced focus styles for accessibility with improved contrast */
  :global(:focus-visible) {
    outline: 4px solid #a855f7 !important; /* Increased width and brighter color */
    outline-offset: 4px !important;
    border-radius: 0.25rem;
  }

  /* Respect user preferences for reduced motion */
  @media (prefers-reduced-motion: reduce) {
    :global(*) {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }

  /* High contrast mode support */
  @media (forced-colors: active) {
    :global(button),
    :global(a[role="button"]) {
      border: 2px solid ButtonText;
    }

    :global(:focus-visible) {
      outline: 3px solid Highlight !important;
    }
  }
</style>

<script>
  /**
   * Performance-optimized client-side enhancements
   * Uses passive event listeners and requestIdleCallback for non-critical operations
   */
  document.addEventListener(
    "DOMContentLoaded",
    () => {
      // Use requestIdleCallback for non-critical operations
      const idleCallback =
        window.requestIdleCallback || ((cb) => setTimeout(cb, 50));

      idleCallback(() => {
        // Register intersection observer for animation elements
        // This improves performance by only animating visible elements
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("animate-in");
                observer.unobserve(entry.target); // Stop observing once visible
              }
            });
          },
          { rootMargin: "0px", threshold: 0.1 },
        );

        // Observe animatable elements
        document.querySelectorAll(".animate-on-view").forEach((el) => {
          observer.observe(el);
        });
      });
    },
    { passive: true },
  ); // Performance optimization with passive listener
</script>
