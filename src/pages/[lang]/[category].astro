---
import { Picture } from "astro:assets";
import Layout from "@layouts/Layout.astro";
import Button from "@components/Shared/Button.astro";
import IntroText from "@components/Shared/IntroText.astro";
import { getRelativeLocaleUrl } from "astro:i18n";
import { useTranslations } from "@utils/i18n";

// Mark this route for static generation
export const prerender = true;

// Get static paths for all supported languages
export async function getStaticPaths() {
  const supportedLanguages = [
    "de",
    "en",
    "es",
    "fr",
    "it",
    "pt",
    "da",
    "nl",
    "sv",
    "fi",
  ] as const;

  const paths = [];

  for (const lang of supportedLanguages) {
    // Load categories based on language
    let categories;
    try {
      categories = await import(
        /* @vite-ignore */ `@json/${lang}_categories.json`
      );
    } catch (error) {
      // Fallback to default language if the specific language file doesn't exist
      categories = await import(/* @vite-ignore */ `@json/de_categories.json`);
    }

    // Create a path for each category
    for (const category of categories.default) {
      paths.push({
        params: { lang, category: category.slug },
        props: {
          categories: categories.default,
          category: category,
          lang,
        },
      });
    }
  }

  return paths;
}

// Get props from getStaticPaths
const { category, lang } = Astro.props;
const t = useTranslations(lang);

interface Category {
  slug: string;
  headline: string;
  introSubline: string;
  imageUrl: string;
  text: string;
}

// No login check needed anymore
const currentCategory = category;
---

<Layout title={`${currentCategory?.headline} Start`}>
  <IntroText
    headline={currentCategory?.headline + " " + t("category.selected")}
    subline={currentCategory?.introSubline}
  />

  <article
    class="flex flex-col items-center gap-6 w-full p-8 md:p-6 sm:p-4 rounded-lg bg-zinc-700 shadow-lg"
    data-category={currentCategory?.slug}
    aria-labelledby="difficulty-heading"
  >
    <div
      class="relative mx-auto"
      role="img"
      aria-label={currentCategory?.headline + " " + t("category.image.alt")}
    >
      {
        currentCategory?.imageUrl ? (
          <Picture
            class="w-full max-w-[280px] h-auto rounded-lg shadow-md hover:scale-105 hover:shadow-xl transition-all duration-300 motion-safe:transform motion-reduce:transition-none"
            src={currentCategory.imageUrl}
            width={280}
            height={280}
            formats={["avif", "webp"]}
            alt=""
            loading="eager"
          />
        ) : (
          <div class="flex items-center justify-center w-[280px] h-[280px] p-6 rounded-lg bg-zinc-800 shadow-md font-sans text-base text-zinc-50 text-center">
            {t("category.no_image_available")}
          </div>
        )
      }
    </div>

    <p class="max-w-[700px] mx-auto font-sans text-base leading-relaxed hyphens-auto text-zinc-50 text-center tracking-wide">
      {currentCategory?.text}
    </p>

    <div class="flex flex-col gap-6 items-center w-full">
      <h2 
        id="difficulty-heading" 
        class="font-sans text-xl font-bold leading-relaxed text-zinc-50 text-center"
      >
        {t("category.difficulty.heading")}
      </h2>
      
      <div
        class="flex flex-wrap justify-center gap-6 w-full p-1 sm:flex-col sm:max-w-[300px] sm:w-full"
        role="group"
        aria-label={t("category.difficulty.group")}
      >
        <Button
          buttonText={t("category.difficulty.easy")}
          url={getRelativeLocaleUrl(lang, `game-${currentCategory?.slug}/easy`)}
          aria-label={t("category.difficulty.easy.label")}
        />
        <Button
          buttonText={t("category.difficulty.medium")}
          url={getRelativeLocaleUrl(lang, `game-${currentCategory?.slug}/medium`)}
          aria-label={t("category.difficulty.medium.label")}
        />
        <Button
          buttonText={t("category.difficulty.hard")}
          url={getRelativeLocaleUrl(lang, `game-${currentCategory?.slug}/hard`)}
          aria-label={t("category.difficulty.hard.label")}
        />
      </div>
    </div>
  </article>
</Layout>

<style>
  /* High Contrast Mode Support */
  @media (forced-colors: active) {
    article[data-category] {
      border: 2px solid CanvasText;
    }

    [role="group"] :global(button) {
      border: 2px solid ButtonText;
    }
  }
</style>
