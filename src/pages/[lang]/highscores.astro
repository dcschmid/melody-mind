---
/**
 * Highscores Page
 *
 * This page displays the top scores across different game modes and categories.
 * Users can filter scores by game mode and category.
 *
 * Features:
 * - Display of top scores for quiz and chronology game modes
 * - Filtering by game mode and category with smooth transitions
 * - Responsive design using CSS custom properties from global.css
 * - WCAG AAA 2.2 compliant with enhanced accessibility features
 * - DRY-compliant implementation using maximum available root variables
 * - Performance optimized with proper CSS containment and transitions
 *
 * CSS Architecture:
 * - Uses BEM methodology for class naming consistency
 * - Leverages complete root variable system from global.css
 * - Implements responsive breakpoints with CSS custom properties
 * - Enhanced focus management and screen reader support
 * - Reduced motion and high contrast mode support
 *
 * URL: /[lang]/highscores
 */
import Layout from "@layouts/Layout.astro";
import { getLangFromUrl, useTranslations } from "@utils/i18n";
import { Icon } from "astro-icon/components";
import { formatDate } from "@utils/dateUtils";
import Headline from "@components/Headline.astro";
import Paragraph from "@components/Paragraph.astro";

// Interface for highscore entry
interface HighscoreEntry {
  id: string;
  username: string;
  gameMode: "quiz" | "chronology";
  score: number;
  category: string;
  createdAt: string;
}

// Get language from URL and initialize translations
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(String(lang));

// Default values
let highscores: HighscoreEntry[] = [];
let isLoading = true;
let error: string | null = null;

// Get filter parameters from URL
const url = Astro.url;
const searchParams = url.searchParams;
const selectedGameMode = searchParams.get("gameMode");
const selectedCategory = searchParams.get("category");

// Build API URL with filters
let apiUrl = `${Astro.url.origin}/${String(lang)}/api/scores/highscores`;
const apiParams = new URLSearchParams();

if (selectedGameMode) {
  apiParams.append("gameMode", selectedGameMode);
}

if (selectedCategory) {
  apiParams.append("category", selectedCategory);
}

if (apiParams.toString()) {
  apiUrl += `?${apiParams.toString()}`;
}

// Fetch highscores data from API endpoint with filters
try {
  const response = await fetch(apiUrl, {
    headers: {
      "Content-Type": "application/json",
    },
  });

  const data = await response.json();

  if (data.success) {
    highscores = data.highscores;
  } else {
    error = data.error || t("highscores.error");
  }
} catch (err) {
  console.error("Error fetching highscores data:", err);
  error = t("highscores.error");
} finally {
  isLoading = false;
}

// Format the date for display
const formatHighscoreDate = (dateString: string): string => {
  try {
    return formatDate(dateString, String(lang));
  } catch {
    return dateString;
  }
};

// Get unique categories from highscores for filter dropdown
const categories = [...new Set(highscores.map((score) => score.category))];

// Game mode names for display
const gameModeNames = {
  quiz: t("profile.stats.quiz"),
  chronology: t("profile.stats.chronology"),
};
---

<Layout title={t("highscores.title")} description={t("highscores.description")} type="website">
  <div class="highscores-container" id="main-content">
    <!-- Hero section styled like GameHome with improved contrast and accessibility -->
    <header class="highscores-hero" aria-labelledby="highscores-heading">
      <!-- Decorative background elements with aria-hidden -->
      <div class="highscores-hero__decoration" aria-hidden="true">
        <div class="highscores-hero__decoration-item highscores-hero__decoration-item--top-right">
        </div>
        <div class="highscores-hero__decoration-item highscores-hero__decoration-item--bottom-left">
        </div>
        <div
          class="highscores-hero__decoration-item highscores-hero__decoration-item--center-right"
        >
        </div>
      </div>

      <div class="highscores-hero__content">
        <Headline
          level="h1"
          id="highscores-heading"
          title={t("highscores.title")}
          className="highscores-hero__title"
          size="4xl"
        />
        <div class="highscores-hero__divider"></div>
        <Paragraph
          description={t("highscores.description")}
          className="highscores-hero__description"
          align="center"
        />
        <!-- Additional descriptive content for SEO -->
        <p class="highscores-hero__seo-description sr-only">
          {t("highscores.seo.description")}
        </p>
      </div>
    </header>

    {
      isLoading && (
        <section class="highscores__loading" aria-live="polite">
          <div class="highscores__loading-content">
            <Icon name="loading" class="highscores__loading-icon" aria-hidden="true" />
            <span class="sr-only">{t("common.loading")}</span>
          </div>
        </section>
      )
    }

    {
      error && (
        <section class="highscores__error" role="alert">
          <Paragraph description={error} />
        </section>
      )
    }

    {
      !isLoading && !error && (
        <div class="highscores__content">
          <section class="highscores__filters" aria-labelledby="filter-heading">
            <Headline
              level="h2"
              id="filter-heading"
              title={t("highscores.filters")}
              className="highscores__filter-title"
              textAlign="center"
            />

            <div class="highscores__filter-grid">
              <div class="highscores__filter-item">
                <label for="game-mode-filter" class="highscores__filter-label">
                  {t("highscores.gameMode")}
                </label>
                <select id="game-mode-filter" class="highscores__filter-select">
                  <option value="">{t("highscores.allModes")}</option>
                  <option value="quiz" selected={selectedGameMode === "quiz"}>
                    {gameModeNames.quiz}
                  </option>
                  <option value="chronology" selected={selectedGameMode === "chronology"}>
                    {gameModeNames.chronology}
                  </option>
                </select>
              </div>

              <div class="highscores__filter-item">
                <label for="category-filter" class="highscores__filter-label">
                  {t("highscores.category")}
                </label>
                <select id="category-filter" class="highscores__filter-select">
                  <option value="">{t("highscores.allCategories")}</option>
                  {categories.map((category) => (
                    <option value={category} selected={selectedCategory === category}>
                      {category}
                    </option>
                  ))}
                </select>
              </div>
            </div>
          </section>

          <section class="highscores__list" aria-labelledby="highscores-heading">
            <Headline
              level="h2"
              id="highscores-heading"
              title={t("highscores.results")}
              className="highscores__list-title"
              textAlign="center"
            />

            {highscores.length === 0 ? (
              <div class="highscores__empty" role="status">
                <Paragraph description={t("highscores.noResults")} />
              </div>
            ) : (
              <div
                class="highscores__cards-grid"
                role="list"
                aria-label={t("highscores.tableLabel")}
              >
                {highscores.map((score, index) => (
                  <article
                    class="highscores__card"
                    role="listitem"
                    aria-label={t("highscores.scoreEntry", {
                      rank: index + 1,
                      username: score.username,
                    })}
                  >
                    <div class="highscores__card-header">
                      <div class="highscores__card-rank">
                        <span
                          class={`highscores__rank highscores__rank--${index < 3 ? "medal" : "normal"}`}
                          aria-label={t("highscores.rank")}
                        >
                          {index + 1}
                        </span>
                      </div>
                      <div class="highscores__card-main">
                        <Headline
                          level="h3"
                          title={score.username}
                          className="highscores__card-username"
                        />
                        <div class="highscores__card-score">
                          <span class="highscores__score-value">{score.score}</span>
                          <span class="highscores__score-label">{t("highscores.points")}</span>
                        </div>
                      </div>
                    </div>

                    <div class="highscores__card-details">
                      <div class="highscores__card-detail">
                        <span class="highscores__card-detail-label">
                          {t("highscores.gameMode")}:
                        </span>
                        <span class="highscores__card-detail-value highscores__mode">
                          {gameModeNames[score.gameMode]}
                        </span>
                      </div>

                      <div class="highscores__card-detail">
                        <span class="highscores__card-detail-label">
                          {t("highscores.category")}:
                        </span>
                        <span class="highscores__card-detail-value highscores__category">
                          {score.category}
                        </span>
                      </div>

                      <div class="highscores__card-detail">
                        <span class="highscores__card-detail-label">{t("highscores.date")}:</span>
                        <time
                          class="highscores__card-detail-value highscores__date"
                          datetime={score.createdAt}
                        >
                          {formatHighscoreDate(score.createdAt)}
                        </time>
                      </div>
                    </div>
                  </article>
                ))}
              </div>
            )}
          </section>
        </div>
      )
    }
  </div>
</Layout>

<script>
  // Enhanced filter functionality for highscores
  document.addEventListener("DOMContentLoaded", () => {
    const gameModeFilter = document.getElementById("game-mode-filter") as HTMLSelectElement;
    const categoryFilter = document.getElementById("category-filter") as HTMLSelectElement;

    if (!gameModeFilter || !categoryFilter) {
      return;
    }

    // Function to update highscores based on filters
    const updateHighscores = (): void => {
      const gameMode = gameModeFilter.value;
      const category = categoryFilter.value;

      // Build query parameters
      const params = new URLSearchParams();
      if (gameMode) {
        params.append("gameMode", gameMode);
      }
      if (category) {
        params.append("category", category);
      }

      // Get current language from URL
      const lang = window.location.pathname.split("/")[1];

      // Reload the page with the new filters
      window.location.href = `/${String(lang)}/highscores?${params.toString()}`;
    };

    // Add event listeners to filters
    gameModeFilter.addEventListener("change", updateHighscores);
    categoryFilter.addEventListener("change", updateHighscores);

    // Set initial filter values from URL params if present
    const urlParams = new URLSearchParams(window.location.search);
    const gameModeParam = urlParams.get("gameMode");
    const categoryParam = urlParams.get("category");

    if (gameModeParam) {
      gameModeFilter.value = gameModeParam;
    }

    if (categoryParam) {
      categoryFilter.value = categoryParam;
    }
  });
</script>

<style lang="scss">
  /* ======================================
   * CSS CUSTOM PROPERTIES FOR COMPONENT
   * Enhanced with global.css variables matching GameHome
   * ====================================== */

  :root {
    /* Component-specific dimensions using global scale */
    --highscores-hero-decoration-sm: var(--space-2xl); /* 48px - Small decoration */
    --highscores-hero-decoration-md: var(--space-3xl); /* 64px - Medium decoration */
    --highscores-hero-decoration-lg: calc(var(--space-3xl) * 2); /* 128px - Large decoration */

    /* Layout constraints using design system */
    --highscores-content-max-width: 28rem; /* 448px - Content max width */

    /* Visual effects using global tokens */
    --highscores-hero-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); /* Hero text shadow */
    --highscores-divider-height: 2px; /* 2px - Divider height */
  }

  /* ======================================
   * HIGHSCORES CONTAINER LAYOUT 
   * Matching GameHome layout system for consistency
   * ====================================== */

  .highscores-container {
    width: var(--width-full);
    max-width: var(--container-xl);
    margin: 0 auto;
    padding: var(--space-lg) var(--space-md);
    min-height: 100vh;
    display: flex;
    flex-direction: column;

    @media (min-width: var(--breakpoint-md)) {
      padding: var(--space-xl) var(--space-lg);
    }
  }

  /* ======================================
   * HERO SECTION STYLING
   * Matching GameHome hero pattern exactly
   * ====================================== */

  .highscores-hero {
    position: relative;
    margin-bottom: var(--space-2xl);
    overflow: hidden;
    border-radius: var(--radius-xl);
    background: linear-gradient(
      135deg,
      var(--color-primary-900) 0%,
      var(--color-primary-700) 50%,
      var(--color-secondary-800) 100%
    );
    padding: var(--space-xl);
    box-shadow: var(--shadow-xl);
    border: var(--border-width-thin) solid var(--border-primary);

    @media (min-width: 768px) {
      padding: var(--space-2xl) var(--space-xl);
    }

    &__decoration {
      position: absolute;
      inset: 0;
      opacity: 0.1;
      pointer-events: none;

      &-item {
        position: absolute;
        border-radius: var(--radius-full);
        background: var(--color-white);

        &--top-right {
          top: calc(-1 * var(--space-xl));
          right: calc(-1 * var(--space-xl));
          width: var(--highscores-hero-decoration-md);
          height: var(--highscores-hero-decoration-md);
        }

        &--bottom-left {
          bottom: calc(-1 * var(--space-2xl));
          left: calc(-1 * var(--space-2xl));
          width: var(--highscores-hero-decoration-lg);
          height: var(--highscores-hero-decoration-lg);
        }

        &--center-right {
          top: 50%;
          right: calc(-1 * var(--space-md));
          width: var(--highscores-hero-decoration-sm);
          height: var(--highscores-hero-decoration-sm);
          transform: translateY(-50%);
        }
      }
    }

    &__content {
      position: relative;
      z-index: 1;
      text-align: center;
      color: var(--color-white);
    }

    &__title {
      margin-bottom: var(--space-lg);
      color: var(--color-white);
      text-shadow: var(--highscores-hero-shadow);
    }

    &__divider {
      width: var(--space-2xl);
      height: var(--highscores-divider-height);
      background: var(--color-secondary-400);
      margin: var(--space-lg) auto;
      border-radius: var(--radius-full);
    }

    &__description {
      color: var(--color-neutral-100);
      font-size: var(--text-xl);
      line-height: var(--leading-relaxed);
      max-width: var(--highscores-content-max-width);
      margin: 0 auto;
    }

    &__seo-description {
      /* SEO content hidden visually but available to screen readers */
    }
  }

  /* ======================================
   * RESPONSIVE DESIGN ENHANCEMENTS
   * Matching GameHome responsive patterns
   * ====================================== */

  @media (min-width: 1024px) {
    .highscores-hero__title {
      font-size: var(--text-4xl);
    }

    .highscores-hero__description {
      font-size: var(--text-2xl);
    }
  }

  /* ======================================
   * ACCESSIBILITY ENHANCEMENTS
   * Matching GameHome accessibility patterns
   * ====================================== */

  @media (prefers-reduced-motion: reduce) {
    .highscores-hero__decoration-item {
      animation: none;
    }

    .highscores__loading-icon {
      animation: none;
    }
  }

  @media (prefers-contrast: high) {
    .highscores-hero {
      border-width: var(--border-width-thick);
    }
  }

  /* ======================================
   * LOADING STATE
   * ====================================== */
  .highscores__loading {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: calc(var(--container-sm) * 0.4);
    padding: var(--space-xl);
    margin: var(--space-xl) auto;

    &-content {
      text-align: center;
    }

    &-icon {
      width: var(--icon-size-lg);
      height: var(--icon-size-lg);
      color: var(--interactive-primary);
      animation: loading-spin var(--animation-pulse-duration) linear infinite;
    }
  }

  @keyframes loading-spin {
    from {
      transform: rotate(var(--rotation-0));
    }
    to {
      transform: rotate(var(--rotation-270));
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(var(--space-md));
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* ======================================
   * ERROR STATE
   * ====================================== */
  .highscores__error {
    background-color: var(--bg-error-aaa);
    border: var(--border-width-thin) solid var(--border-error);
    border-radius: var(--radius-md);
    padding: var(--space-lg);
    margin: var(--space-xl) auto;
    max-width: var(--container-sm);
    text-align: center;
  }

  /* ======================================
   * CONTENT SECTION
   * ====================================== */
  .highscores__content {
    margin-top: var(--space-2xl);
    line-height: var(--leading-enhanced);
  }

  /* ======================================
   * CONTENT LAYOUT
   * ====================================== */
  /* ======================================
   * FILTER SECTION STYLING
   * Consistent with GameHome search pattern
   * ====================================== */
  .highscores__filters {
    background-color: var(--card-bg);
    border: var(--border-width-thin) solid var(--card-border);
    border-radius: var(--radius-lg);
    padding: var(--space-xl);
    box-shadow: var(--card-shadow);
    transition: box-shadow var(--transition-normal);
    margin-bottom: var(--space-xl);

    &:hover {
      box-shadow: var(--card-shadow-hover);
    }
  }

  .highscores__filter-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-lg);
    max-width: var(--container-sm);
    margin: 0 auto;

    @media (min-width: var(--breakpoint-sm)) {
      grid-template-columns: 1fr 1fr;
    }
  }

  .highscores__filter-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .highscores__filter-label {
    font-size: var(--text-base);
    font-weight: var(--font-medium);
    color: var(--form-label);
    line-height: var(--leading-enhanced);
  }

  .highscores__filter-select {
    width: var(--width-full);
    padding: var(--space-md);
    background-color: var(--form-bg);
    border: var(--border-width-thin) solid var(--form-border);
    border-radius: var(--radius-md);
    color: var(--form-text);
    font-size: var(--text-base);
    line-height: var(--leading-normal);
    min-height: var(--min-touch-size);
    transition:
      border-color var(--transition-fast),
      box-shadow var(--transition-fast);
    box-shadow: var(--shadow-lg);

    &:focus {
      outline: var(--focus-outline);
      outline-offset: var(--focus-ring-offset);
      border-color: var(--form-border-focus);
      box-shadow: var(--focus-ring);
    }

    &:focus-visible {
      outline: var(--focus-outline);
      outline-offset: var(--focus-ring-offset);
    }
  }

  /* ======================================
   * RESULTS SECTION
   * ====================================== */

  .highscores__empty {
    text-align: center;
    padding: var(--space-2xl) var(--space-lg);
    border-radius: var(--radius-md);
    background-color: var(--bg-tertiary);
    border: var(--border-width-thin) solid var(--border-secondary);
    margin: var(--space-xl) auto;
    max-width: var(--container-sm);
  }

  /* ======================================
   * CARDS GRID LAYOUT
   * Matching GameHome grid system for consistency
   * ====================================== */
  .highscores__cards-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-lg);
    margin: var(--space-xl) auto;
    width: var(--width-full);
    min-height: calc(var(--container-sm) * 0.4);
    contain: layout style;

    /* Mobile first: 1 column by default */
    /* --breakpoint-xs: 20em (320px) */
    @media (min-width: 40em) {
      grid-template-columns: repeat(2, 1fr);
    }

    /* --breakpoint-md: 48em (768px) */
    @media (min-width: 64em) {
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-xl);
    }
  }

  /* ======================================
   * INDIVIDUAL CARD STYLING
   * ====================================== */
  .highscores__card {
    position: relative;
    display: flex;
    flex-direction: column;
    height: 100%;
    padding: var(--space-lg);
    background: linear-gradient(
      135deg,
      var(--card-bg) 0%,
      color-mix(in srgb, var(--card-bg) 95%, var(--interactive-primary) 5%) 100%
    );
    border: var(--border-width-thin) solid var(--card-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--card-shadow);
    transition: all var(--transition-normal);
    overflow: hidden;
    contain: layout style;

    /* Subtle inner glow */
    box-shadow:
      var(--card-shadow),
      inset 0 1px 0 oklch(from var(--interactive-primary) l c h / 0.1);

    /* Beautiful hover states with enhanced visual feedback */
    &:hover {
      transform: translateY(calc(-1 * var(--space-xs)));
      box-shadow:
        var(--card-shadow-hover),
        0 0 var(--space-2xl) oklch(from var(--interactive-primary) l c h / 0.15),
        inset 0 1px 0 oklch(from var(--interactive-primary) l c h / 0.2);
      border-color: var(--interactive-primary);
      background: linear-gradient(
        135deg,
        var(--card-bg) 0%,
        color-mix(in srgb, var(--card-bg) 90%, var(--interactive-primary) 10%) 100%
      );

      &::before {
        opacity: 1;
      }
    }

    /* Focus states for accessibility */
    &:focus-visible {
      outline: var(--focus-outline);
      outline-offset: var(--focus-ring-offset);
      box-shadow: var(--card-shadow-hover), var(--focus-enhanced-shadow);
    }

    /* Decorative accent line */
    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: var(--border-width-enhanced);
      background: linear-gradient(
        90deg,
        var(--interactive-primary) 0%,
        var(--interactive-secondary) 50%,
        var(--interactive-primary) 100%
      );
      opacity: 0.7;
      transition: opacity var(--transition-normal);
    }

    /* ======================================
     * ENHANCED CARD HEADER WITH BEAUTIFUL LAYOUT
     * ====================================== */
    &-header {
      display: flex;
      align-items: center;
      gap: var(--space-lg);
      margin-bottom: var(--space-lg);
      padding-bottom: var(--space-md);
      border-bottom: var(--border-width-thin) solid
        color-mix(in srgb, var(--border-primary) 70%, transparent 30%);
      position: relative;
    }

    /* Rank badge with beautiful styling */
    &-rank {
      flex-shrink: 0;
    }
  }

  .highscores__rank {
    display: flex;
    align-items: center;
    justify-content: center;
    width: var(--space-3xl);
    height: var(--space-3xl);
    border-radius: var(--radius-full);
    font-size: var(--text-lg);
    font-weight: var(--font-bold);
    background: linear-gradient(
      135deg,
      var(--bg-tertiary) 0%,
      color-mix(in srgb, var(--bg-tertiary) 80%, var(--interactive-primary) 20%) 100%
    );
    border: var(--border-width-thin) solid var(--border-secondary);
    color: var(--text-primary);
    transition: all var(--transition-normal);
    position: relative;
    overflow: hidden;

    /* Animated shine effect on rank badges */
    &::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        45deg,
        transparent 30%,
        oklch(from var(--interactive-primary) l c h / 0.3) 50%,
        transparent 70%
      );
      transform: translateX(-100%);
      transition: transform var(--animation-duration-slow);
    }

    &:hover {
      transform: var(--animation-scale-hover-subtle);
      box-shadow:
        0 0 var(--space-lg) oklch(from var(--interactive-primary) l c h / 0.3),
        inset 0 1px 0 oklch(from var(--color-white) l c h / 0.2);
    }

    /* Medal styling for top 3 positions */
    &--medal {
      background: linear-gradient(
        135deg,
        var(--achievement-gold) 0%,
        color-mix(in srgb, var(--achievement-gold) 80%, var(--color-white) 20%) 100%
      );
      color: var(--color-black);
      border-color: var(--achievement-gold);
      box-shadow:
        0 0 var(--space-md) oklch(from var(--achievement-gold) l c h / 0.4),
        inset 0 1px 0 oklch(from var(--color-white) l c h / 0.3);
    }
  }

  .highscores__card:hover .highscores__rank::before {
    transform: translateX(100%);
  }

  /* Silver and bronze variations */
  .highscores__card:nth-child(2) .highscores__rank--medal {
    background: linear-gradient(
      135deg,
      var(--achievement-silver) 0%,
      color-mix(in srgb, var(--achievement-silver) 80%, var(--color-white) 20%) 100%
    );
    border-color: var(--achievement-silver);
    box-shadow:
      0 0 var(--space-md) oklch(from var(--achievement-silver) l c h / 0.4),
      inset 0 1px 0 oklch(from var(--color-white) l c h / 0.3);
  }

  .highscores__card:nth-child(3) .highscores__rank--medal {
    background: linear-gradient(
      135deg,
      var(--achievement-bronze) 0%,
      color-mix(in srgb, var(--achievement-bronze) 80%, var(--color-white) 20%) 100%
    );
    border-color: var(--achievement-bronze);
    box-shadow:
      0 0 var(--space-md) oklch(from var(--achievement-bronze) l c h / 0.4),
      inset 0 1px 0 oklch(from var(--color-white) l c h / 0.3);
  }

  /* ======================================
   * BEAUTIFUL USERNAME AND SCORE SECTION
   * ====================================== */
  .highscores__card-main {
    flex: 1;
    min-width: 0;
  }

  .highscores__card-score {
    display: flex;
    align-items: baseline;
    gap: var(--space-sm);
    flex-wrap: wrap;
  }

  .highscores__score-value {
    font-size: var(--text-2xl);
    font-weight: var(--font-bold);
    background: linear-gradient(
      135deg,
      var(--interactive-primary) 0%,
      var(--interactive-secondary) 100%
    );
    background-clip: text;
    -webkit-background-clip: text;
    color: transparent;
    line-height: var(--leading-tight);
    position: relative;

    /* Fallback for browsers that don't support background-clip: text */
    @supports not (background-clip: text) {
      color: var(--interactive-primary);
    }
  }

  .highscores__score-label {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    font-weight: var(--font-medium);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* ======================================
   * ENHANCED CARD DETAILS WITH BETTER LAYOUT
   * ====================================== */
  .highscores__card-details {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-md);
    margin-top: var(--space-lg);
    padding-top: var(--space-lg);
    border-top: var(--border-width-thin) solid
      color-mix(in srgb, var(--border-primary) 50%, transparent 50%);
  }

  .highscores__card-detail {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-md);
    padding: var(--space-sm) var(--space-md);
    background: color-mix(in srgb, var(--bg-tertiary) 60%, transparent 40%);
    border-radius: var(--radius-sm);
    border: var(--border-width-thin) solid
      color-mix(in srgb, var(--border-primary) 30%, transparent 70%);
    transition: all var(--transition-normal);
    min-height: var(--space-2xl);

    &:hover {
      background: color-mix(in srgb, var(--bg-tertiary) 80%, var(--interactive-primary) 5%);
      border-color: color-mix(in srgb, var(--border-primary) 80%, var(--interactive-primary) 20%);
      transform: translateX(var(--space-xs));
    }

    &-label {
      font-size: var(--text-sm);
      font-weight: var(--font-semibold);
      color: var(--text-secondary);
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: var(--space-xs);

      /* Add subtle icons using CSS for visual enhancement */
      &::before {
        content: "";
        width: var(--space-sm);
        height: var(--space-sm);
        border-radius: var(--radius-sm);
        background: var(--interactive-primary);
        opacity: 0.6;
        flex-shrink: 0;
      }
    }

    &-value {
      font-size: var(--text-sm);
      color: var(--text-primary);
      font-weight: var(--font-medium);
      text-align: right;
    }
  }

  /* Special styling for different detail types */
  .highscores__mode {
    color: var(--interactive-secondary);
    font-weight: var(--font-semibold);
    text-transform: capitalize;
  }

  .highscores__category {
    color: var(--text-primary);
    font-weight: var(--font-medium);
  }

  .highscores__date {
    color: var(--text-tertiary);
    font-size: var(--text-xs);
    font-variant-numeric: tabular-nums;
  }

  /* ======================================
   * RESPONSIVE IMPROVEMENTS FOR BEAUTIFUL CARDS
   * ====================================== */
  @media (min-width: var(--breakpoint-sm)) {
    .highscores__card-details {
      grid-template-columns: 1fr 1fr;
      gap: var(--space-md) var(--space-lg);
    }
  }

  @media (min-width: var(--breakpoint-md)) {
    .highscores__card {
      padding: var(--space-xl);

      &-header {
        margin-bottom: var(--space-xl);
        padding-bottom: var(--space-lg);
      }

      &-details {
        grid-template-columns: 1fr;
        gap: var(--space-md);
      }

      &-detail {
        justify-content: space-between;

        &-label {
          min-width: auto;
        }
      }
    }
  }

  /* Container queries for enhanced responsive cards */
  @container (min-width: 20rem) {
    .highscores__card-details {
      grid-template-columns: 1fr 1fr;
      gap: var(--space-sm) var(--space-md);
    }
  }

  @container (min-width: 24rem) {
    .highscores__card-header {
      flex-direction: row;
      align-items: center;
    }

    .highscores__card-details {
      grid-template-columns: 1fr;
    }
  }

  /* ======================================
   * ACCESSIBILITY ENHANCEMENTS
   * ====================================== */

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .highscores__loading-icon,
    .highscores__rank,
    .highscores__card {
      animation: none;
      transition: var(--transition-instant); /* Using available variable for reduced motion */
    }

    .highscores__card:hover {
      transform: none;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .highscores__card {
      border: var(--border-width-thick) solid var(--text-primary);

      &-header {
        border-bottom: var(--border-width-thick) solid var(--text-primary);
      }
    }

    .highscores__rank--medal {
      background: var(--text-primary);
      color: var(--bg-primary);
    }

    .highscores__mode {
      border: var(--border-width-thick) solid var(--text-primary);
    }
  }

  /* Print styles optimized for GameHome consistency */
  @media print {
    .highscores__filters {
      display: none;
    }

    .highscores-container {
      padding: var(--space-md);
      max-width: var(--width-full);
    }

    .highscores-hero {
      background: var(--print-bg);
      box-shadow: none;
      border: var(--border-width-thin) solid var(--print-border);
    }

    .highscores__cards-grid {
      grid-template-columns: 1fr 1fr;
      gap: var(--space-md);
    }

    .highscores__card {
      border: var(--border-width-thin) solid var(--print-border);
      background: var(--print-bg);
      color: var(--print-text);
      page-break-inside: avoid;
      box-shadow: none;
      padding: var(--space-sm);
      font-size: var(--text-sm);

      &-header {
        margin-bottom: var(--space-md);
        padding-bottom: var(--space-sm);
        border-bottom: var(--border-width-thin) solid var(--print-border);
      }

      &-username {
        font-size: var(--text-base);
      }

      &-detail-label,
      &-detail-value {
        font-size: var(--text-xs);
      }
    }

    .highscores__score-value {
      font-size: var(--text-lg);
    }

    .highscores__rank--medal {
      background: var(--print-text) !important;
      color: var(--print-bg) !important;
    }
  }
</style>
