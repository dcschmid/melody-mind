---
/**
 * @component DatenschutzPage
 * @description Dynamic datenschutz page with responsive SCSS styling and modern TypeScript
 */

import { languages } from "../../i18n/ui";
import { getLangFromUrl } from "../../utils/i18n";
import Layout from "../../layouts/Layout.astro";

// Enable prerendering for static generation
export const prerender = true;

// Define TypeScript interfaces
interface StaticPath {
  params: {
    lang: string;
  };
}

interface DatenschutzData {
  title: string;
  lastUpdated: string;
  sections: Array<{
    title: string;
    content: string;
  }>;
}

// Get static paths for all supported languages
export const getStaticPaths = async (): Promise<StaticPath[]> => {
  const paths: StaticPath[] = [];

  // Generate paths for all supported languages using modern ES6
  Object.keys(languages).forEach((lang) => {
    paths.push({
      params: { lang },
    });
  });

  return paths;
};

// Get current language
const lang = getLangFromUrl(Astro.url);

// Languages that have native legal pages
const nativeLanguages = ["de"];

// If this is not German, redirect to German datenschutz
if (!nativeLanguages.includes(lang)) {
  return Astro.redirect("/de/datenschutz", 302);
}

// If this is German but accessed through dynamic route, redirect to static route
if (lang === "de") {
  return Astro.redirect("/de/datenschutz", 301);
}

// Datenschutz data (this would normally come from a CMS or i18n files)
const datenschutzData: DatenschutzData = {
  title: "Datenschutzerklärung",
  lastUpdated: "2024-01-15",
  sections: [
    {
      title: "Datenerhebung",
      content:
        "Wir erheben nur die Daten, die für die Bereitstellung unserer Dienste erforderlich sind.",
    },
    {
      title: "Datennutzung",
      content: "Ihre Daten werden ausschließlich für die Verbesserung unserer Dienste verwendet.",
    },
    {
      title: "Datenschutz",
      content:
        "Wir setzen alle erforderlichen technischen und organisatorischen Maßnahmen zum Schutz Ihrer Daten ein.",
    },
  ],
};
---

<Layout {title} {description} type="website" showHeader={true} showHeaderIcons={true}>
  <main class="legal-page">
    <div class="container">
      <header class="legal-page__header">
        <Headline level="h1" className="legal-page__title">Datenschutzerklärung</Headline>
        <Paragraph className="legal-page__subtitle">
          Informationen zur Verarbeitung Ihrer personenbezogenen Daten
        </Paragraph>
        <Paragraph className="legal-page__date">
          Zuletzt aktualisiert: {new Date().toLocaleDateString("de-DE")}
        </Paragraph>
      </header>

      <div class="legal-page__content">
        <section class="legal-section">
          <Headline level="h2" className="legal-section__title"
            >1. Datenschutz auf einen Blick</Headline
          >
          <div class="legal-section__content">
            <Headline level="h3">Allgemeine Hinweise</Headline>
            <Paragraph>
              Die folgenden Hinweise geben einen einfachen Überblick darüber, was mit Ihren
              personenbezogenen Daten passiert, wenn Sie diese Website besuchen. Personenbezogene
              Daten sind alle Daten, mit denen Sie persönlich identifiziert werden können.
            </Paragraph>

            <Headline level="h3">Datenerfassung auf dieser Website</Headline>
            <Paragraph>
              <strong>Wer ist verantwortlich für die Datenerfassung auf dieser Website?</strong>
            </Paragraph>
            <Paragraph>
              Die Datenverarbeitung auf dieser Website erfolgt durch den Websitebetreiber. Die
              Kontaktdaten des Betreibers können Sie dem Abschnitt "Hinweise zur Verantwortlichen
              Stelle" in dieser Datenschutzerklärung entnehmen.
            </Paragraph>

            <Paragraph>
              <strong>Wie erfassen wir Ihre Daten?</strong>
            </Paragraph>
            <Paragraph>
              Ihre Daten werden zum einen dadurch erhoben, dass Sie uns diese mitteilen. Hierbei
              kann es sich z. B. um Daten handeln, die Sie in ein Kontaktformular eingeben.
            </Paragraph>
            <Paragraph>
              Andere Daten werden automatisch oder nach Ihrer Einwilligung beim Besuch der Website
              durch unsere IT-Systeme erfasst. Das sind vor allem technische Daten (z. B.
              Internetbrowser, Betriebssystem oder Uhrzeit des Seitenaufrufs).
            </Paragraph>
          </div>
        </section>

        <section class="legal-section">
          <Headline level="h2" className="legal-section__title">2. Hosting</Headline>
          <div class="legal-section__content">
            <Headline level="h3">Hosting mit Render</Headline>
            <Paragraph>
              Wir hosten die Inhalte unserer Website bei Render Services, Inc., 525 Brannan Street,
              Suite 300, San Francisco, CA 94107, USA.
            </Paragraph>
            <Paragraph>
              Wenn Sie unsere Website besuchen, erfasst Render verschiedene Logfiles inklusive Ihrer
              IP-Adressen. Details können Sie der Datenschutzerklärung von Render entnehmen:
              <a
                href="https://render.com/privacy"
                class="legal-link"
                target="_blank"
                rel="noopener noreferrer"
              >
                render.com/privacy
              </a>
            </Paragraph>
            <Paragraph>
              Die Nutzung erfolgt auf Grundlage von Art. 6 Abs. 1 lit. f DSGVO. Wir haben ein
              berechtigtes Interesse an einer zuverlässigen Darstellung unserer Website.
            </Paragraph>
          </div>
        </section>

        <section class="legal-section">
          <Headline level="h2" className="legal-section__title">
            3. Allgemeine Hinweise und Pflichtinformationen
          </Headline>
          <div class="legal-section__content">
            <Headline level="h3">Datenschutz</Headline>
            <Paragraph>
              Die Betreiber dieser Seiten nehmen den Schutz Ihrer persönlichen Daten sehr ernst. Wir
              behandeln Ihre personenbezogenen Daten vertraulich und entsprechend den gesetzlichen
              Datenschutzvorschriften sowie dieser Datenschutzerklärung.
            </Paragraph>

            <Headline level="h3">Hinweise zur verantwortlichen Stelle</Headline>
            <Paragraph
              >Die verantwortliche Stelle für die Datenverarbeitung auf dieser Website ist:</Paragraph
            >
            <div class="contact-info">
              <Paragraph>
                <strong>Daniel Schmid</strong><br />
                Hiltenspergerstr. 78<br />
                80796 München<br />
                Deutschland
              </Paragraph>
              <Paragraph>
                <strong>E-Mail:</strong>
                <a href="mailto:dcschmid@murena.io" class="legal-link">dcschmid@murena.io</a>
              </Paragraph>
            </div>

            <Headline level="h3">Speicherdauer</Headline>
            <Paragraph>
              Soweit innerhalb dieser Datenschutzerklärung keine speziellere Speicherdauer genannt
              wurde, verbleiben Ihre personenbezogenen Daten bei uns, bis der Zweck für die
              Datenverarbeitung entfällt.
            </Paragraph>
          </div>
        </section>

        <section class="legal-section">
          <Headline level="h2">4. Datenerfassung auf dieser Website</Headline>
          <div class="legal-section__content">
            <Headline level="h3">Server-Log-Dateien</Headline>
            <Paragraph>
              Der Provider der Seiten erhebt und speichert automatisch Informationen in so genannten
              Server-Log-Dateien, die Ihr Browser automatisch an uns übermittelt. Dies sind:
            </Paragraph>
            <ul class="legal-list">
              <li>Browsertyp und Browserversion</li>
              <li>verwendetes Betriebssystem</li>
              <li>Referrer URL</li>
              <li>Hostname des zugreifenden Rechners</li>
              <li>Uhrzeit der Serveranfrage</li>
              <li>IP-Adresse</li>
            </ul>
            <Paragraph>
              Eine Zusammenführung dieser Daten mit anderen Datenquellen wird nicht vorgenommen. Die
              Erfassung dieser Daten erfolgt auf Grundlage von Art. 6 Abs. 1 lit. f DSGVO.
            </Paragraph>

            <Headline level="h3">Spieldaten und Highscores</Headline>
            <Paragraph>
              Wenn Sie MelodyMind spielen, werden folgende Daten in unserer TursoDB-Datenbank
              gespeichert:
            </Paragraph>
            <ul class="legal-list">
              <li>Ihr gewählter Benutzername</li>
              <li>Ihre Spielergebnisse und Punktzahlen</li>
              <li>Spielstatistiken (gespielte Runden, Kategorien, Schwierigkeitsgrade)</li>
              <li>Ihre Spracheinstellung</li>
              <li>Achievements und freigeschaltete Inhalte</li>
            </ul>
            <Paragraph>
              Diese Daten werden sicher in unserer TursoDB-Datenbank gespeichert, um Ihnen
              persistenten Spielstand zu bieten und Funktionen wie Highscores und Achievements zu
              ermöglichen. Sie können jederzeit die Löschung Ihrer Daten anfordern, indem Sie uns
              kontaktieren:
              <a href="mailto:dcschmid@murena.io" class="legal-link">dcschmid@murena.io</a>.
            </Paragraph>
            <Paragraph>
              Die Rechtsgrundlage für diese Verarbeitung ist Art. 6 Abs. 1 lit. b DSGVO
              (Vertragserfüllung) und Art. 6 Abs. 1 lit. f DSGVO (berechtigtes Interesse an der
              Bereitstellung von Spielfunktionen).
            </Paragraph>
          </div>
        </section>

        <section class="legal-section">
          <Headline level="h2">5. Cookies und Local Storage</Headline>
          <div class="legal-section__content">
            <Headline level="h3">Cookies</Headline>
            <Paragraph>
              Unsere Website verwendet Cookies. Das sind kleine Textdateien, die Ihr Webbrowser auf
              Ihrem Endgerät speichert. Wir verwenden nur technisch notwendige Cookies für:
            </Paragraph>
            <ul class="legal-list">
              <li>Speicherung Ihrer Spracheinstellung</li>
              <li>Aufrechterhaltung Ihrer Spielsession</li>
              <li>Spielfunktionalität</li>
            </ul>
            <Paragraph>
              Diese Cookies sind für die Funktionsfähigkeit der Website erforderlich und werden auf
              Grundlage von Art. 6 Abs. 1 lit. f DSGVO gespeichert.
            </Paragraph>

            <Headline level="h3">Local Storage</Headline>
            <Paragraph>
              Ihre Spielpunkte und Einstellungen werden im Local Storage Ihres Browsers gespeichert.
              Diese Daten bleiben lokal und werden nicht übertragen.
            </Paragraph>
          </div>
        </section>

        <section class="legal-section">
          <Headline level="h2">6. Ihre Rechte</Headline>
          <div class="legal-section__content">
            <Paragraph>Sie haben folgende Rechte bezüglich Ihrer personenbezogenen Daten:</Paragraph
            >
            <ul class="legal-list">
              <li><strong>Recht auf Auskunft</strong> (Art. 15 DSGVO)</li>
              <li><strong>Recht auf Berichtigung</strong> (Art. 16 DSGVO)</li>
              <li><strong>Recht auf Löschung</strong> (Art. 17 DSGVO)</li>
              <li><strong>Recht auf Einschränkung der Verarbeitung</strong> (Art. 18 DSGVO)</li>
              <li><strong>Recht auf Datenübertragbarkeit</strong> (Art. 20 DSGVO)</li>
              <li><strong>Widerspruchsrecht</strong> (Art. 21 DSGVO)</li>
              <li>
                <strong>Recht auf Beschwerde bei einer Aufsichtsbehörde</strong> (Art. 77 DSGVO)
              </li>
            </ul>
            <Paragraph>
              Wenn Sie diese Rechte ausüben möchten, kontaktieren Sie uns bitte:
              <a href="mailto:dcschmid@murena.io" class="legal-link">dcschmid@murena.io</a>
            </Paragraph>
          </div>
        </section>

        <section class="legal-section">
          <Headline level="h2">7. Analyse-Tools</Headline>
          <div class="legal-section__content">
            <Headline level="h3">Fathom Analytics</Headline>
            <Paragraph>
              Wir verwenden Fathom Analytics, einen datenschutzfreundlichen Analyse-Service, um
              besser zu verstehen, wie Besucher mit unserer Website interagieren. Fathom Analytics
              ist DSGVO-, CCPA- und PECR-konform und verwendet keine Cookies oder sammelt
              personenbezogene Daten.
            </Paragraph>
            <Paragraph>Fathom Analytics erfasst anonymisierte Daten einschließlich:</Paragraph>
            <ul class="legal-list">
              <li>Seitenaufrufe und Besucherzahlen</li>
              <li>Referrer-Informationen (von welcher Website Sie kamen)</li>
              <li>Allgemeiner Standort (nur Länderebene)</li>
              <li>Geräte- und Browser-Informationen (anonymisiert)</li>
            </ul>
            <Paragraph>
              Diese Daten werden anonym verarbeitet und können nicht zur Identifizierung einzelner
              Nutzer verwendet werden. Weitere Informationen finden Sie in der Datenschutzerklärung
              von Fathom:
              <a
                href="https://usefathom.com/privacy"
                class="legal-link"
                target="_blank"
                rel="noopener noreferrer"
              >
                usefathom.com/privacy
              </a>
            </Paragraph>
            <Paragraph>
              Die Rechtsgrundlage für diese Verarbeitung ist Art. 6 Abs. 1 lit. f DSGVO
              (berechtigtes Interesse an der Analyse der Website-Nutzung zur Verbesserung unserer
              Dienste).
            </Paragraph>
          </div>
        </section>

        <section class="legal-section">
          <Headline level="h2">8. Kontakt und Beschwerden</Headline>
          <div class="legal-section__content">
            <Paragraph>
              Wenn Sie Fragen zum Datenschutz haben, Ihre Rechte ausüben möchten oder Beschwerden
              haben, können Sie uns jederzeit kontaktieren:
            </Paragraph>
            <div class="contact-info">
              <Paragraph>
                <strong>Datenschutz-Kontakt:</strong><br />
                E-Mail: <a href="mailto:dcschmid@murena.io" class="legal-link">dcschmid@murena.io</a
                ><br />
                Adresse: Daniel Schmid, Hiltenspergerstr. 78, 80796 München, Deutschland
              </Paragraph>
            </div>
            <Paragraph>
              Sie haben auch das Recht, sich bei einer Datenschutz-Aufsichtsbehörde über unsere
              Verarbeitung Ihrer personenbezogenen Daten zu beschweren.
            </Paragraph>
          </div>
        </section>

        <section class="legal-section">
          <Headline level="h2">9. Sicherheit</Headline>
          <div class="legal-section__content">
            <Paragraph>
              Wir verwenden angemessene technische und organisatorische Sicherheitsmaßnahmen, um
              Ihre Daten vor versehentlicher oder vorsätzlicher Manipulation, teilweisem oder
              vollständigem Verlust, Zerstörung oder unbefugtem Zugriff durch Dritte zu schützen.
            </Paragraph>
            <Paragraph>
              Die Website wird über HTTPS-Verschlüsselung übertragen. Dies schützt Ihre Eingaben vor
              dem Zugriff durch Dritte.
            </Paragraph>
          </div>
        </section>

        <section class="legal-section">
          <Headline level="h2">10. Änderungen dieser Datenschutzerklärung</Headline>
          <div class="legal-section__content">
            <Paragraph>
              Wir behalten uns das Recht vor, diese Datenschutzerklärung anzupassen, damit sie stets
              den aktuellen rechtlichen Anforderungen entspricht oder um Änderungen unserer
              Leistungen in der Datenschutzerklärung umzusetzen.
            </Paragraph>
            <Paragraph>
              Die neue Datenschutzerklärung gilt dann bei Ihrem nächsten Besuch. Wir empfehlen
              Ihnen, diese Seite regelmäßig zu besuchen, um über Änderungen informiert zu bleiben.
            </Paragraph>
          </div>
        </section>
      </div>
    </div>
  </main>
</Layout>

<style lang="scss">
  // Import global CSS variables
  @import "../../styles/global.css";

  // Legal page styles with modern SCSS features
  .legal-page {
    min-height: 100vh;
    background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
    color: var(--text-primary);
    padding: var(--space-xl) 0;
    position: relative;

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(circle at 20% 80%, var(--color-primary-900) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, var(--color-secondary-900) 0%, transparent 50%);
      opacity: 0.1;
      pointer-events: none;
    }

    .container {
      max-width: 50rem;
      margin: 0 auto;
      padding: 0 var(--space-md);
      position: relative;
      z-index: 1;
    }

    &__header {
      text-align: center;
      margin-bottom: var(--space-3xl);

      @media (min-width: 48em) {
        margin-bottom: var(--space-4xl);
      }
    }

    &__title {
      font-size: var(--text-4xl);
      font-weight: var(--font-bold);
      color: var(--text-primary);
      margin-bottom: var(--space-md);
      background: linear-gradient(135deg, var(--color-primary-400), var(--color-secondary-400));
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;

      @media (min-width: 48em) {
        font-size: var(--text-5xl);
      }
    }

    &__subtitle {
      font-size: var(--text-lg);
      color: var(--text-secondary);
      font-weight: var(--font-medium);
      margin-bottom: var(--space-sm);

      @media (min-width: 48em) {
        font-size: var(--text-xl);
      }
    }

    &__date {
      font-size: var(--text-sm);
      color: var(--text-tertiary);
      font-style: italic;
      opacity: 0.8;
    }

    &__content {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      padding: var(--space-2xl);
      border: 1px solid var(--border-primary);
      box-shadow: var(--card-shadow);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;

      &::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, var(--color-primary-500), var(--color-secondary-500));
      }

      @media (min-width: 48em) {
        padding: var(--space-3xl);
        border-radius: var(--radius-2xl);
      }
    }
  }

  // Legal section styles
  .legal-section {
    margin-bottom: var(--space-2xl);

    &:last-child {
      margin-bottom: 0;
    }

    &__title {
      font-size: var(--text-2xl);
      font-weight: var(--font-semibold);
      color: var(--interactive-primary);
      margin-bottom: var(--space-lg);
      padding-bottom: var(--space-sm);
      border-bottom: 2px solid var(--border-secondary);
      position: relative;

      &::after {
        content: "";
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 3rem;
        height: 2px;
        background: linear-gradient(90deg, var(--color-primary-500), var(--color-secondary-500));
      }

      @media (min-width: 48em) {
        font-size: var(--text-3xl);
      }
    }

    &__content {
      h3 {
        font-size: var(--text-xl);
        font-weight: var(--font-medium);
        color: var(--text-primary);
        margin: var(--space-lg) 0 var(--space-md) 0;

        &:first-child {
          margin-top: 0;
        }

        @media (min-width: 48em) {
          font-size: var(--text-2xl);
        }
      }

      p {
        margin-bottom: var(--space-md);
        line-height: var(--leading-relaxed);
        color: var(--text-primary);

        &:last-child {
          margin-bottom: 0;
        }
      }
    }
  }

  // List styles
  .legal-list {
    margin: var(--space-md) 0;
    padding-left: var(--space-lg);

    li {
      margin-bottom: var(--space-sm);
      line-height: var(--leading-relaxed);
      color: var(--text-primary);
      position: relative;

      &::marker {
        color: var(--color-primary-400);
      }

      &:last-child {
        margin-bottom: 0;
      }
    }
  }

  // Contact info styles
  .contact-info {
    background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
    padding: var(--space-lg);
    border-radius: var(--radius-md);
    border-left: 4px solid var(--interactive-primary);
    margin: var(--space-md) 0;
    position: relative;
    overflow: hidden;

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, var(--color-primary-500), var(--color-secondary-500));
    }

    p {
      margin-bottom: var(--space-sm);
      position: relative;
      z-index: 1;

      &:last-child {
        margin-bottom: 0;
      }
    }
  }

  // Link styles
  .legal-link {
    color: var(--interactive-primary);
    text-decoration: underline;
    font-weight: var(--font-medium);
    transition: all var(--transition-fast);
    position: relative;

    &:hover {
      color: var(--interactive-primary-hover);
      text-decoration: none;
    }

    &:focus {
      outline: 2px solid var(--focus-ring);
      outline-offset: 2px;
      border-radius: var(--radius-sm);
    }

    &::after {
      content: "↗";
      margin-left: 0.25rem;
      font-size: 0.875em;
      opacity: 0.7;
      transition: opacity var(--transition-fast);
    }

    &:hover::after {
      opacity: 1;
    }
  }

  // Responsive design
  @media (max-width: 47.9375em) {
    .legal-page {
      padding: var(--space-lg) 0;

      .container {
        padding: 0 var(--space-sm);
      }

      &__content {
        padding: var(--space-lg);
        border-radius: var(--radius-lg);
      }
    }

    .legal-section {
      margin-bottom: var(--space-xl);

      &__title {
        font-size: var(--text-xl);
      }

      &__content h3 {
        font-size: var(--text-lg);
      }
    }
  }

  // Print styles
  @media print {
    .legal-page {
      background: white;
      color: black;

      &::before {
        display: none;
      }
    }

    .legal-page__content {
      background: white;
      border: none;
      box-shadow: none;

      &::before {
        display: none;
      }
    }

    .legal-link {
      color: black;
      text-decoration: underline;

      &::after {
        display: none;
      }
    }

    .legal-list {
      list-style-type: disc;
    }

    .contact-info {
      background: white;
      border: 1px solid #ccc;

      &::before {
        display: none;
      }
    }
  }

  // High contrast mode support
  @media (prefers-contrast: high) {
    .legal-page {
      &__title {
        background: none;
        -webkit-text-fill-color: var(--text-primary);
        color: var(--text-primary);
      }
    }

    .legal-section__title::after {
      background: var(--text-primary);
    }
  }

  // Reduced motion support
  @media (prefers-reduced-motion: reduce) {
    .legal-link {
      transition: none;

      &::after {
        transition: none;
      }
    }
  }
</style>

<script>
  // Modern ES6+ JavaScript with TypeScript features
  (() => {
    "use strict";

    // Type definitions
    interface ScrollOptions {
      behavior: "smooth" | "auto";
      block: "start" | "center" | "end";
    }

    interface IntersectionObserverOptions {
      root: Element | null;
      rootMargin: string;
      threshold: number;
    }

    // Utility functions
    const debounce = <T extends (...args: unknown[]) => unknown>(
      func: T,
      wait: number
    ): ((...args: Parameters<T>) => void) => {
      let timeout: NodeJS.Timeout;
      return (...args: Parameters<T>) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => func(...args), wait);
      };
    };

    const throttle = <T extends (...args: unknown[]) => unknown>(
      func: T,
      limit: number
    ): ((...args: Parameters<T>) => void) => {
      let inThrottle: boolean;
      return (...args: Parameters<T>) => {
        if (!inThrottle) {
          func(...args);
          inThrottle = true;
          setTimeout(() => (inThrottle = false), limit);
        }
      };
    };

    // Main functionality
    const initLegalPage = (): void => {
      // Smooth scrolling for anchor links
      const anchorLinks = document.querySelectorAll<HTMLAnchorElement>('a[href^="#"]');

      anchorLinks.forEach((link) => {
        link.addEventListener("click", (e: Event) => {
          e.preventDefault();
          const targetId = link.getAttribute("href")?.slice(1);
          const targetElement = document.getElementById(targetId || "");

          if (targetElement) {
            const scrollOptions: ScrollOptions = {
              behavior: "smooth",
              block: "start",
            };
            targetElement.scrollIntoView(scrollOptions);
          }
        });
      });

      // Intersection Observer for animations
      const observerOptions: IntersectionObserverOptions = {
        root: null,
        rootMargin: "0px",
        threshold: 0.1,
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("fade-in");
          }
        });
      }, observerOptions);

      // Observe legal sections
      const legalSections = document.querySelectorAll(".legal-section");
      legalSections.forEach((section) => {
        observer.observe(section);
      });

      // Enhanced focus management
      const focusableElements = document.querySelectorAll<HTMLElement>(
        'a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])'
      );

      const handleTabKey = (e: KeyboardEvent): void => {
        if (e.key === "Tab") {
          const firstElement = focusableElements[0];
          const lastElement = focusableElements[focusableElements.length - 1];

          if (e.shiftKey) {
            if (document.activeElement === firstElement) {
              e.preventDefault();
              lastElement?.focus();
            }
          } else {
            if (document.activeElement === lastElement) {
              e.preventDefault();
              firstElement?.focus();
            }
          }
        }
      };

      document.addEventListener("keydown", handleTabKey);

      // Responsive navigation enhancement
      const handleResize = debounce((): void => {
        const isMobile = window.innerWidth < 768;
        document.body.classList.toggle("mobile-view", isMobile);
      }, 250);

      window.addEventListener("resize", handleResize);
      handleResize(); // Initial call

      // Performance optimization: Throttled scroll handler
      const handleScroll = throttle((): void => {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const header = document.querySelector(".legal-page__header");

        if (header) {
          const opacity = Math.max(0.3, 1 - scrollTop / 500);
          (header as HTMLElement).style.opacity = opacity.toString();
        }
      }, 16); // ~60fps

      window.addEventListener("scroll", handleScroll);

      // Accessibility enhancements
      const enhanceAccessibility = (): void => {
        // Add skip links
        const skipLink = document.createElement("a");
        skipLink.href = "#main-content";
        skipLink.textContent = "Skip to main content";
        skipLink.className = "skip-link";
        skipLink.style.cssText = `
          position: absolute;
          top: -40px;
          left: 6px;
          background: var(--color-primary-600);
          color: white;
          padding: 8px;
          text-decoration: none;
          border-radius: 4px;
          z-index: 1000;
          transition: top 0.3s;
        `;

        skipLink.addEventListener("focus", () => {
          skipLink.style.top = "6px";
        });

        skipLink.addEventListener("blur", () => {
          skipLink.style.top = "-40px";
        });

        document.body.insertBefore(skipLink, document.body.firstChild);

        // Add main content ID
        const mainContent = document.querySelector("main");
        if (mainContent) {
          mainContent.id = "main-content";
        }
      };

      enhanceAccessibility();
    };

    // Initialize when DOM is ready
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initLegalPage);
    } else {
      initLegalPage();
    }

    // Export for potential external use
    (window as unknown as Record<string, unknown>).legalPageUtils = {
      initLegalPage,
      debounce,
      throttle,
    };
  })();
</script>
