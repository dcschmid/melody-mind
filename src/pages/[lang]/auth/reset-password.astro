---
/**
 * Reset Password Page for MelodyMind
 *
 * This page displays the form for resetting a password and uses the Layout component.
 * It can be displayed in two modes:
 * 1. Request a reset link (without token)
 * 2. Set a new password (with token in URL)
 *
 * The page is optimized according to WCAG AAA standards for maximum accessibility.
 *
 * @route /[lang]/auth/reset-password
 * @since 3.0.0
 */

// 1. Imports
import PasswordResetForm from "@components/auth/PasswordResetForm.astro";
import Layout from "@layouts/Layout.astro";
import { getLangFromUrl, useTranslations } from "@utils/i18n";

// 2. URL and state processing
// Get the current language from URL
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang.toString());

// Check if a token is present in the URL
const url = new URL(Astro.request.url);
const token = url.searchParams.get("token");
const isConfirmReset = !!token;

// 3. SEO and content variables
// Set the title and description based on the mode
const title = isConfirmReset
  ? t("auth.password_reset_confirm.title")
  : t("auth.password_reset.title");

// Set appropriate descriptions for SEO and accessibility in the current language
const description = isConfirmReset
  ? t("auth.password_reset_confirm.description")
  : t("auth.password_reset.description");
---

<Layout {title} {description}>
  <!-- Main content section with semantic structure -->
  <PasswordResetForm {token} {isConfirmReset} />
</Layout>
