---
import Layout from "@layouts/Layout.astro";
import PageShell from "@components/Shared/PageShell.astro";
import { buildPageSeo, type StructuredData } from "@utils/seo/buildPageSeo";
import { resolvePageUrl } from "@utils/siteUrls";

const title = "Privacy Policy";
const description =
  "How we process personal data on Melody Mind Knowledge, including analytics with Fathom, external music embeds (Spotify/Deezer), and AI-generated media details.";
const currentUrl = resolvePageUrl(Astro.site, "/privacy");

const breadcrumbs = [
  { name: "Home", url: resolvePageUrl(Astro.site, "/") },
  { name: title, url: currentUrl },
];

const pageSeo = buildPageSeo({
  title,
  description,
  url: currentUrl,
  contentKind: "generic",
  breadcrumbs,
  structuredData: [] as StructuredData[],
  enrichedParts: [title, description],
  fallbackKeywords: ["privacy", "data protection", "fathom analytics", "openai media"],
  keywordLimit: 24,
  maxDescription: 160,
  image: "/knowledge.png",
  imageAlt: "Privacy Policy",
  publishDate: new Date(),
  modifiedDate: new Date(),
  index: true,
  follow: true,
  autoSocialImage: false,
  authorName: "Melody Mind",
});
---

<Layout {pageSeo}>
  <PageShell containerClass="page-shell__container--spacious">
    <div class="legal-page">
      <header class="legal-page__header static-page-header">
        <p class="legal-page__eyebrow static-page-eyebrow">Privacy</p>
        <h1 class="legal-page__title static-page-title">Privacy Policy</h1>
        <p class="legal-page__lead static-page-lead">
          This notice explains how we process personal data on Melody Mind Knowledge in
          line with EU and German data protection requirements (DSGVO/GDPR).
        </p>
      </header>

      <section class="legal-panel legal-page__section">
        <h2 class="legal-page__section-title">1. Controller</h2>
        <p class="legal-page__text">Daniel Schmid</p>
        <p class="legal-page__text">Hiltenspergerstr. 78, 80796 München, Germany</p>
        <p class="legal-page__text">
          Email:
          <a class="legal-page__link" href="mailto:dcschmid@murena.io">
            dcschmid@murena.io
          </a>
        </p>
      </section>

      <section class="legal-panel legal-page__section">
        <h2 class="legal-page__section-title">2. Hosting & Access Logs</h2>
        <p class="legal-page__text">
          We host on Render (render.com). Render processes server logs (IP address,
          timestamp, requested URL, user agent) to ensure site stability and security.
          Legal basis: Art. 6(1)(f) GDPR (legitimate interest in secure operation). Logs
          are deleted automatically on a rolling basis. Depending on the Render region,
          data may be processed in the EU or transferred to the USA under appropriate
          safeguards (e.g., SCCs).
        </p>
      </section>

      <section class="legal-panel legal-page__section">
        <h2 class="legal-page__section-title">3. External Content (Spotify & Deezer)</h2>
        <p class="legal-page__text">
          Our artist profiles may include music embeds from Spotify and Deezer. These are
          not loaded automatically. We use a privacy-friendly "click-to-load" approach:
          embeds only load after you explicitly click a placeholder. Until then, no data
          is transferred to Spotify or Deezer.
        </p>
        <p class="legal-page__text">
          Once loaded, these services may process your IP address and set cookies in
          accordance with their privacy policies. Spotify operates under Spotify AB
          (Sweden) and Deezer under Deezer SA (France). Both may transfer data to the USA
          under appropriate safeguards. You can reload the page to stop any external
          embeds. Legal basis: Art. 6(1)(a) GDPR (consent via your explicit click).
        </p>
        <p class="legal-page__text">
          <strong>Privacy policies of third-party providers:</strong>
        </p>
        <ul class="legal-page__list">
          <li>
            <a
              class="legal-page__link"
              href="https://www.spotify.com/legal/privacy-policy/"
              target="_blank"
              rel="noopener noreferrer"
            >
              Spotify Privacy Policy
            </a>
          </li>
          <li>
            <a
              class="legal-page__link"
              href="https://www.deezer.com/legal/privacy"
              target="_blank"
              rel="noopener noreferrer"
            >
              Deezer Privacy Policy
            </a>
          </li>
        </ul>
      </section>

      <section class="legal-panel legal-page__section">
        <h2 class="legal-page__section-title">4. Analytics with Fathom</h2>
        <p class="legal-page__text">
          We use Fathom Analytics only after your explicit consent via our cookie banner.
          Until you opt in, no analytics script is loaded. Consent is stored in your
          browser localStorage (`cookie_consent`) with categories for essential and
          analytics preferences. Legal basis: Art. 6(1)(a) GDPR (consent) and the ePrivacy
          Directive. If your browser sends a Do Not Track (DNT) signal, we keep analytics
          disabled.
        </p>
        <p class="legal-page__text">
          You can change or withdraw your choice at any time via "Cookie Settings" in the
          footer. Withdrawal applies from that moment onward and does not affect prior
          lawful processing. For a detailed list of storage technologies, see our
          <a class="legal-page__link" href="/cookies"> Cookie &amp; Storage Policy</a>.
        </p>
      </section>

      <section class="legal-panel legal-page__section">
        <h2 class="legal-page__section-title">5. AI-Generated Content</h2>
        <p class="legal-page__text">
          Some text and images are generated or assisted by OpenAI services. No personal
          data is intentionally sent to OpenAI. If you contact us and share personal
          information, we do not use that content in AI prompts without your consent.
        </p>
      </section>

      <section class="legal-panel legal-page__section">
        <h2 class="legal-page__section-title">6. Contact</h2>
        <p class="legal-page__text">
          If you email us, we process your message, contact details, and metadata to
          respond. Legal basis: Art. 6(1)(b) GDPR (pre-contractual communication) or Art.
          6(1)(f) GDPR (legitimate interest in replying to inquiries). Data is kept only
          as long as needed.
        </p>
      </section>

      <section class="legal-panel legal-page__section">
        <h2 class="legal-page__section-title">7. Your Rights</h2>
        <p class="legal-page__text">
          You have the rights of access, rectification, erasure, restriction, objection
          (including to processing based on Art. 6(1)(f) GDPR), and data portability. You
          may also lodge a complaint with your local supervisory authority. In Bavaria,
          this is the BayLDA (Bayerisches Landesamt für Datenschutzaufsicht).
        </p>
      </section>

      <section class="legal-panel legal-page__section">
        <h2 class="legal-page__section-title">8. Data Retention</h2>
        <p class="legal-page__text">
          We retain personal data only as long as necessary for the stated purposes or
          legal obligations and then delete or anonymize it.
        </p>
      </section>

      <section class="legal-panel legal-page__section">
        <h2 class="legal-page__section-title">9. Updates</h2>
        <p class="legal-page__text">
          We may update this policy to reflect legal or technical changes. Last updated:
          {new Date().toLocaleDateString("en-GB")}.
        </p>
      </section>
    </div>
  </PageShell>
</Layout>
<style>
  .legal-page {
    display: flex;
    flex-direction: column;
    gap: var(--static-page-gap);
  }

  .legal-page__section {
    display: flex;
    flex-direction: column;
    gap: var(--static-page-section-gap);
  }

  .legal-page__section-title {
    font-size: 1.225rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
  }

  .legal-page__text {
    margin: 0;
    color: var(--text-secondary);
    line-height: 1.6;
  }

  .legal-page__link {
    color: var(--link-default);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .legal-page__link:hover {
    color: var(--link-hover);
  }

  .legal-page__list {
    margin: 0;
    padding-left: 1.5rem;
    color: var(--text-secondary);
    line-height: 1.8;
  }

  .legal-page__list li {
    margin-bottom: 0.5rem;
  }
</style>
