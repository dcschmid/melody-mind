---
import Layout from "../../layouts/Layout.astro";
import ThreeJoker from "../../components/HeaderItems/ThreeJoker.astro";
import StartOverlay from "../../components/Overlays/StartOverlay.astro";
import TimeupsOverlay from "../../components/Overlays/TimeupsOverlay.astro";
import IntroText from "../../components/Shared/IntroText.astro";
import Timer from "../../components/Round/Timer.astro";
import CoverFlow from "../../components/Round/CoverFlow.astro";
import { coverflowRoundOneData } from "../../data/coverflowRoundOneData";
import { shuffleArray } from "../../utils/share/shuffleArray";

const randomizedCoverflowData = shuffleArray(coverflowRoundOneData);
---

<Layout title="Spielrunde 1" showUserLink={false}>
  <ThreeJoker slot="left-headercol" />

  <StartOverlay headline="Runde 1 / 3" whiteText="Erscheinungsjahr: vorne das neueste, hinten das älteste." />

  <TimeupsOverlay />

  <IntroText headline="Runde 1 / 3" subline="Sortieren Sie nach dem" whiteText="Erscheinungsjahr!" />

  <CoverFlow randomizedCoverflowData={randomizedCoverflowData} upText="Älteste" downText="Neuste" />

  <Timer minutes="01" seconds="30" />
</Layout>

<script>
  // Import functions from the utils directory
  import { resetLocalStorage } from "../../utils/resetLocalStorage";
  import { handleEndRoundClick } from "../../utils/round/handleEndRoundClick";
  import { solutionRoundOne } from "../../data/solutionRoundOne";
  import { initializeCovers } from "../../utils/round/initializeCovers";
  import { initializeOverlay } from "../../utils/round/initializeOverlay";

  // Set the initial time remaining and timer interval
  let timeRemaining = 90; // Initial time remaining in seconds
  let timerInterval: number | 0 = 0; // Initial timer interval in milliseconds

  /**
   * Add an event listener to the window load event
   * This function is called when the page has finished loading
   * It initializes the round game, resets the local storage,
   * and handles the end round click event
   */
  window.addEventListener("load", function () {
    // Reset the local storage
    resetLocalStorage();

    // Initialize the overlay and cover elements
    initializeOverlay(timerInterval, timeRemaining); // Initialize the overlay with the initial time remaining and timer interval
    initializeCovers(); // Initialize the cover elements

    // Handle the end round click event
    handleEndRoundClick(
      solutionRoundOne, // Solution for the current round
      "/results/result-one", // URL for the results page
      "allCorrectRound1", // Key for the local storage item that stores the correct answers
      "PointsRound1", // Key for the local storage item that stores the points earned in this round
      "ResultsRound1" // Key for the local storage item that stores the results for this round
    );
  });
</script>
