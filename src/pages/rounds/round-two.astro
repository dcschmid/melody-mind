---
import Layout from "../../layouts/Layout.astro";
import TwoJoker from "../../components/HeaderItems/TwoJoker.astro";
import { coverflowRoundTwoData } from "../../data/coverflowRoundTwoData";
import StartOverlay from "../../components/Overlays/StartOverlay.astro";
import TimeupsOverlay from "../../components/Overlays/TimeupsOverlay.astro";
import IntroText from "../../components/Shared/IntroText.astro";
import CoverFlow from "../../components/Round/CoverFlow.astro";
import Timer from "../../components/Round/Timer.astro";
import { shuffleArray } from "../../utils/share/shuffleArray";

const randomizedCoverflowData = shuffleArray(coverflowRoundTwoData);
---

<Layout title="Spielrunde 2" showUserLink={false}>
  <TwoJoker slot="left-headercol" />

  <StartOverlay headline="Runde 2 / 3" whiteText="Verkaufszahlen: vorne das meiste, hinten das wenigste." />

  <TimeupsOverlay />

  <IntroText headline="Runde 2 / 3" subline="Sortieren Sie nach" whiteText="Verkaufszahlen!" />

  <CoverFlow randomizedCoverflowData={randomizedCoverflowData} upText="Wenigste" downText="Meiste" />

  <Timer minutes="01" seconds="30" />
</Layout>

<script>
  // Import functions from the utils directory
  import { resetLocalStorage } from "../../utils/resetLocalStorage";
  import { handleEndRoundClick } from "../../utils/round/handleEndRoundClick";
  import { initializeCovers } from "../../utils/round/initializeCovers";
  import { initializeOverlay } from "../../utils/round/initializeOverlay";
  import { solutionRoundTwo } from "../../data/solutionRoundTwo";

  // Set the initial time remaining and timer interval
  let timeRemaining = 90; // Initial time remaining in seconds
  let timerInterval: number | 0 = 0; // Initial timer interval in milliseconds

  /**
   * Add an event listener to the window load event
   * This function is called when the page has finished loading
   * It initializes the round game, resets the local storage,
   * and handles the end round click event
   */
  window.addEventListener("load", function () {
    // Reset the local storage
    resetLocalStorage();

    // Initialize the overlay and cover elements
    initializeOverlay(timerInterval, timeRemaining); // Initialize the overlay with the initial time remaining and timer interval
    initializeCovers(); // Initialize the cover elements

    // Handle the end round click event
    handleEndRoundClick(
      solutionRoundTwo, // Solution for the current round
      "/results/result-two", // URL for the results page
      "allCorrectRound2", // Key for the local storage item that stores the correct answers
      "PointsRound2", // Key for the local storage item that stores the points earned in this round
      "ResultsRound2" // Key for the local storage item that stores the results for this round
    );
  });
</script>
