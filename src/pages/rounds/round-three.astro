---
import Layout from "../../layouts/Layout.astro";
import OneJoker from "../../components/HeaderItems/OneJoker.astro";
import { coverflowRoundThreeData } from "../../data/coverflowRoundThreeData";
import StartOverlay from "../../components/Overlays/StartOverlay.astro";
import TimeupsOverlay from "../../components/Overlays/TimeupsOverlay.astro";
import IntroText from "../../components/Shared/IntroText.astro";
import CoverFlow from "../../components/Round/CoverFlow.astro";
import Timer from "../../components/Round/Timer.astro";
import { shuffleArray } from "../../utils/share/shuffleArray";

const randomizedCoverflowData = shuffleArray(coverflowRoundThreeData);
---

<Layout title="Spielrunde 3" showUserLink={false}>
  <OneJoker slot="left-headercol" />

  <StartOverlay headline="Runde 3 / 3" whiteText="Gesamtlänge: vorne das längste, hinten das kürzeste." />

  <TimeupsOverlay />

  <IntroText headline="Runde 3 / 3" subline="Sortieren Sie nach" whiteText="Gesamtlänge!" />

  <CoverFlow randomizedCoverflowData={randomizedCoverflowData} upText="Kürzeste" downText="Längste" />

  <Timer minutes="01" seconds="30" />
</Layout>

<script>
  // Import functions from the utils directory
  import { handleEndRoundClick } from "../../utils/round/handleEndRoundClick";
  import { initializeCovers } from "../../utils/round/initializeCovers";
  import { initializeOverlay } from "../../utils/round/initializeOverlay";
  import { solutionRoundThree } from "../../data/solutionRoundThree";

  // Set the initial time remaining and timer interval
  let timeRemaining = 90; // Initial time remaining in seconds
  let timerInterval: number | 0 = 0; // Initial timer interval in milliseconds

  /**
   * Add an event listener to the window load event
   * This function is called when the page has finished loading
   * It initializes the round game, resets the local storage,
   * and handles the end round click event
   */
  window.addEventListener("load", function () {
    // Initialize the overlay and cover elements
    initializeOverlay(timerInterval, timeRemaining); // Initialize the overlay with the initial time remaining and timer interval
    initializeCovers(); // Initialize the cover elements

    // Handle the end round click event
    handleEndRoundClick(
      solutionRoundThree, // Solution for the current round
      "/results/result-three", // URL for the results page
      "allCorrectRound3", // Key for the local storage item that stores the correct answers
      "PointsRound3", // Key for the local storage item that stores the points earned in this round
      "ResultsRound3" // Key for the local storage item that stores the results for this round
    );
  });
</script>
