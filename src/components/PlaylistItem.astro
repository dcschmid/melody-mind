---
import { getLangFromUrl, useTranslations } from "@utils/i18n";
import { Picture } from "astro:assets";

interface Props {
  headline: string;
  subheadline?: string; // Optional property für die introSubline
  image: string;
  isDisabled?: boolean;
  imageAlt: string;
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const {
  headline = "",
  subheadline = "",
  image,
  isDisabled = false,
  imageAlt = "",
} = Astro.props;
---

<article
  class:list={[
    "relative flex flex-col w-full h-full overflow-hidden rounded-xl bg-gradient-to-b from-zinc-800 to-zinc-900 will-change-transform transition-all duration-300 ease-in-out shadow-sm hover:shadow-md",
    { "bg-opacity-80 grayscale-[30%]": isDisabled }
  ]}
  role="listitem"
>
  {
    isDisabled && (
      <div
        class="absolute inset-0 z-10 flex items-center justify-center p-4 bg-black/85 text-white text-center font-medium backdrop-blur-sm"
        aria-label={t("playlist.item.unavailable")}
        role="status"
      >
        <span class="sr-only">{t("playlist.item.status")}:</span>
        <span class="px-4 py-2 rounded-full bg-zinc-800/90 border border-zinc-700 text-zinc-100">
          {t("playlist.item.coming.soon")}
        </span>
      </div>
    )
  }

  <div class="relative w-full aspect-[16/9] overflow-hidden group">
    <!-- Overlay gradient for better text contrast -->
    <div
      class="absolute inset-0 bg-gradient-to-t from-zinc-900 via-zinc-900/50 to-transparent z-[1] opacity-40 group-hover:opacity-30 transition-opacity"
      aria-hidden="true"
    >
    </div>
    
    <!-- Media badge for accessibility -->
    <span class="absolute top-2 right-2 z-[2] bg-indigo-700 text-white text-xs font-medium px-2 py-1 rounded-full">
      {isDisabled ? t("playlist.item.coming.soon") : t("category.play")}
    </span>
    
    <Picture
      class:list={[
        "absolute top-0 left-0 w-full h-full object-cover transition-all duration-500",
        isDisabled ? "opacity-70" : "group-hover:scale-105"
      ]}
      src={image}
      width={320}
      height={180}
      formats={["avif", "webp"]}
      alt={imageAlt}
      loading="lazy"
      decoding="async"
      fetchpriority={isDisabled ? "low" : "auto"}
      quality={85}
    />
  </div>

  <div class="p-5 flex-grow flex flex-col">
    <h2
      class="headline m-0 font-sans text-lg text-center font-semibold leading-tight hyphens-auto text-white break-words"
    >
      {headline}
    </h2>

    {
      subheadline && (
        <div class="mt-3 relative">
          <div class="h-px w-1/4 bg-indigo-500 mx-auto mb-3" />
          <p class="text-base text-center text-zinc-100 leading-relaxed">
            {subheadline}
          </p>
        </div>
      )
    }
  </div>
  
  <!-- Interactive indicator that appears on hover/focus -->
  <div 
    class="absolute bottom-0 inset-x-0 h-1 bg-gradient-to-r from-purple-600 to-indigo-600 transform scale-x-0 group-hover:scale-x-100 group-focus-visible:scale-x-100 transition-transform origin-left"
    aria-hidden="true"
  >
  </div>
</article>

<script>
  // Verbesserter Hover-Effekt mit Prüfung auf Gerätefähigkeiten
  document
    .querySelectorAll('article[role="listitem"]:not([aria-disabled="true"])')
    .forEach((item) => {
      // Fokus-Behandlung für Tastaturzugänglichkeit
      item.addEventListener("focus", () => {
        item.classList.add("ring-2", "ring-purple-500", "ring-offset-2", "ring-offset-zinc-900");
      }, true);
      
      item.addEventListener("blur", () => {
        item.classList.remove("ring-2", "ring-purple-500", "ring-offset-2", "ring-offset-zinc-900");
      }, true);

      // Hover-Effekte nur auf Geräten, die Hover unterstützen
      if (window.matchMedia("(hover: hover)").matches) {
        item.addEventListener("mouseenter", () => {
          item.classList.add("translate-y-[-2px]", "shadow-lg", "shadow-purple-900/10");
        });

        item.addEventListener("mouseleave", () => {
          item.classList.remove("translate-y-[-2px]", "shadow-lg", "shadow-purple-900/10");
        });
      }
    });
</script>

<style>
  /* Verbesserte Stile für Nutzer, die reduzierte Bewegung bevorzugen */
  @media (prefers-reduced-motion: reduce) {
    article,
    .group img,
    .group-hover\:scale-105,
    .group-hover\:opacity-30,
    .group-hover\:scale-x-100 {
      transition: none !important;
      transform: none !important;
      animation: none !important;
    }
  }

  /* Verbesserte High Contrast Mode Unterstützung */
  @media (forced-colors: active) {
    article[role="listitem"] {
      border: 2px solid ButtonText;
      forced-color-adjust: none;
    }

    article[aria-disabled="true"] {
      border: 2px dashed GrayText;
      opacity: 0.7;
    }
    
    .from-zinc-800,
    .to-zinc-900,
    .bg-gradient-to-b,
    .bg-gradient-to-r,
    .bg-gradient-to-t {
      background: Canvas;
    }
    
    h2.headline {
      color: CanvasText;
    }
  }

  /* Bessere Unterstützung für 16:9 Aspektverhältnis */
  .aspect-\[16\/9\] {
    position: relative;
    padding-bottom: 56.25%; /* 9/16 = 0.5625 */
    height: 0;
  }

  .aspect-\[16\/9\] > img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  /* Verbesserte Lesbarkeit durch optimale Zeilenhöhe */
  .leading-relaxed {
    line-height: 1.6;
  }
  
  /* Farbkontrast-Unterstützung für die Zugänglichkeit */
  .text-zinc-100 {
    color: #f4f4f5; /* Höherer Kontrast als Standard-zinc-100 */
  }
  
  /* Fokus-Stile für bessere Tastaturnavigation */
  article:focus-visible {
    outline: 3px solid #a855f7 !important;
    outline-offset: 3px !important;
  }
</style>
