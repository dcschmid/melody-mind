---
/**
 * @file Navigation.astro
 * @description Main navigation component for the MelodyMind application
 *
 * @example
 * ```astro
 * ---
 * import Navigation from "@components/Header/Navigation.astro";
 * ---
 *
 * <!-- Standard navigation with all icons -->
 * <Navigation />
 *
 * <!-- Minimal navigation for game pages -->
 * <Navigation showHeaderIcons={false} />
 *
 */
import { Icon } from "astro-icon/components";
import { When } from "@astropub/flow";
import { getRelativeLocaleUrl } from "astro:i18n";
import LanguagePicker from "@components/LanguagePicker.astro";
import { getLangFromUrl, useTranslations } from "@utils/i18n";
import Headline from "@components/Headline.astro";
import Paragraph from "@components/Paragraph.astro";

interface Props {
  showHeaderIcons?: boolean;
}

const { showHeaderIcons = true } = Astro.props;
const lang = getLangFromUrl(Astro.url) as string;
const t = useTranslations(lang);
---

<!-- Main header with navigation and language picker -->
<header
  role="banner"
  class="flex flex-row justify-between items-center rounded-lg p-4 md:p-6 min-h-[44px]"
>
  <LanguagePicker />
  <nav aria-label={t("nav.ariaLabel")} class="flex flex-wrap items-center justify-between gap-4">
    <div class="flex flex-1 items-center justify-center gap-4">
      <button
        class="relative flex min-h-[44px] min-w-[44px] items-center justify-center gap-2 rounded-lg border-2 border-purple-600 bg-purple-600 px-3 py-2 font-medium text-white shadow-md transition-all duration-300 cursor-pointer m-1 hover:bg-purple-700 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
        aria-label={t("nav.menu.open")}
        aria-expanded="false"
        aria-controls="main-menu"
        id="menu-toggle"
      >
        <Icon
          name="menu"
          width={28}
          height={28}
          aria-hidden="true"
          class="w-7 h-7 transition-transform duration-200 flex-shrink-0"
        />
        <span
          class="absolute left-[-10000px] w-px h-px overflow-hidden font-medium text-sm whitespace-nowrap"
          >{t("nav.menu.text")}</span
        >
      </button>

      <!-- Full-screen overlay backdrop -->
      <div
        id="menu-backdrop"
        class="fixed inset-0 z-[998] bg-gradient-to-br from-purple-900/95 to-blue-800/90 backdrop-blur-[20px] transition-all duration-300 invisible opacity-0 data-[state=open]:visible data-[state=open]:opacity-100"
        aria-hidden="true"
      >
      </div>

      <!-- Full-screen navigation overlay -->
      <div
        id="main-menu"
        class="fixed inset-0 z-[999] flex flex-col bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 overflow-y-auto overscroll-contain transition-all duration-300 ease-out invisible opacity-0 scale-95 data-[state=open]:visible data-[state=open]:opacity-100 data-[state=open]:scale-100"
        role="dialog"
        aria-modal="true"
        aria-labelledby="menu-title"
        data-state="closed"
      >
        <!-- Close button -->
        <button
          class="absolute top-6 right-6 z-10 flex items-center justify-center w-12 h-12 rounded-full bg-gray-700 text-white border-2 border-gray-600 cursor-pointer transition-all duration-300 shadow-lg hover:bg-purple-600 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
          aria-label={t("nav.menu.close")}
        >
          <Icon
            name="close"
            width={32}
            height={32}
            aria-hidden="true"
            class="w-8 h-8 transition-inherit"
          />
        </button>

        <!-- Navigation content container -->
        <div class="flex flex-col min-h-screen p-12 md:p-16 lg:p-20 max-w-6xl mx-auto w-full">
          <!-- Menu title -->
          <div class="text-center mb-12 pt-8">
            <Headline
              level="h2"
              className="text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent"
            >
              {t("nav.title")}
            </Headline>
            <Paragraph className="text-lg text-gray-300 opacity-80">
              {t("nav.subtitle")}
            </Paragraph>
          </div>

          <!-- Status announcer for screen readers -->
          <div
            aria-live="polite"
            aria-atomic="true"
            class="absolute left-[-10000px] w-px h-px overflow-hidden clip-rect-[1px_1px_1px_1px] whitespace-nowrap"
            id="menu-status-announcer"
          >
          </div>

          <!-- Main navigation sections -->
          <div class="flex flex-col gap-8 flex-1 mb-8">
            <!-- Home section -->
            <div
              class="w-full bg-gray-800 border border-gray-700 rounded-2xl p-6 shadow-md transition-all duration-300 hover:shadow-lg hover:-translate-y-1"
            >
              <Headline
                level="h3"
                className="text-xl font-semibold text-purple-400 mb-4 pb-2 border-b-2 border-purple-500 opacity-90"
                >{t("nav.section.main")}</Headline
              >
              <nav class="flex flex-col gap-4">
                <a
                  href={getRelativeLocaleUrl(lang, "gamehome")}
                  class="flex flex-row items-center gap-6 p-4 rounded-2xl bg-gray-800 border border-gray-700 text-decoration-none text-white transition-all duration-300 cursor-pointer shadow-sm min-h-[80px] relative overflow-hidden hover:shadow-xl hover:border-purple-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                  role="menuitem"
                >
                  <div
                    class="relative flex items-center justify-center w-14 h-14 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex-shrink-0 shadow-md"
                  >
                    <Icon
                      name="home"
                      width={32}
                      height={32}
                      aria-hidden="true"
                      class="text-white z-10"
                    />
                  </div>
                  <div class="flex flex-col gap-2 flex-1 z-10">
                    <span class="text-lg font-semibold text-white leading-tight"
                      >{t("nav.menu.home")}</span
                    >
                    <span class="text-sm text-gray-300 opacity-80 leading-relaxed"
                      >{t("nav.menu.home.desc")}</span
                    >
                  </div>
                </a>
              </nav>
            </div>

            <!-- Game sections (conditional) -->
            <When test={showHeaderIcons}>
              <!-- Discover section -->
              <div
                class="w-full bg-gray-800 border border-gray-700 rounded-2xl p-6 shadow-md transition-all duration-300 hover:shadow-lg hover:-translate-y-1"
              >
                <Headline
                  level="h3"
                  className="text-xl font-semibold text-white mb-4 pb-2 border-b-2 border-purple-500 opacity-90"
                  >{t("nav.section.discover")}</Headline
                >
                <nav class="flex flex-col gap-4">
                  <a
                    href={getRelativeLocaleUrl(lang, "knowledge")}
                    class="flex flex-row items-center gap-6 p-4 rounded-2xl bg-gray-800 border border-gray-700 text-decoration-none text-white transition-all duration-300 cursor-pointer shadow-sm min-h-[80px] relative overflow-hidden hover:shadow-xl hover:border-purple-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                    role="menuitem"
                  >
                    <div
                      class="relative flex items-center justify-center w-14 h-14 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex-shrink-0 shadow-md"
                    >
                      <Icon
                        name="book"
                        width={28}
                        height={28}
                        aria-hidden="true"
                        class="text-white z-10"
                      />
                    </div>
                    <div class="flex flex-col gap-2 flex-1 z-10">
                      <span class="text-lg font-semibold text-white leading-tight"
                        >{t("knowledge.title")}</span
                      >
                      <span class="text-sm text-gray-300 opacity-80 leading-relaxed"
                        >{t("nav.menu.knowledge.desc")}</span
                      >
                    </div>
                  </a>

                  <a
                    href={getRelativeLocaleUrl(lang, "playlists")}
                    class="flex flex-row items-center gap-6 p-4 rounded-2xl bg-gray-800 border border-gray-700 text-decoration-none text-white transition-all duration-300 cursor-pointer shadow-sm min-h-[80px] relative overflow-hidden hover:shadow-xl hover:border-purple-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                    role="menuitem"
                  >
                    <div
                      class="relative flex items-center justify-center w-14 h-14 rounded-lg bg-gradient-to-br from-green-500 to-green-600 flex-shrink-0 shadow-md"
                    >
                      <Icon
                        name="music-note"
                        width={28}
                        height={28}
                        aria-hidden="true"
                        class="text-white z-10"
                      />
                    </div>
                    <div class="flex flex-col gap-2 flex-1 z-10">
                      <span class="text-lg font-semibold text-white leading-tight"
                        >{t("playlist.page.heading")}</span
                      >
                      <span class="text-sm text-gray-300 opacity-80 leading-relaxed"
                        >{t("nav.menu.playlists.desc")}</span
                      >
                    </div>
                  </a>

                  <a
                    href={getRelativeLocaleUrl(lang, "podcasts")}
                    class="flex flex-row items-center gap-6 p-4 rounded-2xl bg-gray-800 border border-gray-700 text-decoration-none text-white transition-all duration-300 cursor-pointer shadow-sm min-h-[80px] relative overflow-hidden hover:shadow-xl hover:border-purple-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                    role="menuitem"
                  >
                    <div
                      class="relative flex items-center justify-center w-14 h-14 rounded-lg bg-gradient-to-br from-blue-400 to-blue-500 flex-shrink-0 shadow-md"
                    >
                      <Icon
                        name="microphone"
                        width={28}
                        height={28}
                        aria-hidden="true"
                        class="text-white z-10"
                      />
                    </div>
                    <div class="flex flex-col gap-2 flex-1 z-10">
                      <span class="text-lg font-semibold text-white leading-tight"
                        >{t("nav.menu.podcasts")}</span
                      >
                      <span class="text-sm text-gray-300 opacity-80 leading-relaxed"
                        >{t("nav.podcasts.description")}</span
                      >
                    </div>
                  </a>

                  <a
                    href={getRelativeLocaleUrl(lang, "news")}
                    class="flex flex-row items-center gap-6 p-4 rounded-2xl bg-gray-800 border border-gray-700 text-decoration-none text-white transition-all duration-300 cursor-pointer shadow-sm min-h-[80px] relative overflow-hidden hover:shadow-xl hover:border-purple-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                    role="menuitem"
                  >
                    <div
                      class="relative flex items-center justify-center w-14 h-14 rounded-lg bg-gradient-to-br from-red-500 to-red-600 flex-shrink-0 shadow-md"
                    >
                      <Icon
                        name="news"
                        width={28}
                        height={28}
                        aria-hidden="true"
                        class="text-white z-10"
                      />
                    </div>
                    <div class="flex flex-col gap-2 flex-1 z-10">
                      <span class="text-lg font-semibold text-white leading-tight"
                        >{t("news.title")}</span
                      >
                      <span class="text-sm text-gray-300 opacity-80 leading-relaxed"
                        >{t("news.description")}</span
                      >
                    </div>
                  </a>
                </nav>
              </div>
            </When>

            <!-- User section (conditional) -->
            <div
              class="w-full bg-gray-800 border border-gray-700 rounded-2xl p-6 shadow-md transition-all duration-300 hover:shadow-lg hover:-translate-y-1"
              id="user-section"
              style="display: none;"
            >
              <Headline
                level="h3"
                className="text-xl font-semibold text-white mb-4 pb-2 border-b-2 border-purple-500 opacity-90"
                >{t("nav.section.account")}</Headline
              >
              <nav class="flex flex-col gap-4">
                <a
                  href={getRelativeLocaleUrl(lang, "profile")}
                  class="flex flex-row items-center gap-6 p-4 rounded-2xl bg-gray-800 border border-gray-700 text-decoration-none text-white transition-all duration-300 cursor-pointer shadow-sm min-h-[80px] relative overflow-hidden hover:shadow-xl hover:border-purple-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                  role="menuitem"
                  aria-label={t("profile.nav.aria")}
                >
                  <div
                    class="relative flex items-center justify-center w-14 h-14 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex-shrink-0 shadow-md"
                  >
                    <Icon
                      name="user"
                      width={28}
                      height={28}
                      aria-hidden="true"
                      class="text-white z-10"
                    />
                  </div>
                  <div class="flex flex-col gap-2 flex-1 z-10">
                    <span class="text-lg font-semibold text-white leading-tight"
                      >{t("profile.nav.link")}</span
                    >
                    <span class="text-sm text-gray-300 opacity-80 leading-relaxed"
                      >{t("nav.menu.profile.desc")}</span
                    >
                  </div>
                </a>

                <button
                  id="logout-button"
                  class="flex flex-row items-center gap-6 p-4 rounded-2xl bg-gray-800 border border-gray-700 text-decoration-none text-white transition-all duration-300 cursor-pointer shadow-sm min-h-[80px] relative overflow-hidden hover:shadow-xl hover:border-purple-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                  role="menuitem"
                  aria-label={t("nav.logout.label")}
                  type="button"
                >
                  <div
                    class="relative flex items-center justify-center w-14 h-14 rounded-lg bg-gradient-to-br from-red-500 to-red-600 flex-shrink-0 shadow-md"
                  >
                    <Icon
                      name="logout"
                      width={28}
                      height={28}
                      aria-hidden="true"
                      class="text-white z-10"
                    />
                  </div>
                  <div class="flex flex-col gap-2 flex-1 z-10">
                    <span class="text-lg font-semibold text-white leading-tight"
                      >{t("nav.menu.logout")}</span
                    >
                    <span class="text-sm text-gray-300 opacity-80 leading-relaxed"
                      >{t("nav.menu.logout.desc")}</span
                    >
                  </div>
                </button>
              </nav>
            </div>
          </div>

          <!-- Support section -->
          <div
            class="w-full bg-gray-800 border border-gray-700 rounded-2xl p-6 shadow-md transition-all duration-300 hover:shadow-lg hover:-translate-y-1"
          >
            <Headline
              level="h3"
              className="text-xl font-semibold text-white mb-4 pb-2 border-b-2 border-purple-500 opacity-90"
              >{t("nav.donate.heading")}</Headline
            >
            <nav class="flex flex-col gap-4">
              <a
                href="https://www.paypal.me/dcschmid"
                target="_blank"
                rel="noopener noreferrer"
                class="flex flex-row items-center gap-6 p-4 rounded-2xl bg-gray-800 border border-gray-700 text-decoration-none text-white transition-all duration-300 cursor-pointer shadow-sm min-h-[80px] relative overflow-hidden hover:shadow-xl hover:border-purple-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                role="menuitem"
                aria-label={`${t("nav.donate.paypal")} (${t("nav.openNewWindow")})`}
              >
                <div
                  class="relative flex items-center justify-center w-14 h-14 rounded-lg bg-gradient-to-br from-purple-500 to-blue-500 flex-shrink-0 shadow-md"
                >
                  <Icon
                    name="paypal"
                    width={28}
                    height={28}
                    aria-hidden="true"
                    class="text-white z-10"
                  />
                </div>
                <div class="flex flex-col gap-2 flex-1 z-10">
                  <span class="text-lg font-semibold text-white leading-tight"
                    >{t("nav.donate.paypal")}</span
                  >
                  <span class="text-sm text-gray-300 opacity-80 leading-relaxed"
                    >{t("nav.donate.description")}</span
                  >
                </div>
              </a>

              <a
                href="https://www.buymeacoffee.com/dcschmid"
                target="_blank"
                rel="noopener noreferrer"
                class="flex flex-row items-center gap-6 p-4 rounded-2xl bg-gray-800 border border-gray-700 text-decoration-none text-white transition-all duration-300 cursor-pointer shadow-sm min-h-[80px] relative overflow-hidden hover:shadow-xl hover:border-purple-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                role="menuitem"
                aria-label={`${t("nav.donate.coffee")} (${t("nav.openNewWindow")})`}
              >
                <div
                  class="relative flex items-center justify-center w-14 h-14 rounded-lg bg-gradient-to-br from-purple-500 to-blue-500 flex-shrink-0 shadow-md"
                >
                  <Icon
                    name="coffee-cup"
                    width={28}
                    height={28}
                    aria-hidden="true"
                    class="text-white z-10"
                  />
                </div>
                <div class="flex flex-col gap-2 flex-1 z-10">
                  <span class="text-lg font-semibold text-white leading-tight"
                    >{t("nav.donate.coffee")}</span
                  >
                  <span class="text-sm text-gray-300 opacity-80 leading-relaxed"
                    >{t("nav.donate.description")}</span
                  >
                </div>
              </a>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>

<script define:vars={{ lang }}>
  // Simple navigation menu functionality
  document.addEventListener("DOMContentLoaded", () => {
    const menuToggle = document.getElementById("menu-toggle");
    const mainMenu = document.getElementById("main-menu");
    const menuBackdrop = document.getElementById("menu-backdrop");
    const closeButton = mainMenu?.querySelector("button");

    if (!menuToggle || !mainMenu || !menuBackdrop || !closeButton) {
      return;
    }

    // Toggle menu function
    const toggleMenu = () => {
      const isExpanded = menuToggle.getAttribute("aria-expanded") === "true";
      const newState = !isExpanded;

      menuToggle.setAttribute("aria-expanded", String(newState));
      mainMenu.setAttribute("data-state", newState ? "open" : "closed");
      menuBackdrop.setAttribute("data-state", newState ? "open" : "closed");

      // Prevent scrolling when menu is open
      document.body.style.overflow = newState ? "hidden" : "";

      // Focus management
      if (newState) {
        setTimeout(() => {
          closeButton.focus();
        }, 300);
      } else {
        menuToggle.focus();
      }
    };

    // Event listeners
    menuToggle.addEventListener("click", toggleMenu);
    menuBackdrop.addEventListener("click", toggleMenu);
    closeButton.addEventListener("click", toggleMenu);

    // Close with Escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && mainMenu.getAttribute("data-state") === "open") {
        toggleMenu();
      }
    });

    // Simple logout functionality
    const logoutButton = document.getElementById("logout-button");
    if (logoutButton) {
      logoutButton.addEventListener("click", () => {
        // Clear auth data
        localStorage.removeItem("auth_status");
        localStorage.removeItem("user");

        // Redirect to home
        window.location.href = `/${lang}/gamehome`;
      });
    }
  });
</script>
