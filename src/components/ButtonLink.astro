---
/**
 * ButtonLink Component - Simple & Clean
 *
 * A versatile anchor-style button with consistent styling across the project.
 *
 * @component
 * @example
 * ```astro
 * --- Frontmatter (example) ---
 * ---
 * import { getLangFromUrl, useTranslations } from '@utils/i18n';
 * const lang = getLangFromUrl(Astro.url);
 * const t = useTranslations(String(lang));
 * ---
 *
 * <!-- As a link (slot content translated via i18n) -->
 * <ButtonLink href="/game">
 *   {t("index.start.game.label")}
 * </ButtonLink>
 *
 * <!-- As a button with icon (ariaLabel passed as translated string) -->
 * <ButtonLink href="/settings" variant="secondary" icon="mdi:close" ariaLabel={t("general.close")}>
 *   {t("general.close")}
 * </ButtonLink>
 *
 * <!-- With icon only (use translated aria-label directly) -->
 * <ButtonLink href="/settings" icon="mdi:settings" ariaLabel={t("nav.profile.description")} />
 *
 * Notes:
 * - Prefer passing translated strings (e.g. t("key")) for `ariaLabel` and slot content.
 * - This keeps accessibility labels consistent across locales and avoids hardcoded text.
 * ```
 */
import { getLangFromUrl, useTranslations } from "@utils/i18n";
import { Icon } from "astro-icon/components";

// Get current language and translations
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(String(lang));

type ButtonVariant = "primary" | "secondary";

interface Props {
  /** URL for the link. Required because the component always renders an anchor element */
  href: string;
  /** Accessible label for the button/link (important for screen readers).
   *  Prefer passing an i18n-translated string, e.g. `ariaLabel={t("general.close")}`.
   *  If omitted, consumers should ensure the accessible name is provided by surrounding context.
   */
  ariaLabel?: string;
  /** Ids of elements that describe this control (space separated). */
  ariaDescribedBy?: string;
  /** Additional CSS classes to apply */
  className?: string;
  /** Target attribute for links */
  target?: "_blank" | "_self" | "_parent" | "_top";
  /** Relationship attribute for links */
  rel?: string;
  /** Visual variant style */
  variant?: ButtonVariant;
  /** Optional icon name for astro-icon (e.g., "mdi:home", "heroicons:star") */
  icon?: string;
}

const rawProps = Astro.props as Props & Record<string, unknown>;

const {
  href,
  ariaLabel,
  ariaDescribedBy,
  className = "",
  target = "_self",
  rel,
  variant = "primary",
  icon,
} = rawProps;

// Ensure proper rel attribute for external links
const isExternal = target === "_blank";
const finalRel = isExternal ? `noopener noreferrer ${rel || ""}`.trim() : rel;

// Get translated text for external link indicator
const externalLinkText = t("nav.openNewWindow");

const baseClasses = "button-link";

const variantClasses: Record<ButtonVariant, string> = {
  primary: "button-link--primary",
  secondary: "button-link--secondary",
};

const classes = [baseClasses, variantClasses[variant], String(className)]
  .filter(Boolean)
  .join(" ");

// Icon classes
const iconClasses = "button-link__icon";

const ariaLabelAttr =
  (ariaLabel as string | undefined) ?? (rawProps["aria-label"] as string | undefined);

const ariaDescribedByAttr =
  (ariaDescribedBy as string | undefined) ??
  (rawProps["aria-describedby"] as string | undefined);

const forwardedAttrs = (() => {
  const restAttrs: Record<string, unknown> = { ...rawProps };
  // Remove known props so they are not duplicated on the anchor element
  for (const key of [
    "href",
    "ariaLabel",
    "ariaDescribedBy",
    "className",
    "target",
    "rel",
    "variant",
    "icon",
    "aria-describedby",
    "aria-label",
  ]) {
    if (key in restAttrs) {
      delete (restAttrs as Record<string, unknown>)[key];
    }
  }
  return restAttrs;
})();
---

<a
  {href}
  class={classes}
  aria-label={ariaLabelAttr
    ? `${ariaLabelAttr}${isExternal ? ` (${externalLinkText})` : ""}`
    : undefined}
  aria-describedby={ariaDescribedByAttr}
  {target}
  rel={finalRel}
  {...forwardedAttrs}
>
  {icon && <Icon name={icon} class={iconClasses} aria-hidden="true" />}
  <slot />
  {isExternal && <span class="button-link__sr"> ({externalLinkText})</span>}
</a>
<style>
  @media screen and (prefers-reduced-motion: reduce) {
    .button-link {
      display: inline-flex;
      gap: 0.6rem;
      align-items: center;
      justify-content: center;
      inline-size: 100%;
      min-inline-size: 48px;
      max-inline-size: 100%;
      min-block-size: 48px;
      padding: 0.75rem 1.5rem;
      font-size: 1.125rem;
      font-weight: 600;
      line-height: var(--line-height-snug);
      text-decoration: none;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 999px;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.75);
      transition: none;
    }
  }

  .button-link {
    display: inline-flex;
    gap: 0.6rem;
    align-items: center;
    justify-content: center;
    inline-size: 100%;
    min-inline-size: 48px;
    max-inline-size: 100%;
    min-block-size: 48px;
    padding: 0.75rem 1.5rem;
    font-size: 1.125rem;
    font-weight: 600;
    line-height: var(--line-height-snug);
    text-decoration: none;
    cursor: pointer;
    border: 2px solid transparent;
    border-radius: 999px;
    box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.75);
    transition:
      transform var(--transition-fast),
      box-shadow var(--transition-fast),
      background-color var(--transition-fast),
      border-color var(--transition-fast),
      color var(--transition-fast);
  }

  @media (width >= 640px) {
    .button-link {
      inline-size: auto;
    }
  }

  .button-link:focus-visible {
    outline: 3px solid var(--color-gn-amber-300);
    outline-offset: 2px;
    box-shadow:
      0 0 0 3px rgba(95, 199, 255, 0.35),
      4px 4px 0 rgba(0, 0, 0, 0.75);
  }

  .button-link:hover,
  .button-link:focus {
    box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.82);
    transform: translateY(-2px);
  }

  .button-link:active {
    box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.85);
    transform: translateY(0);
  }

  .button-link--primary {
    color: var(--gn-ink);
    background: var(--gn-bg-muted);
    border-color: var(--color-gn-amber-500);
  }

  .button-link--primary:hover,
  .button-link--primary:focus {
    background: color-mix(in srgb, var(--gn-bg-muted) 85%, var(--gn-ink) 15%);
  }

  .button-link--secondary {
    color: var(--gn-ink-muted);
    background: color-mix(in srgb, var(--gn-bg-muted) 85%, transparent);
    border-color: var(--gn-panel-border);
    backdrop-filter: blur(6px);
  }

  .button-link--secondary:hover,
  .button-link--secondary:focus {
    color: var(--gn-ink);
    background: color-mix(in srgb, var(--gn-bg-muted) 75%, transparent);
  }

  .button-link--sm {
    min-block-size: 36px;
    padding: 0.45rem 0.9rem;
    font-size: 1.125rem;
  }

  .button-link--md {
    min-block-size: 40px;
    padding: 0.55rem 1rem;
    font-size: 1.125rem;
  }

  .button-link__icon {
    display: block;
    flex-shrink: 0;
    inline-size: 1.1rem;
    block-size: 1.1rem;
  }

  .button-link__sr {
    position: absolute;
    inline-size: var(--sr-only-width);
    block-size: var(--sr-only-height);
    margin: var(--sr-only-margin);
    overflow: hidden;
    white-space: nowrap;
    border: 0;
    clip-path: var(--sr-only-clip-path);
  }
</style>
