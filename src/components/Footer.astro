---
/**
 * Footer Component - Responsive & Accessible
 *
 * A comprehensive site-wide footer with copyright, legal links, and external links.
 * Fully responsive with Tailwind CSS 4 for maintainability.
 *
 * @component
 * @example
 * ```astro
 * <Footer />
 * ```
 */
import { useTranslations, getLangFromUrl } from "@utils/i18n";
import { Icon } from "astro-icon/components";
import { getRelativeLocaleUrl } from "astro:i18n";

// Get current language for i18n
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(String(lang));

/**
 * Dynamic copyright year calculation
 */
const currentYear = new Date().getFullYear();

/**
 * Legal links configuration for each language with fallback support
 */
const nativeLanguages = ["en", "de"];

const getLegalPageUrl = (page: "legal-notice" | "privacy-policy"): string => {
  if (nativeLanguages.includes(lang)) {
    if (lang === "de") {
      return getRelativeLocaleUrl(lang, page === "legal-notice" ? "impressum" : "datenschutz");
    }
    return getRelativeLocaleUrl("en", page);
  }
  return getRelativeLocaleUrl("en", page);
};

const legalLinks = [
  {
    href: getLegalPageUrl("legal-notice"),
    label: t("footer.impressum"),
    ariaLabel: t("footer.impressum_aria"),
  },
  {
    href: getLegalPageUrl("privacy-policy"),
    label: t("footer.privacy"),
    ariaLabel: t("footer.privacy_aria"),
  },
];

/**
 * External link configuration with accessibility and i18n support
 */
const links = [
  {
    href: "https://github.com/dcschmid/melody-mind",
    icon: "github",
    label: "GitHub",
    ariaLabel: t("footer.source_code"),
  },
  {
    href: "https://www.paypal.me/dcschmid",
    icon: "paypal",
    label: t("footer.donate"),
    ariaLabel: t("footer.donate_aria"),
  },
  {
    href: "https://www.buymeacoffee.com/dcschmid",
    icon: "kofi",
    label: "Ko-fi",
    ariaLabel: t("footer.support_kofi"),
  },
];
---

<footer
  class="mt-16 border-t border-gray-700 py-6 font-primary md:mt-12 md:py-4 sm:mt-8 sm:py-3"
  role="contentinfo"
  aria-label="Site footer"
>
  <div class="mx-auto max-w-7xl px-4 md:px-3 sm:px-2">
    <div
      class="flex flex-col items-center gap-4 md:flex-row md:justify-between md:items-center md:gap-8 sm:gap-2"
    >
      <!-- Copyright and Legal Links -->
      <div class="flex flex-col gap-3 items-center md:items-start sm:gap-2">
        <div class="text-base md:text-lg text-gray-300 text-center md:text-left sm:text-sm">
          &copy; {currentYear} MelodyMind - {t("footer.rights")}
        </div>
        <nav
          aria-label="Legal information"
          class="flex gap-4 flex-wrap justify-center md:justify-start sm:gap-3"
        >
          {
            legalLinks.map((link) => (
              <a
                href={link.href}
                class="text-gray-300 no-underline text-base md:text-lg font-medium px-3 py-2 rounded-lg transition-colors duration-200 hover:text-purple-400 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 min-h-[48px] inline-flex items-center sm:text-sm sm:px-2 sm:py-1"
                aria-label={link.ariaLabel}
              >
                {link.label}
              </a>
            ))
          }
        </nav>
      </div>

      <!-- External Links -->
      <nav
        aria-label="Footer links"
        class="flex gap-4 flex-wrap justify-center md:justify-end sm:gap-3"
      >
        <!-- GitHub Link -->
        <a
          href={links[0].href}
          target="_blank"
          rel="noopener noreferrer"
          class="text-gray-300 no-underline text-base md:text-lg font-medium flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 hover:text-purple-400 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 min-h-[48px] sm:text-sm sm:px-3 sm:py-2 sm:gap-1"
          aria-label={links[0].ariaLabel}
        >
          <Icon
            name={links[0].icon}
            width="18"
            height="18"
            aria-hidden="true"
            focusable="false"
            class="sm:w-4 sm:h-4"
          />
          <span>{links[0].label}</span>
          <span class="sr-only">(opens in a new tab)</span>
        </a>

        <!-- Donation Links -->
        {
          links.slice(1).map((link) => (
            <a
              href={link.href}
              target="_blank"
              rel="noopener noreferrer"
              class="text-gray-300 no-underline text-base md:text-lg font-medium flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 hover:text-purple-400 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 min-h-[48px] sm:text-sm sm:px-3 sm:py-2 sm:gap-1"
              aria-label={link.ariaLabel}
            >
              <Icon
                name={link.icon}
                width="18"
                height="18"
                aria-hidden="true"
                focusable="false"
                class="sm:w-4 sm:h-4"
              />
              <span>{link.label}</span>
              <span class="sr-only">(opens in a new tab)</span>
            </a>
          ))
        }
      </nav>
    </div>
  </div>
</footer>
