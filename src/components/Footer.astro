---
/**
 * Footer Component - Responsive & Accessible
 *
 * A comprehensive site-wide footer with copyright, legal links, and external links.
 * Fully responsive with Tailwind CSS 4 for maintainability.
 *
 * @component
 * @example
 * ```astro
 * <Footer />
 * ```
 */
import { useTranslations, getLangFromUrl } from "@utils/i18n";
import { Icon } from "astro-icon/components";
import { getRelativeLocaleUrl } from "astro:i18n";

// Get current language for i18n
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(String(lang));

/**
 * Dynamic copyright year calculation
 */
const currentYear = new Date().getFullYear();

/**
 * Legal links configuration for each language with fallback support
 */
const nativeLanguages = ["en", "de"];

const getLegalPageUrl = (page: "legal-notice" | "privacy-policy"): string => {
  if (nativeLanguages.includes(lang)) {
    if (lang === "de") {
      return getRelativeLocaleUrl(lang, page === "legal-notice" ? "impressum" : "datenschutz");
    }
    return getRelativeLocaleUrl("en", page);
  }
  return getRelativeLocaleUrl("en", page);
};

const legalLinks = [
  {
    href: getLegalPageUrl("legal-notice"),
    label: t("pages.imprint.title"),
    ariaLabel: t("footer.impressum_aria"),
  },
  {
    href: getLegalPageUrl("privacy-policy"),
    label: t("pages.privacy.title"),
    ariaLabel: t("footer.privacy_aria"),
  },
];

/**
 * External link configuration with accessibility and i18n support
 */
const links = [
  {
    href: "https://github.com/dcschmid/melody-mind",
    icon: "github",
    label: t("footer.github"),
    ariaLabel: t("footer.source_code"),
  },
  {
    href: "https://www.paypal.me/dcschmid",
    icon: "paypal",
    label: t("footer.donate"),
    ariaLabel: t("footer.donate_aria"),
  },
  {
    href: "https://www.buymeacoffee.com/dcschmid",
    icon: "kofi",
    label: t("footer.kofi"),
    ariaLabel: t("footer.support_kofi"),
  },
];
---

<footer
  class="font-primary mt-16 border-t border-gray-700 py-6 sm:mt-8 sm:py-3 md:mt-12 md:py-4"
  role="contentinfo"
  aria-label={t("footer.aria")}
>
  <div class="mx-auto max-w-7xl px-4 sm:px-2 md:px-3">
    <div
      class="flex flex-col items-center gap-4 sm:gap-2 md:flex-row md:items-center md:justify-between md:gap-8"
    >
      <!-- Copyright and Legal Links -->
      <div class="flex flex-col items-center gap-3 sm:gap-2 md:items-start">
        <div class="text-center text-base text-gray-300 sm:text-sm md:text-left md:text-lg">
          &copy; {currentYear} MelodyMind - {t("footer.rights")}
        </div>
        <nav
          aria-label={t("footer.legal_nav")}
          class="flex flex-wrap justify-center gap-4 sm:gap-3 md:justify-start"
        >
          {
            legalLinks.map((link) => (
              <a
                href={link.href}
                class="inline-flex min-h-[48px] items-center rounded-lg px-3 py-2 text-base font-medium text-gray-300 no-underline transition-colors duration-200 hover:bg-gray-800 hover:text-purple-400 focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:outline-none sm:px-2 sm:py-1 sm:text-sm md:text-lg"
                aria-label={link.ariaLabel}
              >
                {link.label}
              </a>
            ))
          }
        </nav>
      </div>

      <!-- External Links -->
      <nav
        aria-label={t("footer.external_nav")}
        class="flex flex-wrap justify-center gap-4 sm:gap-3 md:justify-end"
      >
        <!-- GitHub Link -->
        <a
          href={links[0].href}
          target="_blank"
          rel="noopener noreferrer"
          class="music-platform-link external-link flex min-h-[48px] items-center gap-2 rounded-lg px-4 py-3 text-base font-medium text-gray-300 no-underline transition-all duration-200 hover:bg-gray-800 hover:text-purple-400 focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:outline-none sm:gap-1 sm:px-3 sm:py-2 sm:text-sm md:text-lg"
          aria-label={links[0].ariaLabel}
          data-external-label="github"
        >
          <Icon
            name={links[0].icon}
            width="18"
            height="18"
            aria-hidden="true"
            focusable="false"
            class="sm:h-4 sm:w-4"
          />
          <span>{links[0].label}</span>
          <span class="sr-only">{t("footer.opens_in_new_tab")}</span>
        </a>

        <!-- Donation Links -->
        {
          links.slice(1).map((link) => (
            <a
              href={link.href}
              target="_blank"
              rel="noopener noreferrer"
              class="external-link flex min-h-[48px] items-center gap-2 rounded-lg px-4 py-3 text-base font-medium text-gray-300 no-underline transition-all duration-200 hover:bg-gray-800 hover:text-purple-400 focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:outline-none sm:gap-1 sm:px-3 sm:py-2 sm:text-sm md:text-lg"
              aria-label={link.ariaLabel}
              data-external-label={link.label}
            >
              <Icon
                name={link.icon}
                width="18"
                height="18"
                aria-hidden="true"
                focusable="false"
                class="sm:h-4 sm:w-4"
              />
              <span>{link.label}</span>
              <span class="sr-only">{t("footer.opens_in_new_tab")}</span>
            </a>
          ))
        }
      </nav>
    </div>
  </div>
</footer>

<script>
  import { initMusicButtons } from "@utils/components/musicButtonsUtils";

  document.addEventListener("DOMContentLoaded", () => {
    try {
      // Track both music platform links and generic external links
      initMusicButtons({ linkSelector: ".external-link, .music-platform-link" });
    } catch (e) {
      // keep footer resilient if tracking fails
      console.error("initMusicButtons failed", e);
    }
  });
</script>
