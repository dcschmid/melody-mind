---
import { Picture } from "astro:assets";
import { useTranslations } from "@utils/i18n";
import ButtonLink from "./ButtonLink.astro";
import Headline from "@components/Headline.astro";
import Paragraph from "@components/Paragraph.astro";
import type { PlayableCategory } from "@utils/features/dailyChallenge";
import { pickDailyCategory } from "@utils/features/dailyChallenge";

interface Props {
  lang: string;
  categories: PlayableCategory[];
}

const { lang, categories } = Astro.props as Props;
const t = useTranslations(String(lang));

const todayCategory = pickDailyCategory(categories);
---

{
  todayCategory && (
    <section
      id="daily-challenge"
      class="relative overflow-hidden rounded-xl border-2 border-purple-700 bg-gradient-to-b from-gray-800 to-gray-900 shadow-lg"
      aria-labelledby="daily-challenge-title"
    >
      <div
        class="absolute top-0 left-0 h-1 w-full bg-gradient-to-r from-purple-700 via-purple-500 to-purple-700"
        aria-hidden="true"
      />
      <div class="relative aspect-video w-full overflow-hidden border-b border-white/10">
        {/^https?:\/\//.test(todayCategory.imageUrl) ? (
          <img
            src={todayCategory.imageUrl}
            alt={t("daily.challenge.image.alt", { category: todayCategory.headline })}
            class="h-full w-full object-cover"
            loading="eager"
            fetchpriority="high"
            width="1280"
            height="720"
            decoding="async"
          />
        ) : (
          <Picture
            src={todayCategory.imageUrl}
            alt={t("daily.challenge.image.alt", { category: todayCategory.headline })}
            widths={[640, 960, 1280]}
            sizes="(max-width: 800px) 100vw, 800px"
            formats={["avif", "webp", "jpg"]}
            width={1280}
            height={720}
            loading="eager"
            fetchpriority="high"
            decoding="async"
          />
        )}
        <div
          class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent"
          aria-hidden="true"
        />
      </div>
      <div class="p-5 sm:p-6">
        <div id="daily-challenge-title" class="mb-4 text-center">
          <Headline level="h2" textSize="base" textAlign="center">
            {t("daily.challenge.title")}
          </Headline>
        </div>
        <div class="text-center">
          <Paragraph textSize="base" textAlign="center" className="font-medium text-white mb-2">
            {todayCategory.headline}
          </Paragraph>
          <Paragraph textSize="sm" textAlign="center" className="m-0 text-violet-200">
            {t("daily.challenge.subtitle")}
          </Paragraph>
        </div>
        <div
          class="mt-6 flex justify-center"
          role="group"
          aria-label={t("daily.challenge.cta.group")}
        >
          <ButtonLink
            href={`/${lang}/time-pressure-${todayCategory.slug}`}
            icon="zap"
            className="w-full sm:w-auto"
          >
            {t("game.timepressure.title")} <span class="sr-only"> â€“ {todayCategory.headline}</span>
          </ButtonLink>
        </div>
      </div>
      <div
        class="absolute right-0 bottom-0 left-0 h-1 origin-left scale-x-0 transform bg-gradient-to-r from-purple-600 via-blue-600 to-purple-600 transition-transform duration-300"
        aria-hidden="true"
      />
    </section>
  )
}
