---
/**
 * Paragraph Component
 *
 * A fully accessible, performance-optimized paragraph component for displaying text content
 * throughout the MelodyMind application. This component follows WCAG AAA standards for
 * accessibility and is optimized for both performance and maintainability.
 *
 * Features:
 * - WCAG AAA 2.2 compliant with 7:1 contrast ratio using CSS custom properties
 * - Text spacing support (2x letter spacing, 1.5x line height, 2x paragraph spacing)
 * - Text resizing support up to 400% without loss of functionality
 * - Enhanced focus appearance with 4.5:1 contrast ratio (WCAG 2.2)
 * - Touch targets minimum 44x44px for mobile accessibility
 * - Responsive typography using CSS variables and media queries
 * - Screen reader optimizations with proper ARIA attributes
 * - Configurable text alignment and sizing using CSS custom properties
 * - High contrast mode for enhanced accessibility
 * - Support for reduced motion preferences
 * - Uses only CSS custom properties from global.css (no hardcoded values)
 *
 * Usage example:
 * ```astro
 * <Paragraph
 *   description="This is a text paragraph"
 *   textSize="lg"
 *   align="center"
 *   highContrast={true}
 *   enhancedSpacing={true}
 *   interactive={false}
 * />
 * ```
 *
 * @component Paragraph
 */
interface Props {
  /** Text content as an alternative to using slots */
  description?: string;

  /** Text size variant using CSS custom properties (xs, sm, base, lg, xl, 2xl, 3xl, 4xl) */
  textSize?: "xs" | "sm" | "base" | "lg" | "xl" | "2xl" | "3xl" | "4xl";

  /** Additional CSS classes for customization */
  className?: string;

  /** Optional ID for the paragraph, important for ARIA references and anchor links */
  id?: string;

  /** Text alignment (start, center, end) */
  align?: "start" | "center" | "end";

  /** Language attribute for the text, important for screen readers and pronunciation */
  lang?: string;

  /** Optional ARIA label for improved screen reader support */
  ariaLabel?: string;

  /** Optional ARIA live setting for dynamic content announcements */
  ariaLive?: "off" | "polite" | "assertive";

  /** Set to true to make text high-contrast for better accessibility (WCAG AAA 7:1 ratio) */
  highContrast?: boolean;

  /** Support for enhanced text spacing (WCAG 2.2 AAA requirement) */
  enhancedSpacing?: boolean;

  /** Set to true for interactive paragraph content that requires focus management */
  interactive?: boolean;
}

const {
  description,
  textSize = "xl",
  className = "",
  id,
  align = "start",
  lang,
  ariaLabel,
  ariaLive,
  highContrast = false,
  enhancedSpacing = false,
  interactive = false,
} = Astro.props;

// Generate CSS classes based on props using CSS custom properties
const textAlignClass = `paragraph--align-${align}`;
const textSizeClass = `paragraph--size-${textSize}`;
const contrastClass = highContrast ? "paragraph--high-contrast" : "";
const spacingClass = enhancedSpacing ? "paragraph--enhanced-spacing" : "";
const interactiveClass = interactive ? "paragraph--interactive" : "";

// Compose all CSS classes for the paragraph
const paragraphClasses = [
  "paragraph",
  textSizeClass,
  textAlignClass,
  contrastClass,
  spacingClass,
  interactiveClass,
  className,
]
  .filter(Boolean)
  .join(" ");
---

<p class={paragraphClasses} {id} {lang} aria-label={ariaLabel} aria-live={ariaLive}>
  {description || <slot />}
</p>

<style lang="scss">
  /* ======================================
   * PARAGRAPH COMPONENT - BEM STYLE
   * WCAG AAA 2.2 COMPLIANT STYLES
   * Optimized for responsive design and global.css integration
   * ====================================== */

  /* ======================================
   * BASE PARAGRAPH STYLES
   * ====================================== */
  .paragraph {
    // Base typography using global.css variables
    font-family: var(--font-family-primary);
    font-weight: var(--font-normal);
    line-height: var(--leading-relaxed);
    letter-spacing: var(--letter-spacing-base);
    margin: 0 0 var(--space-xl) 0;
    color: var(--text-secondary);

    // Enhanced text rendering for better readability
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;

    // Smooth transitions using CSS custom properties
    transition: all var(--transition-normal);

    // WCAG 2.2 AAA: Support for text resizing up to 400%
    max-width: 100%;
    overflow-wrap: break-word;
    word-wrap: break-word;
    hyphens: auto;
    text-wrap: balance;

    // Enhanced text spacing support (WCAG 2.2)
    letter-spacing: max(var(--letter-spacing-base), var(--letter-spacing-enhanced));
    line-height: max(var(--leading-relaxed), var(--line-height-enhanced));
    word-spacing: max(normal, var(--word-spacing-enhanced));

    // ======================================
    // SIZE VARIANTS - RESPONSIVE TYPOGRAPHY
    // ======================================

    // Mobile-first responsive sizing
    &--size-xs {
      font-size: var(--text-xs);
    }

    &--size-sm {
      font-size: var(--text-sm);
    }

    &--size-base {
      font-size: var(--text-base);
    }

    &--size-lg {
      font-size: var(--text-lg);
    }

    &--size-xl {
      font-size: var(--text-xl);
    }

    &--size-2xl {
      font-size: var(--text-2xl);
    }

    &--size-3xl {
      font-size: var(--text-3xl);
    }

    &--size-4xl {
      font-size: var(--text-4xl);
    }

    // ======================================
    // RESPONSIVE BREAKPOINT ADJUSTMENTS
    // ======================================

    // Tablet breakpoint (md)
    @media (min-width: var(--breakpoint-md)) {
      &--size-xl {
        font-size: var(--text-2xl);
      }

      &--size-2xl {
        font-size: var(--text-3xl);
      }

      &--size-3xl {
        font-size: var(--text-4xl);
      }

      &--size-4xl {
        font-size: calc(var(--text-4xl) * 1.25);
      }
    }

    // Desktop breakpoint (lg)
    @media (min-width: var(--breakpoint-lg)) {
      &--size-2xl {
        font-size: var(--text-4xl);
      }

      &--size-3xl {
        font-size: calc(var(--text-4xl) * 1.25);
      }

      &--size-4xl {
        font-size: calc(var(--text-4xl) * 1.5);
      }
    }

    // Large desktop breakpoint (xl)
    @media (min-width: var(--breakpoint-xl)) {
      &--size-3xl {
        font-size: calc(var(--text-4xl) * 1.5);
      }

      &--size-4xl {
        font-size: calc(var(--text-4xl) * 2);
      }
    }

    // ======================================
    // TEXT ALIGNMENT
    // ======================================

    &--align-start {
      text-align: left;
    }

    &--align-center {
      text-align: center;
    }

    &--align-end {
      text-align: right;
    }

    // ======================================
    // ACCESSIBILITY VARIANTS
    // ======================================

    // High contrast mode for enhanced accessibility (WCAG AAA 7:1 ratio)
    &--high-contrast {
      color: var(--text-primary);
      font-weight: var(--font-medium);
    }

    // Enhanced text spacing for WCAG 2.2 AAA compliance
    &--enhanced-spacing {
      letter-spacing: var(--text-spacing-letter-2x);
      line-height: var(--text-spacing-line-1-5x);
      margin-bottom: calc(var(--space-xl) * 2);
      word-spacing: var(--text-spacing-word-enhanced);
    }

    // ======================================
    // INTERACTIVE STATES
    // ======================================

    // Interactive paragraph styling with proper focus management
    &--interactive {
      cursor: pointer;
      min-height: var(--min-touch-size);
      min-width: var(--min-touch-size);
      padding: var(--space-sm);
      border-radius: var(--radius-sm);
      transition: all var(--transition-normal);

      &:hover {
        background-color: var(--focus-bg-overlay);
        transform: translateY(var(--animation-y-offset-small));
      }

      &:active {
        transform: translateY(0);
      }

      &:focus {
        outline: var(--focus-outline);
        outline-offset: var(--focus-ring-offset);
        box-shadow: var(--focus-ring);
        background-color: var(--focus-bg-overlay);
        border-radius: var(--radius-sm);
      }
    }

    // Focus styles for when paragraph contains interactive content
    &:focus-within {
      outline: var(--focus-outline);
      outline-offset: var(--focus-ring-offset);
      box-shadow: var(--focus-ring);
    }

    // ======================================
    // RESPONSIVE LAYOUT OPTIMIZATIONS
    // ======================================

    // Optimal reading line length for larger screens
    @media (min-width: var(--breakpoint-sm)) {
      max-width: var(--content-readable-width);
    }

    // Enhanced spacing for larger screens
    @media (min-width: var(--breakpoint-lg)) {
      margin-bottom: var(--space-2xl);

      &--enhanced-spacing {
        margin-bottom: calc(var(--space-2xl) * 2);
      }
    }

    // ======================================
    // USER CUSTOMIZATION SUPPORT
    // ======================================

    // Ensure text remains readable with user customizations
    &[style*="letter-spacing"],
    &[style*="line-height"],
    &[style*="word-spacing"] {
      overflow: visible;
      text-overflow: clip;
    }
  }

  // ======================================
  // ACCESSIBILITY ENHANCEMENTS
  // ======================================

  // Reduced motion support for accessibility
  @media (prefers-reduced-motion: reduce) {
    .paragraph {
      transition: none;

      &--interactive {
        &:hover {
          transform: none;
        }

        &:active {
          transform: none;
        }
      }
    }
  }

  // ======================================
  // PRINT STYLES
  // ======================================

  @media print {
    .paragraph {
      color: var(--print-text) !important;
      font-size: 12pt !important;
      line-height: var(--leading-normal) !important;
      margin-bottom: var(--space-md) !important;
      background: none !important;

      &--high-contrast {
        color: var(--print-text) !important;
      }

      &--enhanced-spacing {
        letter-spacing: normal !important;
        line-height: var(--leading-normal) !important;
        margin-bottom: var(--space-md) !important;
      }
    }
  }

  // ======================================
  // HIGH CONTRAST MODE SUPPORT
  // ======================================

  // High Contrast Mode Support for Windows
  @media (forced-colors: active) {
    .paragraph {
      color: CanvasText;
      forced-color-adjust: none;

      &--high-contrast {
        color: CanvasText;
      }

      &--interactive {
        &:hover,
        &:focus {
          background-color: Highlight;
          color: HighlightText;
        }
      }
    }
  }
</style>
