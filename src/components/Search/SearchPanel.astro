---
/**
 * Lightweight Search Panel
 *
 * Provides the consistent markup needed by `initSearchPanel` without the previous
 * prop explosion. Only the essentials remain: ids/labels and optional text templates
 * for the auto-managed status + no-results helpers.
 */
export interface Props {
  idBase: string;
  label: string;
  placeholder: string;
  ariaControls: string;
  /** Text shown when all items visible */
  statusAllText?: string;
  /** Template for results count (use {count}) */
  statusCountTemplate?: string;
  /** Template for no results (use {term}) */
  noResultsTemplate?: string;
}

const {
  idBase,
  label,
  placeholder,
  ariaControls,
  statusAllText = "Showing all",
  statusCountTemplate = "{count} results",
  noResultsTemplate = 'No results for "{term}"',
} = Astro.props as Props;

const inputId = `${idBase}-input`;
const clearId = `${idBase}-clear`;
const resetId = `${idBase}-reset`;
const inputClasses = "search-panel__input";
---

<div class="search-panel" data-search-root>
  <div class="search-panel__field">
    <label for={inputId} class="search-panel__sr">{label}</label>
    <div class="search-panel__icon">
      <svg aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
    </div>
    <input
      id={inputId}
      type="search"
      class={inputClasses}
      {placeholder}
      aria-controls={ariaControls}
      autocomplete="off"
      data-search-input
    />
    <button
      id={clearId}
      class="search-panel__clear"
      type="button"
      aria-label="Clear search"
      data-search-clear
      hidden
      aria-hidden="true"
      tabindex="-1"
    >
      <svg aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>
  <div class="search-panel__reset-wrap">
    <button
      id={resetId}
      class="search-panel__reset"
      type="button"
      aria-controls={ariaControls}
      data-search-reset
    >
      <svg
        class="search-panel__reset-icon"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 4v6h6M20 20v-6h-6"></path>
      </svg>
      <span>Reset</span>
    </button>
  </div>
  <div
    id={`${idBase}-status`}
    data-search-status
    class="search-panel__status"
    role="status"
    aria-live="polite"
    data-search-status-all={statusAllText}
    data-search-status-count={statusCountTemplate}
  >
  </div>
  <div
    id={`${idBase}-no-results`}
    data-search-no-results
    hidden
    data-search-no-results-tpl={noResultsTemplate}
    class="search-panel__no-results"
  >
  </div>
  <slot name="status" />
  <slot name="no-results" />
</div>
<style>
  .search-panel {
    width: 100%;
  }

  .search-panel__field {
    position: relative;
  }

  .search-panel__sr {
    position: absolute;
    width: var(--sr-only-width);
    height: var(--sr-only-height);
    padding: 0;
    margin: var(--sr-only-margin);
    overflow: hidden;
    clip-path: var(--sr-only-clip-path);
    white-space: nowrap;
    border: 0;
  }

  .search-panel__icon {
    position: absolute;
    inset-block: 0;
    left: 0;
    display: flex;
    align-items: center;
    padding-left: 1.5rem;
    color: var(--color-gn-amber-300);
    pointer-events: none;
  }

  .search-panel__icon svg {
    display: block;
    width: 1.75rem;
    height: 1.75rem;
  }

  .search-panel__input {
    width: 100%;
    border-radius: 1.5rem;
    border: 2px solid var(--gn-panel-border);
    background: color-mix(in srgb, var(--gn-bg) 80%, transparent);
    padding: 0.95rem 4rem 0.95rem 3.5rem;
    font-size: 1.05rem;
    font-weight: 600;
    color: var(--gn-ink);
    box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.75);
    transition:
      border-color var(--transition-fast),
      box-shadow var(--transition-fast),
      background-color var(--transition-fast);
  }

  @media (min-width: 640px) {
    .search-panel__input {
      padding: 1.1rem 4.5rem 1.1rem 4rem;
      font-size: 1.2rem;
    }
  }

  .search-panel__input::placeholder {
    color: var(--gn-ink-muted);
  }

  .search-panel__input:hover {
    border-color: var(--color-gn-amber-300);
    box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.8);
  }

  .search-panel__input:focus-visible {
    outline: none;
    border-color: var(--color-gn-amber-300);
    box-shadow:
      0 0 0 4px rgba(95, 199, 255, 0.35),
      6px 6px 0 rgba(0, 0, 0, 0.85);
  }

  .search-panel__clear {
    position: absolute;
    inset-block: 0;
    right: 0;
    display: inline-flex;
    align-items: center;
    min-height: 44px;
    padding-right: 1.5rem;
    color: var(--gn-ink-muted);
    background: transparent;
    border: none;
    cursor: pointer;
    transition: color var(--transition-fast);
  }

  .search-panel__clear svg {
    width: 1.5rem;
    height: 1.5rem;
  }

  .search-panel__clear:hover {
    color: var(--color-gn-amber-300);
  }

  .search-panel__clear:focus-visible {
    outline: 3px solid var(--color-gn-amber-300);
    outline-offset: 2px;
  }

  .search-panel__reset {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    min-height: 44px;
    padding: 0.65rem 1.5rem;
    border-radius: 0.85rem;
    border: 2px solid var(--gn-panel-border);
    background: var(--color-gn-amber-500);
    color: var(--color-gn-soot-950);
    font-weight: 600;
    box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.8);
    transition:
      transform var(--transition-fast),
      box-shadow var(--transition-fast),
      background-color var(--transition-fast);
  }

  .search-panel__reset:hover {
    background: var(--color-gn-amber-400);
    transform: translateY(-2px);
    box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.85);
  }

  .search-panel__reset:focus-visible {
    outline: 3px solid var(--color-gn-amber-300);
    outline-offset: 2px;
  }

  .search-panel__reset-icon {
    display: block;
    width: 1.25rem;
    height: 1.25rem;
    flex-shrink: 0;
  }

  .search-panel__reset-wrap {
    margin-top: 1.5rem;
    text-align: center;
  }

  .search-panel__status {
    margin-top: 0.75rem;
    text-align: center;
    font-size: 0.75rem;
    color: var(--gn-ink-muted);
  }

  @media (min-width: 640px) {
    .search-panel__status {
      font-size: 0.85rem;
    }
  }

  .search-panel__no-results {
    margin-top: 1rem;
    text-align: center;
    font-size: 0.85rem;
    color: var(--gn-ink-muted);
  }
</style>
