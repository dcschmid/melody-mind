---
/**
 * Lightweight Search Panel
 *
 * Provides the consistent markup needed by `initSearchPanel` without the previous
 * prop explosion. Only the essentials remain: ids/labels and optional text templates
 * for the auto-managed status + no-results helpers.
 */
export interface Props {
  idBase: string;
  label: string;
  placeholder: string;
  ariaControls: string;
  /** Text shown when all items visible */
  statusAllText?: string;
  /** Template for results count (use {count}) */
  statusCountTemplate?: string;
  /** Template for no results (use {term}) */
  noResultsTemplate?: string;
}

const {
  idBase,
  label,
  placeholder,
  ariaControls,
  statusAllText = "Showing all",
  statusCountTemplate = "{count} results",
  noResultsTemplate = 'No results for "{term}"',
} = Astro.props as Props;

const inputId = `${idBase}-input`;
const clearId = `${idBase}-clear`;
const resetId = `${idBase}-reset`;
const inputClasses = "search-panel__input";
---

<div class="search-panel" data-search-root>
  <div class="search-panel__bar">
    <div class="search-panel__field">
      <label for={inputId} class="search-panel__sr">{label}</label>
      <div class="search-panel__icon">
        <svg aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>
      <input
        id={inputId}
        type="search"
        class={inputClasses}
        {placeholder}
        aria-controls={ariaControls}
        autocomplete="off"
        data-search-input
      />
      <button
        id={clearId}
        class="search-panel__clear"
        type="button"
        aria-label="Clear search"
        data-search-clear
        hidden
        aria-hidden="true"
        tabindex="-1"
      >
        <svg aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    <button
      id={resetId}
      class="search-panel__reset"
      type="button"
      aria-controls={ariaControls}
      data-search-reset
    >
      <svg
        class="search-panel__reset-icon"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 4v6h6M20 20v-6h-6"></path>
      </svg>
      <span>Reset</span>
    </button>
  </div>
  <div class="search-panel__meta">
    <div
      id={`${idBase}-status`}
      data-search-status
      class="search-panel__status"
      role="status"
      aria-live="polite"
      data-search-status-all={statusAllText}
      data-search-status-count={statusCountTemplate}
    >
    </div>
    <div
      id={`${idBase}-no-results`}
      data-search-no-results
      hidden
      data-search-no-results-tpl={noResultsTemplate}
      class="search-panel__no-results"
    >
    </div>
    <slot name="status" />
    <slot name="no-results" />
  </div>
</div>
<style>
  .search-panel {
    display: grid;
    gap: 0.9rem;
    inline-size: 100%;
  }

  .search-panel__bar {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    align-items: center;
  }

  .search-panel__field {
    position: relative;
    flex: 1 1 18rem;
    min-inline-size: 0;
  }

  .search-panel__sr {
    position: absolute;
    inline-size: var(--sr-only-width);
    block-size: var(--sr-only-height);
    padding: 0;
    margin: var(--sr-only-margin);
    overflow: hidden;
    white-space: nowrap;
    border: 0;
    clip-path: var(--sr-only-clip-path);
  }

  .search-panel__icon {
    position: absolute;
    inset-block: 0;
    inset-inline-start: 0;
    display: flex;
    align-items: center;
    padding-inline-start: 1.25rem;
    color: color-mix(in srgb, var(--gn-ink) 70%, transparent);
    pointer-events: none;
  }

  .search-panel__icon svg {
    display: block;
    inline-size: 1.5rem;
    block-size: 1.5rem;
  }

  @media screen and (prefers-reduced-motion: reduce) {
    .search-panel__input {
      inline-size: 100%;
      padding: 0.9rem 3.75rem 0.9rem 3.1rem;
      font-size: 1.05rem;
      font-weight: 600;
      color: var(--gn-ink);
      background: linear-gradient(
        140deg,
        color-mix(in srgb, var(--gn-bg) 90%, transparent),
        color-mix(in srgb, var(--gn-bg-muted) 80%, transparent)
      );
      border: 1px solid color-mix(in srgb, var(--gn-panel-border) 70%, transparent);
      border-radius: 999px;
      box-shadow:
        0 10px 24px rgba(7, 12, 24, 0.25),
        inset 0 1px 0 color-mix(in srgb, var(--gn-ink) 8%, transparent);
      transition: none;
    }
  }

  .search-panel__input {
    inline-size: 100%;
    padding: 0.9rem 3.75rem 0.9rem 3.1rem;
    font-size: 1.05rem;
    font-weight: 600;
    color: var(--gn-ink);
    background: linear-gradient(
      140deg,
      color-mix(in srgb, var(--gn-bg) 90%, transparent),
      color-mix(in srgb, var(--gn-bg-muted) 80%, transparent)
    );
    border: 1px solid color-mix(in srgb, var(--gn-panel-border) 70%, transparent);
    border-radius: 999px;
    box-shadow:
      0 10px 24px rgba(7, 12, 24, 0.25),
      inset 0 1px 0 color-mix(in srgb, var(--gn-ink) 8%, transparent);
    transition:
      border-color var(--transition-fast),
      box-shadow var(--transition-fast),
      background-color var(--transition-fast),
      transform var(--transition-fast);
  }

  @media (width >= 640px) {
    .search-panel__input {
      padding: 1.05rem 4rem 1.05rem 3.4rem;
      font-size: 1.15rem;
    }
  }

  .search-panel__input::placeholder {
    color: var(--gn-ink-muted);
  }

  .search-panel__input:hover,
  .search-panel__input:focus {
    border-color: color-mix(in srgb, var(--color-gn-amber-300) 70%, transparent);
    box-shadow:
      0 12px 26px rgba(7, 12, 24, 0.32),
      inset 0 1px 0 color-mix(in srgb, var(--gn-ink) 10%, transparent);
    transform: translateY(-1px);
  }

  .search-panel__input:focus-visible {
    outline: 3px solid var(--color-gn-amber-300);
    outline-offset: 2px;
    border-color: color-mix(in srgb, var(--color-gn-amber-300) 80%, transparent);
    box-shadow:
      0 0 0 4px color-mix(in srgb, var(--color-gn-amber-300) 35%, transparent),
      0 16px 28px rgba(7, 12, 24, 0.38);
  }

  @media screen and (prefers-reduced-motion: reduce) {
    .search-panel__clear {
      position: absolute;
      inset-block: 0;
      inset-inline-end: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-block-size: 44px;
      padding-inline: 0.35rem 0.85rem;
      color: color-mix(in srgb, var(--gn-ink) 70%, transparent);
      cursor: pointer;
      background: transparent;
      border: none;
      transition: none;
    }
  }

  .search-panel__clear {
    position: absolute;
    inset-block: 0;
    inset-inline-end: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-block-size: 44px;
    padding-inline: 0.35rem 0.85rem;
    color: color-mix(in srgb, var(--gn-ink) 70%, transparent);
    cursor: pointer;
    background: transparent;
    border: none;
    transition:
      color var(--transition-fast),
      transform var(--transition-fast);
  }

  .search-panel__clear svg {
    inline-size: 1.2rem;
    block-size: 1.2rem;
    padding: 0.35rem;
    background: color-mix(in srgb, var(--gn-bg) 75%, transparent);
    border-radius: 999px;
    box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--gn-ink) 10%, transparent);
  }

  .search-panel__clear:hover,
  .search-panel__clear:focus {
    color: var(--color-gn-amber-300);
    transform: translateY(-1px);
  }

  .search-panel__clear:focus-visible {
    outline: 2px solid color-mix(in srgb, var(--color-gn-amber-300) 70%, transparent);
    outline-offset: 3px;
  }

  @media screen and (prefers-reduced-motion: reduce) {
    .search-panel__reset {
      display: inline-flex;
      gap: 0.75rem;
      align-items: center;
      min-block-size: 44px;
      padding: 0.7rem 1.35rem;
      font-weight: 600;
      color: var(--color-gn-soot-950);
      white-space: nowrap;
      cursor: pointer;
      background: linear-gradient(
        135deg,
        color-mix(in srgb, var(--color-gn-amber-400) 85%, transparent),
        color-mix(in srgb, var(--color-gn-amber-300) 75%, transparent)
      );
      border: 1px solid color-mix(in srgb, var(--gn-panel-border) 70%, transparent);
      border-radius: 999px;
      box-shadow:
        0 12px 24px rgba(7, 12, 24, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.45);
      transition: none;
    }
  }

  .search-panel__reset {
    display: inline-flex;
    gap: 0.75rem;
    align-items: center;
    min-block-size: 44px;
    padding: 0.7rem 1.35rem;
    font-weight: 600;
    color: var(--color-gn-soot-950);
    white-space: nowrap;
    cursor: pointer;
    background: linear-gradient(
      135deg,
      color-mix(in srgb, var(--color-gn-amber-400) 85%, transparent),
      color-mix(in srgb, var(--color-gn-amber-300) 75%, transparent)
    );
    border: 1px solid color-mix(in srgb, var(--gn-panel-border) 70%, transparent);
    border-radius: 999px;
    box-shadow:
      0 12px 24px rgba(7, 12, 24, 0.25),
      inset 0 1px 0 rgba(255, 255, 255, 0.45);
    transition:
      transform var(--transition-fast),
      box-shadow var(--transition-fast),
      background-color var(--transition-fast);
  }

  .search-panel__reset:hover,
  .search-panel__reset:focus {
    box-shadow:
      0 16px 28px rgba(7, 12, 24, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.5);
    transform: translateY(-1px);
  }

  .search-panel__reset:focus-visible {
    outline: 2px solid color-mix(in srgb, var(--color-gn-amber-300) 70%, transparent);
    outline-offset: 3px;
  }

  .search-panel__reset-icon {
    display: block;
    flex-shrink: 0;
    inline-size: 1.25rem;
    block-size: 1.25rem;
  }

  .search-panel__meta {
    display: grid;
    gap: 0.35rem;
  }

  .search-panel__status {
    font-size: 1rem;
    color: var(--gn-ink-muted);
    text-align: start;
  }

  @media (width >= 640px) {
    .search-panel__status {
      font-size: 1.05rem;
    }
  }

  .search-panel__no-results {
    font-size: 1rem;
    color: var(--gn-ink-muted);
    text-align: start;
  }

  @supports (backdrop-filter: blur(12px)) {
    .search-panel__input {
      backdrop-filter: blur(14px);
    }
  }
</style>
