---
/**
 * Headline Component
 *
 * A versatile and accessible heading component that supports different heading levels,
 * custom styling, and proper semantic hierarchy. Follows WCAG AAA accessibility standards
 * and performance best practices.
 *
 * @component
 */
interface Props {
  /** Text content of the heading (can also use slot content instead) */
  title?: string;
  /** HTML heading level (h1-h6) for proper document hierarchy */
  level?: "h1" | "h2" | "h3" | "h4" | "h5" | "h6";
  /** Additional CSS classes to apply */
  className?: string;
  /** Optional ID for direct linking and document structure */
  id?: string;
  /** Adds tabindex="-1" to make the heading programmatically focusable when needed
   * (useful for skip navigation or focus management)
   */
  focusable?: boolean;
  /** Optional ARIA label for improved screen reader context */
  ariaLabel?: string;
  /** ARIA describedby for additional context */
  ariaDescribedBy?: string;
  /** Semantic wrapper element for better document structure */
  wrapper?: "section" | "header" | "article" | "div" | "none";
  /** Text size using CSS custom properties (xs, sm, base, lg, xl, 2xl, 3xl, 4xl) - similar to Paragraph component */
  size?: "xs" | "sm" | "base" | "lg" | "xl" | "2xl" | "3xl" | "4xl";
  /** Style variant for visual appearance (default uses standard colors, primary uses gradient) */
  variant?: "default" | "primary";
  /** Text alignment option for different layout needs */
  textAlign?: "left" | "center" | "right";
  /** Indicates this heading is a skip navigation target */
  skipTarget?: boolean;
  /** Makes the heading clickable with proper button semantics */
  interactive?: boolean;
  /** Click handler for interactive headlines */
  onClick?: string;
}

const {
  title,
  level = "h1",
  className = "",
  id,
  focusable = false,
  ariaLabel,
  ariaDescribedBy,
  wrapper = "none",
  size = "xl",
  variant = "default",
  textAlign = "left",
  skipTarget = false,
  interactive = false,
  onClick,
} = Astro.props;

// Dynamic heading tag based on level prop
const Tag = level;
const WrapperTag = wrapper === "none" ? "div" : wrapper;

/**
 * Generate optimized CSS classes following BEM methodology
 * Ensures WCAG AAA compliance and proper semantic hierarchy
 */
const baseClasses = "headline";
const levelClass = `headline--${level}`;
const sizeClass = size ? `headline--size-${size}` : "";
const variantClass = variant !== "default" ? `headline--${variant}` : "";
const focusableClass = focusable ? "headline--focusable" : "";
const alignClass = textAlign !== "left" ? `headline--align-${textAlign}` : "";
const skipTargetClass = skipTarget ? "headline--skip-target" : "";
const interactiveClass = interactive ? "headline--interactive" : "";
const headlineClasses = [
  baseClasses,
  levelClass,
  sizeClass,
  variantClass,
  focusableClass,
  alignClass,
  skipTargetClass,
  interactiveClass,
  className,
]
  .filter(Boolean)
  .join(" ")
  .trim();

// Optimized attributes for better accessibility and performance
const headlineAttrs = {
  id,
  "aria-label": ariaLabel,
  "aria-describedby": ariaDescribedBy,
  class: headlineClasses,
  ...(focusable && {
    tabindex: "-1" as const,
    // Only add button role if explicitly marked as interactive
    ...(interactive && { role: "button" as const }),
  }),
  ...(interactive &&
    onClick && {
      onclick: onClick,
    }),
} as const;

// Wrapper attributes for semantic structure
const wrapperAttrs =
  wrapper !== "none"
    ? ({
        class: "headline-wrapper",
        role: wrapper === "div" ? ("region" as const) : undefined,
      } as const)
    : null;
---

<style lang="scss">
  /* ======================================
   * HEADLINE COMPONENT - BEM STYLE
   * WCAG AAA 2.2 COMPLIANT STYLES
   * Optimized for responsive design and global.css integration
   * ====================================== */

  /* ======================================
   * BASE HEADLINE STYLES
   * ====================================== */
  .headline {
    // Base typography using global.css variables
    font-family: var(--font-family-primary);
    font-weight: var(--font-bold);
    line-height: var(--leading-tight);
    letter-spacing: var(--letter-spacing-base);
    margin-bottom: var(--space-lg);
    color: var(--text-primary);

    // Enhanced text wrapping and accessibility
    text-wrap: balance;
    word-break: break-words;
    overflow-wrap: break-word;
    hyphens: auto;

    // Smooth transitions for interactive states
    transition: all var(--transition-normal);

    // Enhanced text spacing support (WCAG 2.2)
    letter-spacing: max(var(--letter-spacing-base), var(--letter-spacing-enhanced));
    line-height: max(var(--leading-tight), var(--line-height-enhanced));
    word-spacing: max(normal, var(--word-spacing-enhanced));

    // ======================================
    // SIZE VARIANTS - RESPONSIVE TYPOGRAPHY
    // ======================================

    // Mobile-first responsive sizing
    &--size-xs {
      font-size: var(--text-xs);
    }

    &--size-sm {
      font-size: var(--text-sm);
    }

    &--size-base {
      font-size: var(--text-base);
    }

    &--size-lg {
      font-size: var(--text-lg);
    }

    &--size-xl {
      font-size: var(--text-xl);
    }

    &--size-2xl {
      font-size: var(--text-2xl);
    }

    &--size-3xl {
      font-size: var(--text-3xl);
    }

    &--size-4xl {
      font-size: var(--text-4xl);
    }

    // ======================================
    // RESPONSIVE BREAKPOINT ADJUSTMENTS
    // ======================================

    // Tablet breakpoint (md)
    @media (min-width: var(--breakpoint-md)) {
      &--size-xl {
        font-size: var(--text-2xl);
      }

      &--size-2xl {
        font-size: var(--text-3xl);
      }

      &--size-3xl {
        font-size: var(--text-4xl);
      }

      &--size-4xl {
        font-size: calc(var(--text-4xl) * 1.25);
      }
    }

    // Desktop breakpoint (lg)
    @media (min-width: var(--breakpoint-lg)) {
      &--size-2xl {
        font-size: var(--text-4xl);
      }

      &--size-3xl {
        font-size: calc(var(--text-4xl) * 1.25);
      }

      &--size-4xl {
        font-size: calc(var(--text-4xl) * 1.5);
      }
    }

    // Large desktop breakpoint (xl)
    @media (min-width: var(--breakpoint-xl)) {
      &--size-3xl {
        font-size: calc(var(--text-4xl) * 1.5);
      }

      &--size-4xl {
        font-size: calc(var(--text-4xl) * 2);
      }
    }

    // ======================================
    // LEVEL-SPECIFIC TYPOGRAPHY
    // ======================================

    &--h1 {
      font-weight: var(--font-bold);
      margin-bottom: var(--space-xl);

      // Enhanced spacing for large screens
      @media (min-width: var(--breakpoint-lg)) {
        margin-bottom: var(--space-2xl);
      }
    }

    &--h2 {
      font-weight: var(--font-semibold);
      margin-bottom: var(--space-lg);

      @media (min-width: var(--breakpoint-lg)) {
        margin-bottom: var(--space-xl);
      }
    }

    &--h3 {
      font-weight: var(--font-semibold);
      margin-bottom: var(--space-md);

      @media (min-width: var(--breakpoint-lg)) {
        margin-bottom: var(--space-lg);
      }
    }

    &--h4,
    &--h5,
    &--h6 {
      font-weight: var(--font-medium);
      margin-bottom: var(--space-sm);

      @media (min-width: var(--breakpoint-lg)) {
        margin-bottom: var(--space-md);
      }
    }

    // ======================================
    // STYLE VARIANTS
    // ======================================

    // Primary variant with gradient
    &--primary {
      // WCAG AAA compliant fallback color (7:1 contrast ratio)
      color: var(--interactive-primary);

      // Enhanced gradient text with accessibility considerations
      background: linear-gradient(135deg, var(--color-primary-500), var(--color-secondary-500));
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 200% 200%;
      animation: gradient-shift var(--animation-duration-slow) ease-in-out infinite;
      will-change: background-position;

      // Fallback for browsers that don't support background-clip: text
      @supports not (background-clip: text) {
        background: none;
        -webkit-text-fill-color: initial;
        color: var(--interactive-primary);
      }

      // High contrast mode support
      @media (prefers-contrast: high) {
        background: none;
        -webkit-text-fill-color: initial;
        color: var(--text-primary);
        font-weight: var(--font-bold);
      }

      // Ensure proper contrast in forced colors mode
      @media (forced-colors: active) {
        background: none;
        -webkit-text-fill-color: initial;
        color: ButtonText;
        forced-color-adjust: none;
      }
    }

    // ======================================
    // INTERACTIVE STATES
    // ======================================

    // Focusable modifier for accessibility (WCAG 2.2 AAA)
    &--focusable {
      &:focus {
        outline: var(--focus-outline);
        outline-offset: var(--focus-ring-offset);
        box-shadow: var(--focus-ring);
        // Minimum touch target size (WCAG 2.2)
        min-height: var(--min-touch-size);
        min-width: var(--min-touch-size);
        // Enhanced focus appearance
        background-color: var(--focus-bg-overlay);
        border-radius: var(--radius-sm);
        transition: all var(--transition-fast);
      }
    }

    // Interactive modifier for clickable headlines
    &--interactive {
      cursor: pointer;
      transition: all var(--transition-normal);

      &:hover {
        text-decoration: underline;
        text-decoration-thickness: var(--text-decoration-thickness);
        text-underline-offset: var(--text-underline-offset);
        transform: translateY(var(--animation-y-offset-small));
      }

      &:active {
        transform: translateY(0);
      }

      &:focus {
        outline: var(--focus-outline);
        outline-offset: var(--focus-ring-offset);
        box-shadow: var(--focus-ring);
        background-color: var(--focus-bg-overlay);
        border-radius: var(--radius-sm);
      }
    }

    // ======================================
    // SKIP NAVIGATION TARGET
    // ======================================

    &--skip-target {
      scroll-margin-top: var(--space-xl);
      position: relative;

      &::before {
        content: "";
        position: absolute;
        top: calc(-1 * var(--space-lg));
        left: 0;
        right: 0;
        height: var(--border-width-thick);
        background-color: transparent;
        transition: background-color var(--transition-fast);
      }

      &:target {
        &::before {
          background-color: var(--interactive-primary);
          box-shadow: 0 0 var(--space-sm) var(--interactive-primary);
        }

        animation: skip-highlight var(--animation-duration-medium) ease-in-out;
      }
    }

    // ======================================
    // TEXT ALIGNMENT
    // ======================================

    &--align-center {
      text-align: center;
    }

    &--align-right {
      text-align: right;
    }
  }

  // ======================================
  // ANIMATIONS
  // ======================================

  // Gradient animation optimized for performance
  @keyframes gradient-shift {
    0%,
    100% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
  }

  // Skip navigation highlight animation
  @keyframes skip-highlight {
    0% {
      background-color: transparent;
    }
    10%,
    90% {
      background-color: var(--focus-bg-overlay);
    }
    100% {
      background-color: transparent;
    }
  }

  // ======================================
  // WRAPPER ELEMENT
  // ======================================

  .headline-wrapper {
    display: contents; // Maintains layout flow
  }

  // ======================================
  // ACCESSIBILITY ENHANCEMENTS
  // ======================================

  // Enhanced support for reduced motion (WCAG 2.2)
  @media (prefers-reduced-motion: reduce) {
    .headline {
      // Reset enhanced spacing to standard for reduced motion
      letter-spacing: var(--letter-spacing-base);
      line-height: var(--leading-tight);

      &--primary {
        // Reset gradient animation
        background: none;
        -webkit-text-fill-color: initial;
        color: var(--interactive-primary);
        will-change: auto;
        animation: none;
      }

      &--skip-target {
        animation: none;

        &:target {
          // Static highlight for reduced motion users
          background-color: var(--focus-bg-overlay);
          border-radius: var(--radius-sm);
          padding: var(--space-xs);
          margin: calc(-1 * var(--space-xs));
        }
      }

      &--interactive {
        &:hover {
          transform: none;
        }

        &:active {
          transform: none;
        }
      }
    }
  }

  // ======================================
  // PRINT STYLES
  // ======================================

  @media print {
    .headline {
      color: var(--print-text) !important;
      background: none !important;
      -webkit-text-fill-color: initial !important;

      &--primary {
        color: var(--print-text) !important;
        background: none !important;
        -webkit-text-fill-color: initial !important;
      }
    }
  }
</style>

{
  wrapper !== "none" ? (
    <WrapperTag {...wrapperAttrs}>
      <Tag {...headlineAttrs}>{title || <slot />}</Tag>
    </WrapperTag>
  ) : (
    <Tag {...headlineAttrs}>{title || <slot />}</Tag>
  )
}
