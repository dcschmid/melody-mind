---
/**
 * AuthSubmitButton - Submit button with loading state and accessibility
 *
 * Features:
 * - Loading spinner with smooth animations
 * - WCAG AAA compliance with focus management
 * - Full responsive design with touch optimization
 * - Keyboard navigation support
 */

import { Icon } from "astro-icon/components";

export interface Props {
  id: string;
  textId: string;
  spinnerId: string;
  buttonText: string;
  class?: string;
  type?: "submit" | "button";
  disabled?: boolean;
}

const {
  id,
  textId,
  spinnerId,
  buttonText,
  class: className = "",
  type = "submit",
  disabled = false,
} = Astro.props;
---

<button
  {type}
  {id}
  class={`auth-form__submit-button ${className}`}
  {disabled}
  aria-describedby={`${textId} ${spinnerId}`}
  aria-live="polite"
  aria-busy="false"
>
  <span id={textId} class="auth-form__submit-text">{buttonText}</span>
  <span id={spinnerId} class="auth-form__spinner" aria-hidden="true">
    <Icon name="refresh" class="auth-form__spinner-icon icon-loader" aria-hidden="true" />
  </span>
</button>

<style lang="scss">
  .auth-form {
    &__submit-button {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: none;
      user-select: none;
      width: var(--width-full);
      min-height: var(--touch-target-enhanced);
      gap: var(--space-sm);
      padding: var(--space-md) var(--space-lg);
      background: var(--interactive-primary);
      color: var(--btn-primary-text);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      font-size: var(--text-base);
      font-weight: var(--font-semibold);
      line-height: var(--leading-normal);
      letter-spacing: var(--letter-spacing-base);
      transition:
        background-color var(--transition-normal),
        box-shadow var(--transition-normal),
        transform var(--transition-normal);

      @media (min-width: 30em) {
        gap: var(--space-md);
        padding: var(--space-lg) var(--space-xl);
        font-size: var(--text-lg);
      }

      @media (min-width: 48em) {
        min-height: calc(var(--touch-target-enhanced) + var(--space-sm));
      }

      &:hover:not(:disabled) {
        background: var(--interactive-primary-hover);
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      &:focus-visible {
        outline: var(--focus-outline);
        outline-offset: var(--focus-ring-offset);
        box-shadow: var(--focus-ring), var(--shadow-lg);
      }

      &:active:not(:disabled) {
        transform: translateY(0);
        background: var(--interactive-primary-hover);
        box-shadow: var(--shadow-md);
      }

      &:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        pointer-events: none;
      }

      &--loading {
        pointer-events: none;

        .auth-form__submit-text {
          opacity: 0;
          transition: opacity var(--transition-normal);
        }

        .auth-form__spinner {
          display: flex;
        }
      }
    }

    &__submit-text {
      font-weight: inherit;
      color: inherit;
      user-select: none;
      transition: opacity var(--transition-normal);
      text-wrap: balance;
    }

    &__spinner {
      display: none;
      align-items: center;
      justify-content: center;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);

      &-icon {
        height: var(--text-base);
        width: var(--text-base);
        color: var(--btn-primary-text);
        animation: auth-spinner-rotate 1s linear infinite;

        @media (min-width: 30em) {
          height: var(--text-lg);
          width: var(--text-lg);
        }
      }
    }
  }

  @keyframes auth-spinner-rotate {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }

  @media (max-width: 23.4375em) {
    .auth-form__submit-button {
      min-height: var(--touch-target-enhanced);
    }
  }

  @media (prefers-contrast: high) {
    .auth-form__submit-button {
      border: var(--border-width-thick) solid var(--border-primary);
      background: var(--interactive-primary);

      &:focus-visible {
        outline-width: var(--border-width-thick);
        background: var(--interactive-primary-hover);
      }
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .auth-form__submit-button,
    .auth-form__spinner-icon,
    .auth-form__submit-text {
      transition: var(--transition-instant);
      animation: none;
    }

    .auth-form__submit-button:hover:not(:disabled) {
      transform: none;
    }

    .auth-form__spinner-icon {
      animation: auth-spinner-pulse 2s ease-in-out infinite;
    }
  }

  @keyframes auth-spinner-pulse {
    0%,
    100% {
      opacity: 0.7;
    }
    50% {
      opacity: 0.3;
    }
  }

  @media (hover: none) and (pointer: coarse) {
    .auth-form__submit-button {
      min-height: calc(var(--touch-target-enhanced) + var(--space-sm));
      padding: var(--space-lg) var(--space-xl);

      &:hover {
        transform: none;
        box-shadow: var(--shadow-md);
        background: var(--interactive-primary);
      }
    }
  }

  @supports (zoom: 4) {
    .auth-form__submit-button {
      font-size: max(var(--text-base), 16px);
      min-height: max(var(--touch-target-enhanced), 44px);
      padding: max(var(--space-md), 12px) max(var(--space-xl), 16px);
    }
  }

  @media print {
    .auth-form__submit-button {
      background: var(--color-white) !important;
      color: var(--color-black) !important;
      border: var(--border-width-thin) solid var(--color-black) !important;
      box-shadow: none !important;
    }

    .auth-form__spinner {
      display: none !important;
    }
  }
</style>

<script>
  import { initializeAuthButtonAccessibility } from "../../utils/auth/authSubmitButton";

  const initButton = (): void => {
    initializeAuthButtonAccessibility();
  };

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initButton, { once: true });
  } else {
    initButton();
  }
</script>
