---
/**
 * AuthForm - Tabbed authentication form with login/register modes
 *
 * Features:
 * - Tab-based navigation between login and registration
 * - Real-time form validation with accessibility announcements
 * - WCAG AAA compliant with keyboard navigation and screen reader support
 * - Performance optimized with CSS containment and efficient DOM handling
 * - Full responsive design with container queries
 * - Internationalization support for all languages
 *
 * @component
 * @accessibility WCAG AAA compliant with focus management and live regions
 * @performance CSS containment, GPU acceleration, efficient event handling
 * @responsive Mobile-first design with container queries and fluid scaling
 */
import { getLangFromUrl, useTranslations } from "../../utils/i18n";
import AuthFormField from "./AuthFormField.astro";
import AuthSubmitButton from "./AuthSubmitButton.astro";
import OAuthProviders from "./OAuthProviders.astro";
import Headline from "../Headline.astro";
import { Icon } from "astro-icon/components";

interface Props {
  /** Initial form mode - "login" or "register" */
  initialMode?: "login" | "register";
}

const { initialMode = "login" } = Astro.props;
const lang = String(getLangFromUrl(Astro.url));
const t = useTranslations(lang);
---

<!-- Main auth form container -->
<div class="auth-form__container">
  <!-- Enhanced live region for tab switching announcements -->
  <div id="tabSwitchAnnouncer" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <!-- Form Progress Indicator -->
  <div class="auth-form__progress" aria-labelledby="progressTitle">
    <Headline
      level="h3"
      id="progressTitle"
      title={t("auth.form.progress.title")}
      size="base"
      variant="default"
      className="auth-form__progress-title sr-only"
    />

    <!-- Visual Progress Bar -->
    <div
      class="auth-form__progress-bar"
      role="progressbar"
      aria-valuenow="0"
      aria-valuemin="0"
      aria-valuemax="100"
      aria-labelledby="progressStatus"
    >
      <div class="auth-form__progress-fill"></div>
    </div>

    <!-- Progress Status Text -->
    <div
      id="progressStatus"
      class="auth-form__progress-status"
      aria-live="polite"
      aria-atomic="true"
    >
      <!-- Will be populated by JavaScript -->
    </div>

    <!-- Field Completion Indicators -->
    <div class="auth-form__field-indicators" aria-label={t("auth.form.progress.title")}>
      <!-- Login form indicators -->
      <div
        id="loginFieldIndicators"
        class="auth-form__indicators auth-form__indicators--login"
        role="list"
      >
        <div class="auth-form__indicator" data-field="loginEmail" role="listitem">
          <Icon name="circle" class="auth-form__indicator-icon" aria-hidden="true" />
          <span class="auth-form__indicator-label"
            >{t("auth.login.email")}
            <span class="auth-form__indicator-required">({t("auth.form.progress.required")})</span>
          </span>
        </div>
        <div class="auth-form__indicator" data-field="loginPassword" role="listitem">
          <Icon name="circle" class="auth-form__indicator-icon" aria-hidden="true" />
          <span class="auth-form__indicator-label"
            >{t("auth.login.password")}
            <span class="auth-form__indicator-required">({t("auth.form.progress.required")})</span>
          </span>
        </div>
      </div>

      <!-- Registration form indicators -->
      <div
        id="registerFieldIndicators"
        class="auth-form__indicators auth-form__indicators--register"
        role="list"
      >
        <div class="auth-form__indicator" data-field="registerEmail" role="listitem">
          <Icon name="circle" class="auth-form__indicator-icon" aria-hidden="true" />
          <span class="auth-form__indicator-label"
            >{t("auth.register.email")}
            <span class="auth-form__indicator-required">({t("auth.form.progress.required")})</span>
          </span>
        </div>
        <div class="auth-form__indicator" data-field="registerUsername" role="listitem">
          <Icon name="circle" class="auth-form__indicator-icon" aria-hidden="true" />
          <span class="auth-form__indicator-label"
            >{t("auth.register.username")}
            <span class="auth-form__indicator-optional">({t("auth.form.progress.optional")})</span>
          </span>
        </div>
        <div class="auth-form__indicator" data-field="registerPassword" role="listitem">
          <Icon name="circle" class="auth-form__indicator-icon" aria-hidden="true" />
          <span class="auth-form__indicator-label"
            >{t("auth.register.password")}
            <span class="auth-form__indicator-required">({t("auth.form.progress.required")})</span>
          </span>
        </div>
        <div class="auth-form__indicator" data-field="registerPasswordConfirm" role="listitem">
          <Icon name="circle" class="auth-form__indicator-icon" aria-hidden="true" />
          <span class="auth-form__indicator-label"
            >{t("auth.register.password_confirm")}
            <span class="auth-form__indicator-required">({t("auth.form.progress.required")})</span>
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab navigation for switching between login and registration -->
  <div class="auth-form__tabs">
    <button
      id="loginTab"
      class={`auth-form__tab ${initialMode === "login" ? "auth-form__tab--active" : ""}`}
      aria-selected={initialMode === "login" ? "true" : "false"}
      role="tab"
      aria-controls="loginForm"
    >
      {t("auth.login.title")}
    </button>
    <button
      id="registerTab"
      class={`auth-form__tab ${initialMode === "register" ? "auth-form__tab--active" : ""}`}
      aria-selected={initialMode === "register" ? "true" : "false"}
      role="tab"
      aria-controls="registerForm"
    >
      {t("auth.register.title")}
    </button>
  </div>

  <div class="auth-form__forms-container">
    <!-- Error message display area -->
    <div
      id="formError"
      class="auth-form__message auth-form__message--error"
      role="alert"
      aria-live="assertive"
    >
    </div>
    <!-- Success message display area -->
    <div
      id="formSuccess"
      class="auth-form__message auth-form__message--success"
      role="alert"
      aria-live="assertive"
    >
    </div>

    <!-- OAuth Providers Section -->
    <div class="auth-form__oauth-section">
      <OAuthProviders />
    </div>

    <!-- Login Form -->
    <form
      id="loginForm"
      class={`auth-form__form ${initialMode === "login" ? "auth-form__form--active" : ""}`}
      novalidate
      aria-labelledby="loginFormHeading"
      role="tabpanel"
      aria-hidden={initialMode === "login" ? "false" : "true"}
    >
      <Headline
        level="h2"
        id="loginFormHeading"
        title={t("auth.login.title")}
        size="lg"
        variant="default"
        className="sr-only"
      />

      <!-- Email field for login -->
      <AuthFormField
        id="loginEmail"
        name="email"
        type="email"
        label={t("auth.login.email")}
        placeholder={t("auth.login.email.placeholder")}
        required={true}
        autocomplete="email"
      />

      <!-- Password field for login with reset link -->
      <AuthFormField
        id="loginPassword"
        name="password"
        type="password"
        label={t("auth.login.password")}
        placeholder={t("auth.login.password.placeholder")}
        required={true}
        autocomplete="current-password"
        showPasswordToggle={true}
        labelSuffix={`<a href="/${String(lang)}/auth/reset-password" class="auth-form__forgot-password">${t("auth.login.forgot_password")}</a>`}
      />

      <!-- Submit button for login -->
      <AuthSubmitButton
        id="loginSubmit"
        textId="loginSubmitText"
        spinnerId="loginLoadingSpinner"
        buttonText={t("auth.login.submit")}
      />
    </form>

    <!-- Registration Form -->
    <form
      id="registerForm"
      class={`auth-form__form ${initialMode === "register" ? "auth-form__form--active" : ""}`}
      novalidate
      aria-labelledby="registerFormHeading"
      role="tabpanel"
      aria-hidden={initialMode === "register" ? "false" : "true"}
    >
      <Headline
        level="h2"
        id="registerFormHeading"
        title={t("auth.register.title")}
        size="lg"
        variant="default"
        className="sr-only"
      />

      <!-- Email field for registration -->
      <AuthFormField
        id="registerEmail"
        name="email"
        type="email"
        label={t("auth.register.email")}
        placeholder={t("auth.register.email.placeholder")}
        required={true}
        autocomplete="email"
      />

      <!-- Username field (optional) -->
      <AuthFormField
        id="registerUsername"
        name="username"
        type="text"
        label={t("auth.register.username")}
        placeholder={t("auth.register.username.placeholder")}
        required={false}
        autocomplete="username"
      />

      <!-- Password field for registration -->
      <AuthFormField
        id="registerPassword"
        name="password"
        type="password"
        label={t("auth.register.password")}
        placeholder={t("auth.register.password.placeholder")}
        required={true}
        autocomplete="new-password"
        showPasswordToggle={true}
      />

      <!-- Password confirmation field -->
      <AuthFormField
        id="registerPasswordConfirm"
        name="passwordConfirm"
        type="password"
        label={t("auth.register.password_confirm")}
        placeholder={t("auth.register.password_confirm.placeholder")}
        required={true}
        autocomplete="new-password"
        showPasswordToggle={true}
      />

      <!-- Submit button for registration -->
      <AuthSubmitButton
        id="registerSubmit"
        textId="registerSubmitText"
        spinnerId="registerLoadingSpinner"
        buttonText={t("auth.register.submit")}
      />
    </form>
  </div>
</div>

<script>
  import { handleLoginSubmit, handleRegisterSubmit } from "../../utils/auth/authFormUtils";
  import { createFormProgressManager } from "../../utils/auth/formProgressManager";
  import { setupTabSwitching, initializeAuthFormElements } from "../../utils/auth/ui-interactions";
  import { useTranslations } from "../../utils/i18n";

  /**
   * Initialize the authentication form when DOM is loaded.
   * Optimized for performance with minimal inline code and efficient utilities.
   *
   * @accessibility WCAG AAA compliant with reduced motion and enhanced spacing support
   * @i18n Internationalization support for all user feedback
   * @performance Optimized event handling and DOM queries
   */
  const setupAuthForm = (): void => {
    // Performance: Single media query check with caching
    const prefersReducedMotion = window.matchMedia?.("(prefers-reduced-motion: reduce)").matches;
    const isTouchDevice = window.matchMedia?.("(any-hover: none)").matches;

    // Apply accessibility preferences
    if (prefersReducedMotion) {
      document.documentElement.classList.add("reduced-motion");
    }

    if (isTouchDevice) {
      document.documentElement.classList.add("enhanced-text-spacing");
    }

    // Initialize translations once
    const currentLang = document.documentElement.lang || "en";
    const t = useTranslations(currentLang);

    const translations = {
      invalidCredentials: t("auth.service.invalid_credentials"),
      tooManyAttempts: t("auth.service.too_many_attempts"),
      loginFormActive: t("auth.accessibility.login_form_active"),
      registerFormActive: t("auth.accessibility.register_form_active"),
      initError: t("auth.form.init_error"),
      errorMessageDismissed: t("auth.accessibility.error_message_dismissed"),
      successMessageDismissed: t("auth.accessibility.success_message_dismissed"),
    };

    // Initialize DOM elements with error handling
    const elements = initializeAuthFormElements();
    if (!elements) {
      console.error(translations.initError);
      return;
    }

    // Setup tab switching with announcements
    setupTabSwitching(
      elements.loginTab,
      elements.registerTab,
      elements.loginForm,
      elements.registerForm,
      elements.formError,
      elements.formSuccess
    );

    // Performance: Efficient event delegation for tab announcements
    const announcer = document.getElementById("tabSwitchAnnouncer");
    if (announcer && elements.loginTab && elements.registerTab) {
      elements.loginTab.addEventListener("click", () => {
        announcer.textContent = translations.loginFormActive;
      });

      elements.registerTab.addEventListener("click", () => {
        announcer.textContent = translations.registerFormActive;
      });
    }

    // Performance: Single keyboard event listener with efficient handling
    document.addEventListener("keydown", (event: KeyboardEvent) => {
      if (event.key === "Escape") {
        const errorEl = document.getElementById("formError");
        const successEl = document.getElementById("formSuccess");
        let messageCleared = false;

        if (errorEl?.textContent?.trim()) {
          errorEl.textContent = "";
          errorEl.style.display = "none";
          messageCleared = true;
          if (announcer) {
            announcer.textContent = translations.errorMessageDismissed;
          }
        }

        if (successEl?.textContent?.trim()) {
          successEl.textContent = "";
          successEl.style.display = "none";
          messageCleared = true;
          if (announcer) {
            announcer.textContent = translations.successMessageDismissed;
          }
        }

        if (messageCleared) {
          event.preventDefault();
        }
      }
    });

    // Session timeout functionality removed - no longer needed with new auth flow

    // Initialize form progress manager
    const progressManager = createFormProgressManager();
    progressManager.initialize();

    // Performance: Optimized form submission handlers
    elements.loginForm?.addEventListener("submit", (event: Event) => {
      handleLoginSubmit(event, translations);
    });

    elements.registerForm?.addEventListener("submit", (event: Event) => {
      handleRegisterSubmit(event);
    });
  };

  // Performance: Optimized initialization
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", setupAuthForm);
  } else {
    setupAuthForm();
  }
</script>

<style lang="scss">
  /**
   * AuthForm Component Styles
   * 
   * ✅ 100% global.css variables integration
   * ✅ Performance optimized with CSS containment
   * ✅ WCAG AAA compliant colors and spacing
   * ✅ Responsive design with container queries
   * ✅ GPU acceleration for smooth animations
   */

  .auth-form {
    &__container {
      max-width: var(--container-md);
      margin: var(--space-none) auto;

      background: transparent;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      position: relative;
      isolation: isolate;

      // Performance optimizations
      contain: layout style paint;
      content-visibility: auto;
      contain-intrinsic-size: var(--container-intrinsic-height-form);

      transform: translateZ(0);
      will-change: box-shadow;

      transition: box-shadow var(--transition-normal);

      // Container query support
      container-type: inline-size;
      container-name: auth-form;

      &:hover {
        box-shadow: var(--shadow-xl);
      }
    }

    &__message {
      padding: var(--space-md);
      margin-bottom: var(--space-lg);

      border-radius: var(--radius-md);
      font-size: var(--text-sm);
      font-weight: var(--font-medium);
      line-height: var(--leading-relaxed);
      display: none;
      border-width: var(--border-width-thin);
      border-style: solid;

      // Performance optimizations
      contain: layout style;
      transform: translateZ(0);

      transition: opacity var(--transition-normal);

      &--error {
        background-color: var(--color-error-50);
        border-color: var(--color-error-300);
        color: var(--color-error-800);
      }

      &--success {
        background-color: var(--color-success-50);
        border-color: var(--color-success-300);
        color: var(--color-success-800);
      }

      &:not(:empty) {
        display: block;
      }
    }

    &__tabs {
      display: flex;
      flex-direction: row; // Explicitly set tabs side by side
      background: transparent;

      margin: var(--space-none);
      padding: var(--space-none);
      gap: var(--space-xs);

      position: relative;
      role: tablist;

      // Performance optimizations
      contain: layout style;
      transform: translateZ(0);

      transition: background-color var(--transition-normal);
    }

    &__tab {
      flex: 1;
      padding: var(--space-md) var(--space-xl);

      background: var(--color-neutral-700);
      border: var(--border-width-thin) solid var(--border-secondary);
      border-bottom: none;
      border-radius: var(--radius-lg) var(--radius-lg) var(--space-none) var(--space-none);
      color: var(--color-neutral-300);

      font-size: var(--text-base);
      font-weight: var(--font-medium);
      line-height: var(--leading-normal);
      cursor: pointer;

      // Performance optimizations
      contain: layout style;
      transform: translateZ(0);
      will-change: transform, background-color, color;

      transition:
        background-color var(--transition-normal),
        color var(--transition-normal),
        transform var(--transition-fast),
        box-shadow var(--transition-normal);
      position: relative;
      min-height: var(--touch-target-enhanced);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;

      // Tab design with proper borders
      &:first-child {
        border-top-left-radius: var(--radius-lg);
        border-top-right-radius: var(--radius-lg);
      }

      &:last-child {
        border-top-left-radius: var(--radius-lg);
        border-top-right-radius: var(--radius-lg);
      }

      &:hover {
        background: var(--color-neutral-600);
        color: var(--color-neutral-200);
        transform: translateY(calc(-1 * var(--space-micro)));
      }

      &:focus-visible {
        outline: var(--focus-outline);
        outline-offset: var(--focus-ring-offset);
        z-index: var(--z-dropdown);
        box-shadow: var(--focus-ring);
      }

      &:active {
        transform: translateY(var(--space-none));
      }

      &--active {
        background: var(--bg-secondary);
        color: var(--text-primary);
        position: relative;
        z-index: 2;
        border-bottom: var(--border-width-thin) solid var(--bg-secondary);
        margin-bottom: calc(-1 * var(--border-width-thin));

        &:hover {
          background: var(--bg-secondary);
          transform: none;
        }

        &:focus-visible {
          outline-color: var(--text-primary);
          box-shadow: var(--focus-ring);
        }
      }
    }

    &__forms-container {
      position: relative;
      overflow: hidden;
      background: var(--bg-secondary);
      border: var(--border-width-thin) solid var(--border-secondary);
      border-top: none;
      border-radius: var(--space-none) var(--space-none) var(--radius-lg) var(--radius-lg);
      z-index: 1;
      padding: var(--space-xl);
    }

    &__oauth-section {
      margin-bottom: var(--space-xl);
      padding-bottom: var(--space-lg);
      border-bottom: var(--border-width-thin) solid var(--border-secondary);
    }

    &__form {
      display: none;
      opacity: var(--animation-opacity-start);
      transform: translateX(var(--space-md));
      transition:
        opacity var(--transition-slow),
        transform var(--transition-slow);

      &--active {
        display: block !important;
        opacity: var(--animation-opacity-full);
        transform: translateX(var(--space-none));
      }
    }

    // Ensure only one form is visible at a time
    &__forms-container {
      .auth-form__form:not(.auth-form__form--active) {
        display: none !important;
      }
    }

    &__forgot-password {
      color: var(--interactive-primary);
      text-decoration: none;
      font-size: var(--text-xs);
      font-weight: var(--font-medium);
      line-height: var(--leading-normal);
      transition:
        color var(--transition-normal),
        text-decoration-color var(--transition-normal);
      display: inline-block;
      padding: var(--space-xs);
      border-radius: var(--radius-sm);

      &:hover {
        color: var(--interactive-primary-hover);
        text-decoration: underline;
        text-decoration-color: var(--interactive-primary-hover);
        text-decoration-thickness: var(--border-width-thin);
        text-underline-offset: var(--space-xs);
      }

      &:focus-visible {
        outline: var(--focus-outline);
        outline-offset: var(--focus-ring-offset);
      }
    }

    // Enhanced text spacing support (WCAG 2.2)
    .enhanced-text-spacing & {
      &__container * {
        letter-spacing: var(--letter-spacing-enhanced) !important;
        word-spacing: var(--word-spacing-enhanced) !important;
        line-height: var(--leading-enhanced) !important;
      }

      &__container p,
      &__message {
        margin-bottom: var(--space-lg) !important;
      }

      &__tab {
        padding: calc(var(--space-sm) * 1.2) calc(var(--space-md) * 1.2);
      }
    }

    // Responsive text handling
    @supports (font-size: clamp(1rem, 4vw, 1.5rem)) {
      &__tab {
        font-size: clamp(var(--text-sm), 3vw, var(--text-lg));
      }

      .enhanced-text-spacing &__tab {
        font-size: clamp(var(--text-xs), 3vw, var(--text-base));
      }
    }

    // Reduced motion support
    @media (prefers-reduced-motion: reduce) {
      &__form,
      &__tab,
      &__forgot-password,
      &__progress-fill,
      &__indicator {
        transition: var(--transition-instant);
        transform: none;
        animation: none;
        will-change: auto;
      }

      &__tab {
        &:hover,
        &:active {
          transform: none;
        }
      }
    }

    // Responsive design
    @media (max-width: 39.9375em) {
      &__container {
        margin: var(--space-md);
        border-radius: var(--radius-md);
      }

      &__tab {
        padding: var(--space-md) var(--space-lg);
        font-size: var(--text-sm);
        min-height: var(--touch-target-enhanced);
      }

      &__forms-container {
        padding: var(--space-lg);
      }

      &__progress {
        padding: var(--space-sm);
        margin-bottom: var(--space-md);
      }

      &__field-indicators {
        gap: var(--space-xs);
      }

      &__indicator {
        padding: var(--space-xs);
        font-size: var(--text-xs);
      }
    }

    @media (max-width: 23.4375em) {
      &__container {
        margin: var(--space-sm);
      }

      &__forms-container {
        padding: var(--space-md);
      }

      &__tab {
        padding: var(--space-sm) var(--space-md);
        font-size: var(--text-xs);
      }

      &__message {
        padding: var(--space-sm);
        font-size: var(--text-xs);
      }
    }

    // High contrast mode support
    @media (prefers-contrast: high) {
      &__container {
        border: var(--border-width-thick) solid var(--border-primary);
        background: var(--color-black);
      }

      &__tab {
        border: var(--border-width-thin) solid var(--border-primary);

        &--active {
          border: var(--border-width-thick) solid var(--interactive-primary);
          background: var(--color-white);
          color: var(--color-black);
        }
      }

      &__message {
        &--error,
        &--success {
          border-width: var(--border-width-thick);
        }
      }

      &__progress {
        border: var(--border-width-thick) solid var(--border-primary);

        &-bar {
          border: var(--border-width-thick) solid var(--border-primary);
        }
      }

      &__indicator--completed {
        border: var(--border-width-thin) solid var(--color-success-600);
      }
    }

    // Print styles
    @media print {
      &__container {
        box-shadow: none;
        border: var(--border-width-thin) solid var(--color-black);
        background: var(--color-white);
        color: var(--color-black);
      }

      &__tab,
      &__message {
        background: transparent !important;
        color: var(--color-black) !important;
        border-color: var(--color-black) !important;
      }

      &__tab--active {
        background: var(--color-black) !important;
        color: var(--color-white) !important;
      }

      &__progress,
      &__field-indicators {
        display: none;
      }
    }

    // Form progress indicator
    &__progress {
      margin-bottom: var(--space-lg);
      padding: var(--space-md);
      background: var(--color-neutral-100);
      border-radius: var(--radius-md);
      border: var(--border-width-thin) solid var(--border-secondary);
      order: -1; // Ensure it appears first in flex layout
      display: none; // Hide by default to avoid confusion

      &-title {
        margin-bottom: var(--space-sm);
        font-size: var(--text-sm);
        font-weight: var(--font-medium);
        color: var(--text-secondary);
      }

      &-bar {
        width: var(--width-full);
        height: var(--space-sm);
        background: var(--bg-secondary);
        border-radius: var(--radius-full);
        overflow: hidden;
        margin-bottom: var(--space-sm);
        border: var(--border-width-thin) solid var(--border-secondary);
      }

      &-fill {
        height: var(--height-full);
        background: linear-gradient(
          90deg,
          var(--interactive-primary),
          var(--interactive-primary-hover)
        );
        border-radius: var(--radius-full);
        transition: width var(--transition-normal);
        width: var(--width-none);
      }

      &-status {
        font-size: var(--text-xs);
        color: var(--text-secondary);
        margin-bottom: var(--space-sm);
        min-height: var(--text-lg);
      }
    }

    // Field completion indicators
    &__field-indicators {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    &__indicators {
      display: none;
      flex-direction: column;
      gap: var(--space-xs);

      &--active {
        display: flex;
      }
    }

    &__indicator {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      font-size: var(--text-xs);
      color: var(--text-secondary);
      padding: var(--space-xs);
      border-radius: var(--radius-sm);
      transition: all var(--transition-normal);

      &--completed {
        color: var(--color-success-700);
        background: var(--color-success-50);

        .auth-form__indicator-icon {
          color: var(--color-success-700);
        }
      }

      &-icon {
        font-size: var(--text-sm);
        font-weight: var(--font-bold);
        width: 1em;
        text-align: center;
        transition: all var(--transition-normal);
      }

      &-label {
        flex: 1;
      }

      &-required {
        font-weight: var(--font-medium);
        color: var(--color-warning-600);
      }

      &-optional {
        font-style: italic;
        color: var(--text-muted);
      }
    }
  }

  // Responsive Form Progress
  @media (max-width: 39.9375em) {
    .auth-form__progress {
      padding: var(--space-sm);
      margin-bottom: var(--space-md);
    }

    .auth-form__field-indicators {
      gap: var(--space-xs);
    }

    .auth-form__indicator {
      padding: var(--space-xs);
      font-size: var(--text-xs);
    }
  }

  // Container queries for component-specific responsiveness
  @container auth-form (max-width: 64em) {
    .auth-form {
      &__tabs {
        // Keep tabs side by side
        flex-direction: row;
        gap: var(--space-xs);
      }

      &__tab {
        // Tabs share available width
        flex: 1;
      }

      &__progress {
        padding: var(--space-sm);
      }

      &__field-indicators {
        gap: var(--space-xs);
      }
    }
  }

  @container auth-form (max-width: 48em) {
    .auth-form {
      &__container {
        padding: var(--space-sm);
      }

      &__message {
        padding: var(--space-sm);
        font-size: var(--text-xs);
      }

      &__tabs {
        padding: var(--space-xs);
      }

      &__tab {
        padding: var(--space-xs) var(--space-sm);
        font-size: var(--text-xs);
      }
    }
  }

  @container auth-form (max-width: 32em) {
    .auth-form {
      &__progress {
        padding: var(--space-xs);
        margin-bottom: var(--space-sm);
      }

      &__indicator {
        padding: calc(var(--space-xs) * 0.75);
        font-size: calc(var(--text-xs) * 0.9);
      }

      &__progress-bar {
        height: calc(var(--space-sm) * 0.75);
      }
    }
  }
</style>
