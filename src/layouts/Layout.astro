---
/**
 * @component Layout
 * @description The main layout component used throughout the MelodyMind application
 * This layout implements WCAG 2.2 AAA accessibility standards
 * including reduced motion support, proper document structure, optimized resource loading,
 * and mobile-friendly viewport configurations.
 *
 * @param {Date} [publishDate] - Content publish date for SEO and structured data
 * @param {Date} [modifiedDate] - Content modification date for SEO optimization
 * @param {boolean} [showHeader=true] - Whether to display the header navigation component
 * @param {boolean} [showHeaderIcons=true] - Whether to show icons in the header navigation
 * @param {boolean} [showCoins=false] - Whether to display the coin counter overlay
 * @param {Object} [ogMusic] - Music-specific OpenGraph meta tags for enhanced social sharing
 * @param {string} [ogMusic.creator] - Music creator/artist name
 * @param {string} [ogMusic.album] - Album name for music content
 * @param {string} [ogMusic.musician] - Musician name for music content
 *
 * @example Basic usage
 * ```astro
 * <Layout title="Home Page" description="Welcome to MelodyMind">
 *   <h1>Welcome to our music quiz game!</h1>
 * </Layout>
 * ```
 *
 * @example Game page with coins
 * ```astro
 * <Layout
 *   title="Music Quiz - Rock Category"
 *   description="Test your rock music knowledge"
 *   type="game"
 *   showCoins={true}
 *   showHeader={false}
 * >
 *   <GameInterface />
 * </Layout>
 * ```
 *
 * @example Music content page
 * ```astro
 * <Layout
 *   title="Album Review"
 *   type="music"
 *   ogMusic={{ creator: "The Beatles", album: "Abbey Road" }}
 *   publishDate={new Date("2024-01-15")}
 * >
 *   <ArticleContent />
 * </Layout>
 * ```
 */
import { Head } from "astro-capo";

// Primary accessible font: Atkinson Hyperlegible loaded via @fontsource imports in CSS.

import SEO from "@components/SEO.astro";
import SkipLink from "@components/Shared/SkipLink.astro";
import SiteHeader from "@components/Shared/SiteHeader.astro";
import CookieConsent from "@components/Shared/CookieConsent.astro";
import Footer from "@components/Footer.astro";
import Toast from "@components/Toast.astro";
import "../styles/global.css";

// 4. Utility imports
import { getLangFromUrl } from "@utils/i18n";
import type { StructuredData } from "@utils/seo/buildPageSeo";

interface Props {
  /**
   * The page title displayed in browser tab and meta tags
   * @type {string}
   * @required
   * @example "MelodyMind - Music Quiz Game"
   */

  /**
   * Page meta description for SEO and social sharing optimization
   * @type {string}
   * @optional
   * @maxLength 160 characters for optimal SEO performance
   * @example "Test your music knowledge with our engaging trivia game featuring multiple genres and difficulty levels."
   */

  /**
   * Page meta keywords for SEO optimization (legacy support)
   * @type {string}
   * @optional
   * @example "music quiz, trivia game, rock music, pop music"
   */

  /**
   * Social sharing image URL for Open Graph and Twitter Cards
   * @type {string}
   * @optional
   * @format Absolute or relative URL path
   * @requirements 1200x630px recommended for optimal social sharing
   * @example "/melody-mind.png" (global fallback logo) OR a specific content image like a podcast cover
   */
  /**
   * OG Image Strategy (2025-10 update):
   * We no longer use pre-generated /og-images/ variants. Pages should pass:
   * 1. A specific domain image (podcast episode image, category cover, etc.) when available
   * 2. Otherwise omit and the layout will fallback to the global logo (/melody-mind.png)
   * This keeps social previews consistent while avoiding stale generated assets.
   */
  /** Explicit OpenGraph image width */
  imageWidth?: number;
  /** Explicit OpenGraph image height */
  imageHeight?: number;

  /**
   * Page content type for structured data and Open Graph metadata
   * @type {"website" | "article" | "music" | "game" | "podcastEpisode"}
   * @optional
   * @default "website"
   * @example "game" for quiz pages, "music" for artist content
   */
  /**
   * Consolidated pageSeo object (required). Legacy individual SEO props removed.
   */
  pageSeo: {
    title: string;
    description: string;
    keywords: string;
    canonical: string;
    image?: string;
    type: "website" | "article" | "music" | "game" | "podcastEpisode";
    robots: string;
    openGraph: {
      title: string;
      description: string;
      type: string;
      url: string;
      image?: string;
      locale?: string;
    };
    twitter: {
      card: string;
      title: string;
      description: string;
      image?: string;
      creator?: string;
    };
    structuredData: StructuredData[];
    publishDate?: Date;
    modifiedDate?: Date;
    ogLocale?: string;
    alternateLocales?: string[];
  };

  /**
   * Content publish date for SEO and structured data markup
   * @type {Date}
   * @optional
   * @format JavaScript Date object
   * @example new Date("2024-01-15T10:00:00Z")
   */
  publishDate?: Date;

  /**
   * Content modification date for SEO optimization and freshness signals
   * @type {Date}
   * @optional
   * @format JavaScript Date object
   * @example new Date("2024-01-20T15:30:00Z")
   */
  modifiedDate?: Date;

  /**
   * Whether to display the header navigation component
   * @type {boolean}
   * @optional
   * @default true
   * @accessibility Header provides main navigation landmark for screen readers
   * @example false for full-screen game interfaces
   */
  showHeader?: boolean;

  /**
   * Whether to show icons in the header navigation
   * @type {boolean}
   * @optional
   * @default true
   * @accessibility Icons enhance visual navigation when paired with text
   * @performance Icons are optimized SVG sprites for fast loading
   */
  showHeaderIcons?: boolean;

  /**
   * Whether to display the coin counter overlay component
   * @type {boolean}
   * @optional
   * @default false
   * @useCase Used in game contexts where coin tracking is needed
   * @accessibility Positioned as overlay with proper touch targets (44x44px minimum)
   * @example true for active quiz gameplay pages
   */
  showCoins?: boolean;

  /**
   * Music-specific OpenGraph meta tags for enhanced social sharing
   * @type {Object}
   * @optional
   * @useCase Used when type is "music" to provide rich metadata for social platforms
   * @properties creator, album, musician strings for detailed music metadata
   */
  ogMusic?: {
    /**
     * Music creator/artist name for OpenGraph music metadata
     * @type {string}
     * @example "The Beatles"
     */
    creator?: string;
    /**
     * Album name for music content OpenGraph metadata
     * @type {string}
     * @example "Abbey Road"
     */
    album?: string;
    /**
     * Musician name for music content OpenGraph metadata
     * @type {string}
     * @example "Paul McCartney"
     */
    musician?: string;
  };
  /**
   * Podcast episode audio source URL (MP3) for podcastEpisode pages
   * @type {string}
   * @example "https://cdn.example.com/podcast/episode-1.mp3"
   */
  audioSrc?: string;
  /**
   * Sequential episode number (1-based) for podcastEpisode structured data
   * @type {number}
   * @example 12
   */
  episodeNumber?: number;
  /**
   * Podcast series name
   * @type {string}
   * @example "MelodyMind Podcast"
   */
  seriesName?: string;
  /**
   * Canonical URL of the podcast series listing page
   * @type {string}
   * @example "https://example.com/en/podcasts"
   */
  seriesUrl?: string;
  /** Canonical URL override */
  canonical?: string;
  /** Robots noindex flag */
  noIndex?: boolean;
  /** Robots nofollow flag */
  noFollow?: boolean;
  /** Pagination previous URL */
  prevUrl?: string;
  /** Pagination next URL */
  nextUrl?: string;
  /** Disable automatic alternate language links */
  disableAlternateLanguages?: boolean;
  /** Additional structured data object(s) */
  structuredDataExtra?: any | any[]; // passed through to SEO component
  /** Override author organization name */
  authorName?: string;
}

const {
  pageSeo,
  imageWidth,
  imageHeight,
  ogMusic,
  audioSrc,
  episodeNumber,
  seriesName,
  seriesUrl,
  showHeader = true,
  showHeaderIcons = true,
  prevUrl,
  nextUrl,
  disableAlternateLanguages,
  authorName,
} = Astro.props;

// ---------------------------------------------------------------------------
// Open Graph / Social Image Fallback
// If no explicit image prop is provided, we fallback to the brand logo to ensure
// consistent OG/Twitter rendering and avoid missing image penalties.
// We DO NOT attempt to infer category/podcast images here; pages needing a
// specific rich image should pass it explicitly. Centralizing this fallback
// keeps SEO component simpler and prevents duplication of default logic.
// ---------------------------------------------------------------------------
// pageSeo is now mandatory; remove legacy fallback construction
const constructedPageSeo = pageSeo;

const mergedTitle = constructedPageSeo.title;
const mergedDescription = constructedPageSeo.description;
const mergedKeywords = constructedPageSeo.keywords;
const mergedType = constructedPageSeo.type;
const mergedCanonical = constructedPageSeo.canonical;
const mergedImage = constructedPageSeo.image || "/melody-mind.png";
const mergedPublishDate = constructedPageSeo.publishDate;
const mergedModifiedDate = constructedPageSeo.modifiedDate;
const mergedStructuredData: StructuredData[] = constructedPageSeo.structuredData;
const robotsTag = constructedPageSeo.robots;

const lang = getLangFromUrl(Astro.url);
// Derive BCP47 language and map to common OG locale fallback (en -> en_US etc.)
function mapOgLocale(l: string): string {
  if (!l) {
    return "en_US";
  }
  const base = l.toLowerCase();
  switch (base) {
    case "en":
      return "en_US";
    case "de":
      return "de_DE";
    case "fr":
      return "fr_FR";
    case "es":
      return "es_ES";
    default:
      return base.replace(/-.+$/, "").concat("_", base.toUpperCase().slice(-2) || "US");
  }
}
const autoOgLocale = mapOgLocale(String(lang));

// Performance optimization: Critical resource preloading following Astro standards
// NOTE: preload must target the exact resource (script.js) instead of the domain root
// Avoid preloading the CDN script because the CDN currently returns HTML/CORS issues;
// we will load it dynamically with a safe fallback instead.
const preloadedResources: Array<{
  href: string;
  as: "style" | "script" | "font" | "image";
  crossorigin?: "anonymous" | "use-credentials";
}> = [];

// Font preloading optional; handled by @fontsource imports in CSS.
const fontPreloads: Array<{
  href: string;
  as: "style" | "script" | "font" | "image";
  type?: string;
  crossorigin?: "anonymous" | "use-credentials";
}> = [];

// DNS prefetching for external domains to reduce connection time and improve performance
const dnsPrefetch = [{ href: "https://cdn.usefathom.com" }];
---

<!doctype html>
<html lang={String(lang)} class="app" dir="ltr">
  <Head>
    <!-- Character set and viewport configuration for mobile optimization -->
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <!-- Title and description are handled by SEO component to avoid duplication -->

    <script is:inline>
      (() => {
        const THEME_STORAGE_KEY = "themePreference";
        const DARK_QUERY = "(prefers-color-scheme: dark)";

        const isTheme = (value) => value === "light" || value === "dark";
        const readStoredTheme = () => {
          try {
            const stored = window.localStorage.getItem(THEME_STORAGE_KEY);
            return isTheme(stored) ? stored : null;
          } catch {
            return null;
          }
        };
        const getSystemTheme = () =>
          window.matchMedia(DARK_QUERY).matches ? "dark" : "light";

        const applyTheme = (theme, source) => {
          document.documentElement.setAttribute("data-theme", theme);
          window.dispatchEvent(
            new CustomEvent("theme:change", {
              detail: { theme, source },
            })
          );
        };

        const storedTheme = readStoredTheme();
        const resolvedTheme = storedTheme ?? getSystemTheme();
        applyTheme(resolvedTheme, storedTheme ? "manual" : "system");

        window.matchMedia(DARK_QUERY).addEventListener("change", () => {
          if (readStoredTheme()) {
            return;
          }

          applyTheme(getSystemTheme(), "system");
        });
      })();
    </script>

    <!-- Color scheme and theme color for browser UI using CSS variables -->
    <meta name="color-scheme" content="dark light" />
    <meta
      name="theme-color"
      content="var(--color-neutral-950)"
      media="(prefers-color-scheme: dark)"
    />
    <meta
      name="theme-color"
      content="var(--color-white)"
      media="(prefers-color-scheme: light)"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="MelodyMind" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Resource hints for performance -->
    {dnsPrefetch.map((resource) => <link rel="dns-prefetch" href={resource.href} />)}

    {
      preloadedResources.map((resource) => (
        <link
          rel="preload"
          href={resource.href}
          as={resource.as}
          crossorigin={resource.crossorigin}
        />
      ))
    }

    <!-- Font preloading for critical fonts -->
    {
      fontPreloads.map((font) => (
        <link
          rel="preload"
          href={font.href}
          as={font.as}
          type={font.type}
          crossorigin={font.crossorigin}
        />
      ))
    }

    <!-- Fonts are loaded via local @font-face in Layout styles -->

    <!-- Structured data and SEO -->
    <link rel="sitemap" href="/sitemap-index.xml" />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="MelodyMind Knowledge RSS Feed"
      href="/rss.xml"
    />
    <meta
      name="google-site-verification"
      content="ImN0-TS4_aAOFIXaGxvsGSmqsgHxI94WARi8bW7fm9M"
    />
    <SEO
      title={mergedTitle}
      description={mergedDescription}
      keywords={mergedKeywords.split(",").map((k) => k.trim())}
      image={mergedImage}
      {imageWidth}
      {imageHeight}
      type={mergedType}
      publishDate={mergedPublishDate}
      modifiedDate={mergedModifiedDate}
      {ogMusic}
      {audioSrc}
      {episodeNumber}
      {seriesName}
      {seriesUrl}
      canonical={mergedCanonical}
      noIndex={robotsTag.includes("noindex")}
      noFollow={robotsTag.includes("nofollow")}
      {prevUrl}
      {nextUrl}
      {disableAlternateLanguages}
      structuredDataExtra={mergedStructuredData}
      {authorName}
    />
    {/* Robots meta explicit for clarity if differing from default */}
    {robotsTag !== "index,follow" && <meta name="robots" content={robotsTag} />}
    {/* OpenGraph / Twitter Cards (generated when pageSeo supplied) */}
    <Fragment>
      <meta property="og:title" content={constructedPageSeo.openGraph.title} />
      <meta
        property="og:description"
        content={constructedPageSeo.openGraph.description}
      />
      <meta property="og:type" content={constructedPageSeo.openGraph.type} />
      <meta property="og:url" content={constructedPageSeo.openGraph.url} />
      <meta
        property="og:locale"
        content={(constructedPageSeo.openGraph as any).locale ||
          (constructedPageSeo as any).ogLocale ||
          autoOgLocale}
      />
      {
        Array.isArray((constructedPageSeo as any).alternateLocales) &&
          (constructedPageSeo as any).alternateLocales.map((loc: string) => (
            <meta property="og:locale:alternate" content={loc} />
          ))
      }
      {
        constructedPageSeo.openGraph.image && (
          <meta property="og:image" content={constructedPageSeo.openGraph.image} />
        )
      }
      <meta name="twitter:card" content={constructedPageSeo.twitter.card} />
      <meta name="twitter:title" content={constructedPageSeo.twitter.title} />
      <meta name="twitter:description" content={constructedPageSeo.twitter.description} />
      {
        constructedPageSeo.twitter.image && (
          <meta name="twitter:image" content={constructedPageSeo.twitter.image} />
        )
      }
      {
        (constructedPageSeo.twitter as any).creator && (
          <meta
            name="twitter:creator"
            content={(constructedPageSeo.twitter as any).creator}
          />
        )
      }
    </Fragment>
  </Head>
  <body class="app__body">
    {/* Skip link for keyboard navigation */}
    <SkipLink />

    {showHeader && <SiteHeader showIcons={showHeaderIcons} />}

    {/* Main content area */}
    <main id="main-content" tabindex="-1" role="main" class="app__main">
      <slot />
    </main>

    <CookieConsent />
    <Toast />

    <Footer />

    <script>
      import { initInteractiveComponents } from "@utils/components/autoInit";
      if (typeof window !== "undefined") {
        const ready = (): void => initInteractiveComponents();
        if (document.readyState === "complete") {
          ready();
        } else {
          window.addEventListener("DOMContentLoaded", ready, { once: true });
        }
      }
    </script>
  </body>
</html>
<style>
  @font-face {
    font-family: "Atkinson Hyperlegible";
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: url("/fonts/atkinson-hyperlegible-regular.woff2") format("woff2");
  }

  .app {
    --color-white: #f7f9fc;
    --color-black: #07090d;
    --color-slate-50: #f4f7fb;
    --color-slate-100: #e4eaf3;
    --color-slate-200: #c9d3e2;
    --color-slate-300: #a9b6cb;
    --color-slate-400: #8797b1;
    --color-slate-500: #697a97;
    --color-slate-600: #4f5f78;
    --color-slate-700: #3b485f;
    --color-slate-800: #2a3346;
    --color-slate-900: #1b2333;
    --color-slate-950: #0d121b;
    --color-primary-50: #e8f7ff;
    --color-primary-100: #c7ebff;
    --color-primary-200: #a5dfff;
    --color-primary-300: #7bd6ff;
    --color-primary-400: #5fc7ff;
    --color-primary-500: #4bb6f0;
    --color-primary-600: #369ad1;
    --color-primary-700: #2b7bab;
    --color-primary-800: #215d83;
    --color-primary-900: #1a4765;
    --color-emerald-400: #34d399;
    --color-emerald-500: #10b981;
    --color-sky-400: #38bdf8;
    --color-sky-500: #0ea5e9;
    --color-success-400: #4ade80;
    --color-success-500: #22c55e;
    --color-warning-400: #fbbf24;
    --color-warning-500: #f59e0b;
    --color-error-400: #f87171;
    --color-error-500: #ef4444;
    --color-info-400: #60a5fa;
    --color-info-500: #3b82f6;
    --color-gn-soot-950: #06090f;
    --color-gn-soot-900: #0b1017;
    --color-gn-soot-800: #121824;
    --color-gn-soot-700: #1a2230;
    --color-gn-soot-600: #222c3d;
    --color-gn-parchment-50: #f2f6fb;
    --color-gn-parchment-100: #dde4ef;
    --color-gn-parchment-200: #bcc8d9;
    --color-gn-parchment-300: #9aa9bf;
    --color-gn-parchment-400: #7f91ab;
    --color-gn-amber-100: #d6f4ff;
    --color-gn-amber-200: #a8e9ff;
    --color-gn-amber-300: var(--theme-color-gn-amber-300, #7bd6ff);
    --color-gn-amber-400: var(--theme-color-gn-amber-400, #5fc7ff);
    --color-gn-amber-500: #4bb6f0;
    --color-gn-amber-600: #369ad1;
    --color-gn-rust-400: #8fe7ff;
    --color-gn-rust-500: #6ed8ff;
    --color-gn-teal-300: #7fd2e8;
    --color-gn-teal-400: #5dbfdc;
    --color-gn-teal-500: #3ea5c2;
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-2xl: 3rem;
    --spacing-3xl: 4rem;
    --spacing-4xl: 5rem;
    --font-sans:
      "Atkinson Hyperlegible", ui-sans-serif, system-ui, -apple-system, sans-serif;
    --font-mono: ui-monospace, "SF Mono", Monaco, "Cascadia Code", monospace;
    --font-display:
      "Atkinson Hyperlegible", ui-sans-serif, system-ui, -apple-system, sans-serif;
    --font-size-xs: 1.125rem;
    --font-size-sm: 1.125rem;
    --font-size-base: 1.125rem;
    --font-size-lg: 1.25rem;
    --font-size-xl: 1.375rem;
    --font-size-2xl: 1.625rem;
    --font-size-3xl: 2rem;
    --font-size-4xl: 2.375rem;
    --font-size-5xl: 3.125rem;
    --font-size-6xl: 3.875rem;
    --font-size-7xl: 4.625rem;
    --line-height-tight: 1.25;
    --line-height-snug: 1.375;
    --line-height-normal: 1.5;
    --line-height-relaxed: 1.625;
    --line-height-loose: 1.75;
    --letter-spacing-tighter: -0.05em;
    --letter-spacing-tight: -0.025em;
    --letter-spacing-normal: 0em;
    --letter-spacing-wide: 0.025em;
    --letter-spacing-wider: 0.05em;
    --radius-none: 0;
    --radius-sm: 0.375rem;
    --radius-md: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-xl: 1rem;
    --radius-2xl: 1.5rem;
    --radius-3xl: 2rem;
    --radius-full: 9999px;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.15), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.2), 0 4px 6px -4px rgb(0 0 0 / 0.15);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.25), 0 8px 10px -6px rgb(0 0 0 / 0.2);
    --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.35);
    --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-base: 300ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
    --color-neutral-50: var(--color-slate-50);
    --color-neutral-100: var(--color-slate-100);
    --color-neutral-200: var(--color-slate-200);
    --color-neutral-300: var(--color-slate-300);
    --color-neutral-400: var(--color-slate-400);
    --color-neutral-500: var(--color-slate-500);
    --color-neutral-600: var(--color-slate-600);
    --color-neutral-700: var(--color-slate-700);
    --color-neutral-800: var(--color-slate-800);
    --color-neutral-900: var(--color-slate-900);
    --color-neutral-950: var(--color-slate-950);
    --space-xs: var(--spacing-xs);
    --space-sm: var(--spacing-sm);
    --space-md: var(--spacing-md);
    --space-lg: var(--spacing-lg);
    --space-xl: var(--spacing-xl);
    --space-2xl: var(--spacing-2xl);
    --space-3xl: var(--spacing-3xl);
    --focus-ring-width: 3px;
    --focus-ring-color: var(--color-gn-amber-300);
    --focus-ring-offset: 2px;
    --sr-only-width: 1px;
    --sr-only-height: 1px;
    --sr-only-margin: -1px;
    --sr-only-clip-path: inset(50%);
    --border-primary: var(--color-neutral-700);
    --border-secondary: var(--color-neutral-600);
    --border-focus: var(--color-primary-400);
    --border-error: var(--color-error-500);
    --border-success: var(--color-success-500);
    --border-help-info: var(--color-info-500);
    --interactive-primary: var(--color-primary-500);
    --interactive-primary-hover: var(--color-primary-600);
    --interactive-primary-active: var(--color-primary-700);
    --interactive-secondary: var(--color-gn-teal-400);
    --interactive-secondary-hover: var(--color-gn-teal-500);
    --interactive-secondary-active: var(--color-gn-teal-500);
    --focus-enhanced-shadow: 0 0 0 1px var(--color-primary-500), var(--shadow-lg);
    --focus-outline-dark: 3px solid var(--color-primary-300);
    --focus-outline-light: 3px solid var(--color-primary-600);
    --form-bg: var(--theme-form-bg, var(--color-neutral-900));
    --form-border: var(--border-primary);
    --form-border-focus: var(--border-focus);
    --form-text: var(--theme-form-text, var(--color-neutral-50));
    --form-placeholder: var(--theme-form-placeholder, var(--color-neutral-400));
    --form-label: var(--theme-form-label, var(--color-neutral-200));
    --form-error: var(--color-error-400);
    --form-success: var(--color-success-400);
    --btn-primary-bg: linear-gradient(
      135deg,
      var(--color-primary-400) 0%,
      var(--color-primary-600) 100%
    );
    --btn-primary-hover: linear-gradient(
      135deg,
      var(--color-primary-500) 0%,
      var(--color-primary-700) 100%
    );
    --btn-primary-text: var(--color-gn-soot-950);
    --btn-secondary-bg: transparent;
    --btn-secondary-border: var(--border-primary);
    --btn-secondary-text: var(--theme-btn-secondary-text, var(--color-neutral-50));
    --btn-secondary-hover: var(--theme-btn-secondary-hover, rgba(123, 214, 255, 0.08));
    --card-bg: var(--theme-card-bg, var(--color-gn-soot-800));
    --card-border: var(--border-primary);
    --card-shadow: 0 10px 26px rgba(0, 0, 0, 0.45);
    --card-shadow-hover: 0 16px 36px rgba(0, 0, 0, 0.55);
    --prose-body: var(--theme-prose-body, var(--color-gn-parchment-100));
    --prose-headings: var(--theme-prose-headings, var(--color-gn-parchment-50));
    --prose-links: var(--color-gn-amber-300);
    --prose-bold: var(--theme-prose-bold, var(--color-gn-parchment-50));
    --prose-counters: var(--theme-prose-counters, var(--color-gn-parchment-50));
    --prose-bullets: var(--theme-prose-bullets, var(--color-gn-parchment-50));
    --prose-hr: var(--theme-prose-hr, rgba(255, 255, 255, 0.2));
    --prose-quotes: var(--theme-prose-quotes, var(--color-gn-parchment-100));
    --prose-quote-borders: var(--color-gn-amber-400);
    --prose-captions: var(--theme-prose-captions, var(--color-gn-parchment-200));
    --prose-code: var(--color-gn-amber-300);
    --prose-pre-code: var(--theme-prose-pre-code, var(--color-gn-parchment-50));
    --prose-pre-bg: var(--theme-prose-pre-bg, rgba(255, 255, 255, 0.06));
    --prose-th-borders: var(--theme-prose-th-borders, rgba(255, 255, 255, 0.25));
    --prose-td-borders: var(--theme-prose-td-borders, rgba(255, 255, 255, 0.15));
    --scrollbar-track-bg: var(--theme-scrollbar-track-bg, var(--color-gn-soot-900));
    --scrollbar-thumb-bg: var(--theme-scrollbar-thumb-bg, var(--color-gn-soot-700));
    --scrollbar-thumb-hover: var(--theme-scrollbar-thumb-hover, var(--color-gn-soot-600));
    --gn-bg-primary: var(--theme-gn-bg-primary, var(--color-gn-soot-950));
    --gn-bg: var(--theme-gn-bg, var(--color-gn-soot-900));
    --gn-bg-muted: var(--theme-gn-bg-muted, var(--color-gn-soot-800));
    --gn-ink: var(--theme-gn-ink, var(--color-gn-parchment-50));
    --gn-ink-muted: var(--theme-gn-ink-muted, var(--color-gn-parchment-200));
    --gn-accent: var(--theme-gn-accent, var(--color-gn-amber-400));
    --gn-accent-strong: var(--theme-gn-accent-strong, var(--color-gn-amber-300));
    --gn-accent-teal: var(--color-gn-teal-400);
    --gn-panel-border: var(--theme-gn-panel-border, var(--color-gn-soot-600));
    --gn-panel-inner: var(
      --theme-gn-panel-inner,
      color-mix(in srgb, var(--color-gn-parchment-200) 8%, transparent)
    );
    --gn-offset-shadow: var(
      --theme-gn-offset-shadow,
      4px 4px 0 rgba(0, 0, 0, 0.7),
      0 20px 44px rgba(0, 0, 0, 0.55)
    );
    --gn-halftone: var(
      --theme-gn-halftone,
      radial-gradient(circle at 20% 20%, rgba(123, 214, 255, 0.05), transparent 24%),
      radial-gradient(circle at 80% 10%, rgba(95, 199, 255, 0.06), transparent 26%),
      radial-gradient(circle at 60% 70%, rgba(123, 214, 255, 0.04), transparent 25%)
    );
    --gn-noise: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='0.14'/%3E%3C/svg%3E");
    --surface-1: var(--theme-surface-1, var(--color-gn-soot-950));
    --surface-2: var(--theme-surface-2, var(--color-gn-soot-900));
    --surface-3: var(
      --theme-surface-3,
      color-mix(in srgb, var(--color-gn-soot-800) 88%, var(--color-gn-parchment-200) 6%)
    );
    --text-primary: var(--theme-text-primary, var(--color-gn-parchment-50));
    --text-secondary: var(--theme-text-secondary, var(--color-gn-parchment-200));
    --link-default: var(--theme-link-default, var(--color-gn-amber-300));
    --link-hover: var(--theme-link-hover, var(--color-gn-amber-200));
  }

  .app {
    box-sizing: border-box;
    width: 100%;
    min-height: 100%;
    font-family: var(--font-sans);
    background: var(--gn-bg-primary);
    color: var(--gn-ink);
    overflow-x: hidden;
    scroll-behavior: smooth;
    -webkit-font-smoothing: antialiased;
    text-rendering: optimizeLegibility;
  }

  .app *,
  .app *::before,
  .app *::after {
    box-sizing: inherit;
  }

  .app__body {
    margin: 0;
    min-height: 100vh;
    width: 100%;
    background: var(--gn-bg);
    color: var(--gn-ink);
    font-family: var(--font-sans);
    font-size: 1.25rem;
    line-height: var(--line-height-relaxed);
    text-wrap: pretty;
    overflow-x: hidden;
    scroll-padding-top: 5rem;
  }

  .app__body :is(button, input, select, textarea) {
    font-family: inherit;
  }

  .app__main {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .app__main [id] {
    scroll-margin-top: 5rem;
  }

  :where(
    a,
    button,
    input,
    select,
    textarea,
    summary,
    [role="button"],
    [tabindex]:not([tabindex="-1"])
  ):focus-visible {
    outline: 3px solid var(--color-gn-amber-300);
    outline-offset: 3px;
    box-shadow: 0 0 0 4px color-mix(in srgb, var(--color-gn-amber-300) 30%, transparent);
    border-radius: 10px;
    border-color: var(--color-gn-amber-300);
  }

  :where(button, [role="button"], input, select, textarea):focus-visible {
    background-color: color-mix(
      in srgb,
      var(--gn-bg-muted) 70%,
      var(--gn-bg-primary) 30%
    );
  }

  @media (prefers-reduced-motion: reduce) {
    .app * {
      animation-duration: 1ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 120ms !important;
      scroll-behavior: auto !important;
    }
  }
</style>
