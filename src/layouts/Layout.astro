---
import { Icon } from "astro-icon/components";
import { When } from "@astropub/flow";
import "@fontsource/source-sans-pro/400.css";
import "@fontsource/source-sans-pro/700.css";
import "@fontsource/source-sans-pro/900.css";

interface Props {
  title: string;
  description?: string;
  keywords?: string;
  image?: string;
  showHeader?: boolean;
  showHeaderIcons?: boolean;
}

const {
  title,
  description = "Melody Mind - Das musikalische Ratespiel",
  keywords = "Musik, Ratespiel, Quiz, Cover, Entertainment",
  image = "/social-share.jpg",
  showHeader = true,
  showHeaderIcons = true,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <title>{title} | Melody Mind</title>
    <meta name="title" content={`${title} | Melody Mind`} />
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content="Daniel Schmid" />
    <meta name="robots" content="index, follow" />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={`${title} | Melody Mind`} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.site)} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={`${title} | Melody Mind`} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.site)} />

    <!-- Favicons -->
    <link
      rel="icon"
      type="image/png"
      href="/favicon-96x96.png?v=2"
      sizes="96x96"
    />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg?v=2" />
    <link rel="shortcut icon" href="/favicon.ico?v=2" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/apple-touch-icon.png?v=2"
    />
    <meta name="apple-mobile-web-app-title" content="Melody Mind" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Generator -->
    <meta name="generator" content={Astro.generator} />

    <meta name="color-scheme" content="light dark" />
  </head>
  <body>
    <a href="#main-content" class="skip-link">Zum Hauptinhalt springen</a>

    <When test1={showHeader}>
      <header role="banner">
        <nav aria-label="Hauptnavigation">
          <div class="slot left">
            <a href="/gamehome" class="icon-button" aria-label="Zur Startseite">
              <Icon name="home" width={24} height={22.24} aria-hidden="true" />
              <span class="sr-only">Startseite</span>
            </a>
            <When test={showHeaderIcons}>
              <a
                href="/spielregeln"
                class="icon-button"
                aria-label="Spielregeln anzeigen"
              >
                <Icon
                  name="question"
                  width={24}
                  height={22.24}
                  aria-hidden="true"
                />
                <span class="sr-only">Spielregeln</span>
              </a>
              <a
                href="/highscores"
                class="icon-button"
                aria-label="Bestenliste anzeigen"
              >
                <Icon name="trophy" width={24} height={24} aria-hidden="true" />
                <span class="sr-only">Bestenliste</span>
              </a>
            </When>
            <slot name="left-headercol" />
          </div>
          <div class="slot right">
            <When test={showHeaderIcons}>
              <a href="/user" class="icon-button" aria-label="Benutzerprofil">
                <Icon name="user" width={24} height={24} aria-hidden="true" />
                <span class="sr-only">Profil</span>
              </a>
              <form method="post" action="/api/logout">
                <button class="icon-button" type="submit" aria-label="Abmelden">
                  <Icon
                    name="logout"
                    width={24}
                    height={24}
                    aria-hidden="true"
                  />
                  <span class="sr-only">Abmelden</span>
                </button>
              </form>
            </When>
          </div>
        </nav>
      </header>
    </When>

    <main id="main-content">
      <slot />
    </main>

    <style lang="scss" is:global>
      :root {
        /* Light mode colors (WCAG AAA compliant) */
        --secondary-color: #c4d8f0;
        --highlight-color: #0056b3;
        --background-color: #d0e4ff;
        --text-color: #1a1a1a;
        --error-color: #c62828;
        --button-hover-color: #004080;
        --button-text-color: #fff;

        /* Focus indicators */
        --focus-outline-color: #0056b3;
        --focus-outline-width: 3px;
        --focus-outline-offset: 2px;

        /* Schrift */
        --font-family: "Source Sans Pro", system-ui, sans-serif;
        --header-font-size: clamp(1.5rem, 2vw, 2rem);
        --body-font-size: clamp(1.125rem, 1.5vw, 1.25rem);
        --button-font-size: clamp(1rem, 1.25vw, 1.125rem);

        /* Größen und Abstände */
        --padding-small: max(10px, 0.625rem);
        --padding-medium: max(20px, 1.25rem);
        --padding-large: max(40px, 2.5rem);
        --border-radius: 8px;

        /* Interaktive Elemente */
        --min-touch-target: 48px;
        --box-shadow: 0 4px 8px rgb(0 0 0 / 25%);
        --transition-speed: 0.3s;

        /* Zusätzliche Barrierefreiheits-Variablen */
        --line-height-body: 1.8;
        --max-line-length: 70ch;
        --spacing-text: 0.08em;

        /* Größen */
        --size-playlist-small: 7.438rem;
        --size-playlist-large: 10.313rem;

        /* Overlay */
        --color-overlay: rgb(0 0 0 / 60%);

        /* Opacity */
        --opacity-disabled: 0.4;

        /* Z-Index */
        --layer-above: 2;
        --spinner-size-small: 40px;
        --spinner-size-medium: 80px;
        --spinner-size-large: 120px;
      }

      html {
        box-sizing: border-box;
        margin: var(--padding-small);
        font-family: var(--font-family);
        background-color: var(--background-color);
      }

      *,
      *::before,
      *::after {
        box-sizing: inherit;
      }

      body {
        width: 100%;
        max-width: 768px;
        margin: 0 auto;
        padding: 0 var(--padding-small);

        font-size: var(--body-font-size);
        line-height: var(--line-height-body);
        color: var(--text-color);
        letter-spacing: var(--spacing-text);

        background-color: var(--background-color);

        @media (width >= 768px) {
          max-width: 768px;
          padding: 0 var(--padding-medium);
        }
      }

      .skip-link {
        position: absolute;
        z-index: 1000;
        top: -100%;
        left: 50%;
        transform: translateX(-50%);

        padding: var(--padding-small) var(--padding-medium);

        font-size: var(--button-font-size);
        font-weight: bold;
        color: var(--button-text-color);
        text-decoration: none;

        background: var(--highlight-color);
        border-radius: 0 0 var(--border-radius) var(--border-radius);
        box-shadow: var(--box-shadow);

        transition: top var(--transition-speed);

        &:focus {
          top: 0;
          outline: var(--focus-outline-width) solid var(--focus-outline-color);
          outline-offset: var(--focus-outline-offset);
        }

        &:hover {
          background-color: var(--button-hover-color);
        }
      }

      header {
        margin-bottom: var(--padding-medium);
        border-radius: var(--border-radius);

        @media (width >= 768px) {
          padding: var(--padding-medium);
        }
      }

      nav {
        display: flex;
        flex-wrap: wrap;
        gap: var(--padding-small);
        align-items: center;
        justify-content: space-between;

        @media (width >= 768px) {
          flex-wrap: nowrap;
        }
      }

      .slot {
        display: flex;
        gap: var(--padding-small);
        align-items: center;
      }

      .slot.left,
      .slot.right {
        flex: 1;
        justify-content: center;

        @media (width >= 768px) {
          justify-content: flex-start;
        }
      }

      .slot.right {
        @media (width >= 768px) {
          justify-content: flex-end;
        }
      }

      .logo {
        display: flex;
        justify-content: center;
      }

      .logo img {
        max-width: 100%;
        height: auto;
      }

      button {
        cursor: pointer;

        display: inline-block;

        padding: 0;

        background: none;
        border: none;

        transition: transform var(--transition-speed);
      }

      .icon-button {
        display: flex;
        align-items: center;
        justify-content: center;

        min-width: var(--min-touch-target);
        min-height: var(--min-touch-target);
        padding: var(--padding-small);

        color: var(--button-text-color);
        text-decoration: none;

        background-color: var(--highlight-color);
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);

        transition: all var(--transition-speed);

        &:hover,
        &:focus {
          transform: translateY(-2px);
          background-color: var(--button-hover-color);
        }

        &:focus-visible {
          transform: none;
          outline: var(--focus-outline-width) solid var(--focus-outline-color);
          outline-offset: var(--focus-outline-offset);
        }

        [astro-icon] {
          width: 24px;
          height: 24px;
        }
      }

      main {
        max-width: 100%;
        margin: 0 auto;
        padding: var(--padding-medium) 0;

        font-size: var(--body-font-size);
        line-height: 1.6;
        color: var(--text-color);

        @media (width >= 768px) {
          max-width: var(--max-line-length);
        }
      }

      .hasMargin {
        margin: 0 var(--padding-small);
      }

      .button {
        cursor: pointer;

        display: flex;
        align-items: center;
        justify-content: center;

        // Neue Größen-Eigenschaften
        min-height: var(--min-touch-target);
        padding: var(--padding-small) var(--padding-large);

        font-size: var(--button-font-size);
        color: var(--button-text-color);
        text-decoration: none;

        opacity: 1;
        background-color: var(--highlight-color);
        border: none;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);

        transition: all var(--transition-speed);

        &:hover {
          transform: scale(1.05);
          color: var(--button-text-color);
          background-color: var(--button-hover-color);
        }

        // Neue Focus-Styles
        &:focus-visible {
          transform: none; // Verhindert Skalierung während des Fokus
          outline: var(--focus-outline-width) solid var(--focus-outline-color);
          outline-offset: var(--focus-outline-offset);
        }

        &.hidden {
          overflow: hidden;

          height: 0;
          margin: 0;
          padding: 0;

          opacity: 0;
        }
      }

      .sr-only {
        position: absolute;

        overflow: hidden;

        width: 1px;
        height: 1px;
        margin: -1px;
        padding: 0;

        clip: rect(0, 0, 0, 0);
        border: 0;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          /* Dark mode colors (WCAG AAA compliant) */

          --secondary-color: #1e3a5f;
          --highlight-color: #79c0ff;
          --background-color: #0d1117;
          --text-color: #f0f6fc;
          --error-color: #ff8080;
          --button-hover-color: #58a6ff;
          --button-text-color: #0d1117;

          /* Adjust focus outline for better visibility in dark mode */
          --focus-outline-color: #58a6ff;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          scroll-behavior: auto !important;
          transition-duration: 0.01ms !important;
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
        }
      }

      /* Media Queries für Barrierefreiheit */
      @media (prefers-reduced-motion: reduce) {
        :root {
          --transition-speed: 0s;
        }

        .button:hover,
        .icon-button:hover {
          transform: none;
        }
      }

      @media (prefers-contrast: high) {
        :root {
          --highlight-color: #000;
          --text-color: #000;
          --background-color: #fff;
          --button-text-color: #fff;
          --button-hover-color: #000;
        }
      }

      @media (width <= 767px) {
        :root {
          --padding-small: max(8px, 0.5rem);
          --padding-medium: max(16px, 1rem);
          --padding-large: max(32px, 2rem);
          --body-font-size: 1rem;
          --button-font-size: 0.875rem;
        }
      }
    </style>
    <script src="https://cdn.usefathom.com/script.js" data-site="RKHOWTTO" defer
    ></script>
  </body>
</html>
