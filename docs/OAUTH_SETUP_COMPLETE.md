# Vollst√§ndige OAuth Provider Setup Anleitung f√ºr MelodyMind

## üéØ √úbersicht

MelodyMind unterst√ºtzt **5 OAuth Provider** out-of-the-box:

- ‚úÖ **Spotify** (bereits konfiguriert)
- ‚úÖ **Google** (vollst√§ndig implementiert)
- ‚úÖ **Apple** (vollst√§ndig implementiert)
- ‚úÖ **Discord** (vollst√§ndig implementiert)
- ‚úÖ **Yahoo** (vollst√§ndig implementiert)

Alle Provider sind **vollst√§ndig implementiert** - Sie m√ºssen nur die externen Apps konfigurieren
und Umgebungsvariablen setzen.

## üîß Quick Setup

### Umgebungsvariablen

F√ºgen Sie diese zu Ihrer `.env` Datei hinzu:

```env
# OAuth Provider Konfiguration

# Spotify OAuth
SPOTIFY_CLIENT_ID=your-spotify-client-id
SPOTIFY_CLIENT_SECRET=your-spotify-client-secret

# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# Apple OAuth (Sign in with Apple)
APPLE_CLIENT_ID=your-apple-client-id
APPLE_TEAM_ID=your-apple-team-id
APPLE_KEY_ID=your-apple-key-id
APPLE_PRIVATE_KEY=your-apple-private-key

# Discord OAuth
DISCORD_CLIENT_ID=your-discord-client-id
DISCORD_CLIENT_SECRET=your-discord-client-secret

# Yahoo OAuth
YAHOO_CLIENT_ID=your-yahoo-client-id
YAHOO_CLIENT_SECRET=your-yahoo-client-secret
```

### Standard Redirect URIs

F√ºr **alle Provider** verwenden Sie diese Redirect URI-Pattern:

```
Development:
http://localhost:4321/api/auth/oauth/callback/{provider}
http://localhost:4322/api/auth/oauth/callback/{provider}

Production:
https://yourdomain.com/api/auth/oauth/callback/{provider}
```

Ersetzen Sie `{provider}` durch: `spotify`, `google`, `apple`, `discord`, oder `yahoo`.

---

## üìã Provider-spezifische Setup Anleitungen

## 1. üéµ Spotify OAuth Setup

### Schritt 1: Spotify App Dashboard

1. Gehen Sie zu [Spotify Developer Dashboard](https://developer.spotify.com/dashboard)
2. Klicken Sie "Create App"
3. F√ºllen Sie aus:
   - **App name:** `MelodyMind`
   - **App description:** `Music trivia game with Spotify integration`
   - **Redirect URIs:**
     ```
     http://localhost:4321/api/auth/oauth/callback/spotify
     http://localhost:4322/api/auth/oauth/callback/spotify
     https://yourdomain.com/api/auth/oauth/callback/spotify
     ```
   - **APIs used:** Web API

### Schritt 2: Credentials kopieren

- **Client ID** und **Client Secret** aus dem Dashboard kopieren

### Features

- ‚úÖ User Profile Access
- ‚úÖ Top Tracks/Artists
- ‚úÖ Playlists
- ‚úÖ Music Library
- ‚úÖ Avatar & Profile Info

---

## 2. üîç Google OAuth Setup

### Schritt 1: Google Cloud Console

1. Gehen Sie zu [Google Cloud Console](https://console.cloud.google.com/)
2. Erstellen Sie ein Projekt oder w√§hlen Sie eins aus
3. Aktivieren Sie "Google+ API"
4. Gehen Sie zu "APIs & Services" ‚Üí "Credentials"

### Schritt 2: OAuth Consent Screen

1. W√§hlen Sie "External"
2. App Information:
   - **App name:** `MelodyMind`
   - **User support email:** Ihre E-Mail
   - **App domain:** Ihre Domain
3. Scopes hinzuf√ºgen: `openid`, `email`, `profile`

### Schritt 3: OAuth Client ID

1. "Create Credentials" ‚Üí "OAuth client ID"
2. **Application type:** Web application
3. **Authorized JavaScript origins:**
   ```
   http://localhost:4321
   http://localhost:4322
   https://yourdomain.com
   ```
4. **Authorized redirect URIs:**
   ```
   http://localhost:4321/api/auth/oauth/callback/google
   http://localhost:4322/api/auth/oauth/callback/google
   https://yourdomain.com/api/auth/oauth/callback/google
   ```

### Features

- ‚úÖ Gmail Profile Access
- ‚úÖ Google+ Profile
- ‚úÖ Avatar & Personal Info
- ‚úÖ Email Verification

---

## 3. üçé Apple OAuth Setup (Sign in with Apple)

### Schritt 1: Apple Developer Account

1. Gehen Sie zu [Apple Developer Portal](https://developer.apple.com/account/)
2. **Certificates, Identifiers & Profiles** ‚Üí **Identifiers**
3. Klicken Sie das "+" und w√§hlen Sie "App IDs"

### Schritt 2: App ID erstellen

1. **Description:** `MelodyMind`
2. **Bundle ID:** `com.yourdomain.melodymind` (reverse domain)
3. **Capabilities:** Aktivieren Sie "Sign in with Apple"

### Schritt 3: Service ID erstellen

1. **Identifiers** ‚Üí "+" ‚Üí **Services IDs**
2. **Description:** `MelodyMind Web`
3. **Identifier:** `com.yourdomain.melodymind.web`
4. **Configure Sign in with Apple:**
   - **Primary App ID:** Die eben erstellte App ID
   - **Domains:** `yourdomain.com`
   - **Return URLs:**
     ```
     http://localhost:4321/api/auth/oauth/callback/apple
     http://localhost:4322/api/auth/oauth/callback/apple
     https://yourdomain.com/api/auth/oauth/callback/apple
     ```

### Schritt 4: Private Key erstellen

1. **Keys** ‚Üí "+" ‚Üí **Sign in with Apple**
2. **Key Name:** `MelodyMind Apple Auth`
3. **Configure:** W√§hlen Sie Ihre App ID
4. **Download** der .p8 Datei (nur einmalig m√∂glich!)

### Umgebungsvariablen

```env
APPLE_CLIENT_ID=com.yourdomain.melodymind.web
APPLE_TEAM_ID=ABC123DEF4  # Aus Apple Developer Account
APPLE_KEY_ID=XYZ789ABC1  # Aus der Key-Konfiguration
APPLE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\nIhre_Private_Key_Hier\n-----END PRIVATE KEY-----
```

### Features

- ‚úÖ High Security (Face/Touch ID)
- ‚úÖ Privacy-Focused
- ‚úÖ Email Relay Option
- ‚úÖ Name & Profile Access

---

## 4. üéÆ Discord OAuth Setup

### Schritt 1: Discord Developer Portal

1. Gehen Sie zu [Discord Developer Portal](https://discord.com/developers/applications)
2. Klicken Sie "New Application"
3. **Name:** `MelodyMind`

### Schritt 2: OAuth2 konfigurieren

1. Gehen Sie zu **OAuth2** ‚Üí **General**
2. **Redirects:** F√ºgen Sie hinzu:
   ```
   http://localhost:4321/api/auth/oauth/callback/discord
   http://localhost:4322/api/auth/oauth/callback/discord
   https://yourdomain.com/api/auth/oauth/callback/discord
   ```

### Schritt 3: Credentials kopieren

- **Client ID** und **Client Secret** aus dem OAuth2 Tab

### Features

- ‚úÖ Gaming Profile
- ‚úÖ Avatar & Banner
- ‚úÖ Username#Discriminator
- ‚úÖ Server Memberships
- ‚úÖ Gaming Activity

---

## 5. üìß Yahoo OAuth Setup

### Schritt 1: Yahoo Developer Network

1. Gehen Sie zu [Yahoo Developer Network](https://developer.yahoo.com/)
2. Erstellen Sie einen Account oder loggen Sie sich ein
3. Gehen Sie zu "My Apps" ‚Üí "Create an App"

### Schritt 2: App konfigurieren

1. **Application Name:** `MelodyMind`
2. **Application Type:** `Web Application`
3. **Description:** `Music trivia game with Yahoo authentication`
4. **Home Page URL:** `https://yourdomain.com`
5. **Redirect URI(s):**
   ```
   http://localhost:4321/api/auth/oauth/callback/yahoo
   http://localhost:4322/api/auth/oauth/callback/yahoo
   https://yourdomain.com/api/auth/oauth/callback/yahoo
   ```
6. **API Permissions:** OpenID Connect

### Schritt 3: Credentials kopieren

- **Client ID** und **Client Secret** aus dem App Dashboard

### Features

- ‚úÖ Yahoo Mail Profile
- ‚úÖ OpenID Connect
- ‚úÖ Profile Information
- ‚úÖ Email Access

---

## üß™ Testing

### Alle Provider testen

1. **Server starten:**

   ```bash
   yarn dev
   ```

2. **Login-Seite √∂ffnen:**

   ```
   http://localhost:4321/de/auth/login
   ```

3. **Jeden Provider testen:**
   - Klicken Sie "Weiter mit [Provider]"
   - Sollte zur Provider-Seite weiterleiten
   - Nach Anmeldung zur√ºck zu MelodyMind
   - Erfolgreich eingeloggt

### Debug-Informationen

**Server-Logs √ºberpr√ºfen:**

```bash
# Sollte diese Nachrichten zeigen:
OAuth callback called for provider: [provider]
OAuth callback - code: present
User authenticated successfully
```

**Browser-Konsole:**

```javascript
// localStorage sollte enthalten:
auth_status: "authenticated";
user: "{...user_data...}";
```

## ‚ö†Ô∏è H√§ufige Fehler und L√∂sungen

### 1. "redirect_uri_mismatch"

**Problem:** Redirect URI stimmt nicht √ºberein **L√∂sung:** √úberpr√ºfen Sie die exakte URI in der
Provider-Console

### 2. "invalid_client"

**Problem:** Client ID/Secret falsch **L√∂sung:** √úberpr√ºfen Sie die .env Variablen

### 3. "access_denied"

**Problem:** User hat Berechtigung verweigert **L√∂sung:** Normal - User kann es erneut versuchen

### 4. "invalid_grant"

**Problem:** Authorization Code abgelaufen **L√∂sung:** Erneut versuchen - Codes sind nur kurz g√ºltig

### 5. Apple "invalid_client"

**Problem:** Private Key oder IDs falsch **L√∂sung:** √úberpr√ºfen Sie Team ID, Key ID und Private Key
Format

## üöÄ Produktions-Deployment

### 1. Domain-Konfiguration

**Alle Provider:** Ersetzen Sie localhost URLs durch Ihre Produktions-Domain

### 2. HTTPS erforderlich

**Alle Provider:** Verwenden Sie HTTPS in Produktion (au√üer localhost)

### 3. Environment Variables

```bash
# Produktions-Server
export SPOTIFY_CLIENT_ID="..."
export GOOGLE_CLIENT_ID="..."
# ... etc
```

### 4. Security Considerations

- ‚úÖ **HTTPS Pflicht** (au√üer Development)
- ‚úÖ **PKCE aktiviert** f√ºr alle kompatiblen Provider
- ‚úÖ **State Parameter** f√ºr CSRF Protection
- ‚úÖ **Secure Cookies** in Produktion
- ‚úÖ **Token Expiry** automatisch behandelt

## üìä √úbersicht der Features

| Provider | Profile | Avatar | Email | Zus√§tzliche Features          |
| -------- | ------- | ------ | ----- | ----------------------------- |
| Spotify  | ‚úÖ      | ‚úÖ     | ‚úÖ    | Musik-Pr√§ferenzen, Top Tracks |
| Google   | ‚úÖ      | ‚úÖ     | ‚úÖ    | Gmail, Google+ Profil         |
| Apple    | ‚úÖ      | ‚ùå     | ‚úÖ    | H√∂chste Sicherheit, Privacy   |
| Discord  | ‚úÖ      | ‚úÖ     | ‚úÖ    | Gaming Profil, Server         |
| Yahoo    | ‚úÖ      | ‚úÖ     | ‚úÖ    | Mail-Integration              |

## üéâ Das war's!

Nach dem Setup haben Sie:

- ‚úÖ **5 OAuth Provider** vollst√§ndig funktional
- ‚úÖ **Account Linking** - User k√∂nnen mehrere Provider verkn√ºpfen
- ‚úÖ **Sichere Authentifizierung** mit modernsten Standards
- ‚úÖ **Mehrsprachige UI** f√ºr alle Provider
- ‚úÖ **Responsive Design** auf allen Ger√§ten
- ‚úÖ **Production-Ready** Implementation

**Alle Provider sind plug-and-play - einfach die Credentials setzen und es funktioniert!** üöÄ

## üìù Weitere Dokumentation

- [Spotify spezifisch](./SPOTIFY_OAUTH_SETUP.md)
- [Google spezifisch](./GOOGLE_OAUTH_SETUP.md)
- [OAuth Troubleshooting](./OAUTH_TROUBLESHOOTING.md)
- [Security Best Practices](./OAUTH_SECURITY.md)
