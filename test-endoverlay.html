<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EndOverlay Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #1a1a1a;
        color: white;
      }

      .test-controls {
        margin-bottom: 20px;
        padding: 20px;
        background: #2a2a2a;
        border-radius: 8px;
      }

      button {
        margin: 5px;
        padding: 10px 20px;
        background: #8b5cf6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      button:hover {
        background: #7c3aed;
      }

      .status {
        margin-top: 20px;
        padding: 10px;
        background: #0f172a;
        border-radius: 4px;
      }

      .success {
        background: #166534;
      }
      .error {
        background: #dc2626;
      }
    </style>
  </head>
  <body>
    <h1>EndOverlay Animation Test</h1>

    <div class="test-controls">
      <h2>Test EndOverlay Functions</h2>
      <button onclick="testProgressBarAnimation()">Test Progress Bar Animation</button>
      <button onclick="testScoreDisplay()">Test Score Display</button>
      <button onclick="testMotivationText()">Test Motivation Text</button>
      <button onclick="testCompleteOverlay()">Test Complete Overlay</button>
      <button onclick="checkFunctions()">Check Functions Available</button>
    </div>

    <div id="status" class="status">Ready to test...</div>

    <script type="module">
      // Import the EndOverlay utilities
      import {
        animateProgressBar,
        updateEndOverlayScore,
        updateMotivationText,
        showEndOverlay,
      } from "/src/utils/endOverlay.ts";

      // Make functions available globally for button clicks
      window.testProgressBarAnimation = () => {
        try {
          animateProgressBar(750, 1000);
          updateStatus("Progress bar animation triggered with 75% score", "success");
        } catch (error) {
          updateStatus(`Error: ${error.message}`, "error");
        }
      };

      window.testScoreDisplay = () => {
        try {
          updateEndOverlayScore(850);
          updateStatus("Score display updated to 850", "success");
        } catch (error) {
          updateStatus(`Error: ${error.message}`, "error");
        }
      };

      window.testMotivationText = () => {
        try {
          updateMotivationText(750);
          updateStatus("Motivation text updated for score 750", "success");
        } catch (error) {
          updateStatus(`Error: ${error.message}`, "error");
        }
      };

      window.testCompleteOverlay = () => {
        try {
          showEndOverlay(900, 1000);
          updateStatus("Complete overlay animation triggered with score 900", "success");
        } catch (error) {
          updateStatus(`Error: ${error.message}`, "error");
        }
      };

      window.checkFunctions = () => {
        const funcs = [
          { name: "animateProgressBar", available: typeof animateProgressBar === "function" },
          { name: "updateEndOverlayScore", available: typeof updateEndOverlayScore === "function" },
          { name: "updateMotivationText", available: typeof updateMotivationText === "function" },
          { name: "showEndOverlay", available: typeof showEndOverlay === "function" },
          {
            name: "globalThis.showEndOverlay",
            available: typeof globalThis.showEndOverlay === "function",
          },
        ];

        const results = funcs.map((f) => `${f.name}: ${f.available ? "✅" : "❌"}`).join("<br>");
        updateStatus(`Function availability:<br>${results}`, "success");
      };

      function updateStatus(message, type = "") {
        const status = document.getElementById("status");
        status.innerHTML = message;
        status.className = `status ${type}`;
      }

      // Check if we're on a page with EndOverlay
      if (
        window.location.pathname.includes("game") ||
        window.location.pathname.includes("chronology")
      ) {
        updateStatus("EndOverlay test page detected - functions should work", "success");
      } else {
        updateStatus(
          "Not on a game page - some functions may not work due to missing DOM elements",
          "error"
        );
      }
    </script>
  </body>
</html>
